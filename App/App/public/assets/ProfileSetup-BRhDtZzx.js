import{j as e}from"./ui-DPaiNdCo.js";import{r as p,u as N}from"./vendor-Erj86lFQ.js";import{a as v,u as y,B as C,s as I,t as j}from"./index--9NxnRVI.js";import{C as w,a as P,b as S,c as A,d as F}from"./card-dL58-B1z.js";import{A as E,a as U,b as L}from"./avatar-mWBahg0l.js";import{I as k,X as B}from"./icons-KaFMl-Yu.js";import{L as h}from"./label-BwPas5T7.js";import{I as g}from"./input-B56E1p0u.js";import{T as R}from"./textarea-22JmvlCb.js";import"./supabase-ptc-ZlA7.js";import"./query-BhlUNxwW.js";import"./maps-CAbQPzAx.js";const T=({previewImage:a,name:s,onImageUpload:o,onClearImage:c})=>{const i=p.useRef(null),{toast:t}=v(),l=()=>{i.current?.click()},m=u=>{const d=u.target.files?.[0];if(!d)return;if(!d.type.match(/image\/(jpeg|jpg|png|gif|webp)/i)){t({title:"Invalid file type",description:"Please upload an image file (JPEG, PNG, GIF, or WEBP)",variant:"destructive"});return}if(d.size>5*1024*1024){t({title:"File too large",description:"Please upload an image smaller than 5MB",variant:"destructive"});return}const n=new FileReader;n.onload=r=>{const x=r.target?.result;o(x)},n.readAsDataURL(d)},f=u=>{u.stopPropagation(),c()};return e.jsxs("div",{className:"relative cursor-pointer",onClick:l,children:[e.jsx(E,{className:"h-24 w-24",children:a?e.jsx(U,{src:a}):e.jsx(L,{children:s.charAt(0)})}),e.jsx("div",{className:"absolute bottom-0 right-0 rounded-full bg-primary p-1",children:e.jsx(k,{className:"h-4 w-4 text-white"})}),a&&e.jsx("button",{type:"button",className:"absolute -top-2 -right-2 rounded-full bg-destructive p-1",onClick:f,children:e.jsx(B,{className:"h-3 w-3 text-white"})}),e.jsx("input",{type:"file",ref:i,onChange:m,accept:"image/*",className:"hidden"})]})},z=({initialImage:a,onImageChange:s,onClearImage:o})=>{const[c,i]=p.useState(a);v();const t=m=>{i(m),s(m)},l=()=>{i(null),o()};return e.jsx("div",{className:"flex items-center justify-center pb-4",children:e.jsx(T,{previewImage:c,name:"",onImageUpload:t,onClearImage:l})})},D=({formData:a,onFormChange:s})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"name",children:"Name"}),e.jsx(g,{id:"name",name:"name",value:a.name,onChange:s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"username",children:"Username"}),e.jsx(g,{id:"username",name:"username",value:a.username,onChange:s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"bio",children:"Bio"}),e.jsx(R,{id:"bio",name:"bio",value:a.bio,onChange:s,className:"resize-none",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"location",children:"Location"}),e.jsx(g,{id:"location",name:"location",value:a.location,onChange:s})]})]}),V=()=>{const a=N(),{user:s,loading:o}=y(),[c,i]=p.useState(!1),[t,l]=p.useState({name:"",username:"",bio:"",location:"",avatar:""});p.useEffect(()=>{!o&&!s&&a("/auth")},[s,o,a]);const m=n=>{const{name:r,value:x}=n.target;l(b=>({...b,[r]:x}))},f=n=>{l(r=>({...r,avatar:n}))},u=()=>{l(n=>({...n,avatar:""}))},d=async n=>{if(n.preventDefault(),!!s)try{i(!0);const{error:r}=await I.from("profiles").update({name:t.name,username:t.username||t.name.toLowerCase().replace(/\s+/g,"_"),bio:t.bio,location:t.location,avatar_url:t.avatar,updated_at:new Date().toISOString()}).eq("id",s.id);if(r)throw r;j({title:"Profile setup complete",description:"Your profile has been created successfully."}),a("/home")}catch(r){console.error("Error saving profile:",r),j({title:"Error",description:r.message||"Failed to save profile information",variant:"destructive"})}finally{i(!1)}};return o?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("p",{children:"Loading..."})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs(w,{children:[e.jsxs(P,{className:"space-y-1",children:[e.jsx(S,{className:"text-2xl font-bold",children:"Complete Your Profile"}),e.jsx(A,{children:"Add some information to help others find and recognize you."})]}),e.jsx(F,{children:e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(z,{initialImage:t.avatar,onImageChange:f,onClearImage:u})}),e.jsx(D,{formData:t,onFormChange:m}),e.jsx(C,{type:"submit",className:"w-full",disabled:c,children:c?"Saving...":"Complete Setup"})]})})]})})})};export{V as default};
