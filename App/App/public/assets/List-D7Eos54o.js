import{j as e}from"./ui-DPaiNdCo.js";import{N as b}from"./Navigation-Cx6-bI2t.js";import{u as C,r as u}from"./vendor-Erj86lFQ.js";import{a as M,b as g,u as S,M as y}from"./useMessages-DL79cIHx.js";import{B as x}from"./index--9NxnRVI.js";import{S as k,a as F,b as D,c as T,d as j}from"./select-BqNKLrJS.js";import{D as A,a as L,b as B,c as w}from"./dropdown-menu-BJEofygb.js";import{I as P}from"./input-B56E1p0u.js";import{S as I,F as V,b as N,v as z,a8 as $,e as H,a9 as Q}from"./icons-KaFMl-Yu.js";import{C as E,a as R,d as q,e as Y}from"./card-dL58-B1z.js";import{A as G,a as J,b as K}from"./avatar-mWBahg0l.js";import{B as O}from"./badge-Cp48qLeW.js";import{B as W}from"./BottomNavigation-D2RT3nlO.js";import"./scroll-area-D1-s-naE.js";import"./index-BdQq_4o_.js";import"./textarea-22JmvlCb.js";import"./supabase-ptc-ZlA7.js";import"./query-BhlUNxwW.js";import"./maps-CAbQPzAx.js";const X=({onSearch:s,placeholder:t="Search messages...",className:a=""})=>{const r=l=>{s(l.target.value)};return e.jsxs("div",{className:`relative w-full ${a}`,children:[e.jsx(I,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(P,{type:"text",placeholder:t,onChange:r,className:"w-full pl-9 bg-white"})]})},Z=({filters:s,onFiltersChange:t,sortBy:a,onSortChange:r,onSearch:l})=>e.jsxs("div",{className:"flex flex-col gap-4 mb-4 sticky top-0 bg-lo-off-white p-2 z-10",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(X,{onSearch:l})})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(A,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(x,{variant:"outline",size:"sm",className:"bg-white",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Filter"]})}),e.jsxs(B,{children:[e.jsx(w,{checked:s.showPublic,onCheckedChange:n=>t({...s,showPublic:n}),children:"Public Messages"}),e.jsx(w,{checked:s.showFollowers,onCheckedChange:n=>t({...s,showFollowers:n}),children:"Follower Messages"})]})]})}),e.jsxs(k,{value:a,onValueChange:r,children:[e.jsx(F,{className:"w-[180px] bg-white",children:e.jsx(D,{placeholder:"Sort by"})}),e.jsxs(T,{children:[e.jsx(j,{value:"recent",children:"Most Recent"}),e.jsx(j,{value:"expiring",children:"Expiring Soon"})]})]})]})]}),_=({user:s,location:t,isPublic:a,timestamp:r})=>{const l=n=>new Date(n).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"p-4 pb-0 flex flex-row items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(G,{className:"h-10 w-10 border-2 border-white shadow-sm",children:[e.jsx(J,{src:s.avatar,alt:s.name,className:"object-cover"}),e.jsx(K,{className:"bg-gradient-to-br from-purple-500 to-blue-500 text-white",children:s.name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(N,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:t})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx(O,{variant:a?"default":"secondary",children:a?"Public":"Followers"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:l(r)})]})]})},U=({content:s,mediaUrl:t})=>{const a=M(t,!1);return e.jsxs("div",{className:"p-4 pt-3",children:[e.jsx("p",{className:"mb-2",children:s}),t&&e.jsx("div",{className:"w-full rounded-md overflow-hidden h-56 bg-gray-100",children:a==="video"?e.jsx("video",{src:t,controls:!0,className:"w-full h-full object-cover",preload:"metadata",children:"Your browser does not support the video tag."}):e.jsx("img",{src:t,alt:"Message media",className:"w-full h-full object-cover"})})]})},ee=({expiresAt:s,messageId:t,position:a,onViewMessage:r})=>{const l=C(),n=m=>{const i=new Date,h=new Date(m).getTime()-i.getTime(),p=Math.floor(h/(1e3*60*60)),f=Math.floor(h%(1e3*60*60)/(1e3*60));return`${p}h ${f}m`},c=()=>{l("/home",{state:{center:{lat:a.x,lng:a.y},messageId:t,activateStreetView:!0}})};return e.jsx("div",{className:"p-4 pt-0 flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center justify-between w-full text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[n(s)," left"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{size:"sm",variant:"outline",onClick:r,children:"View"}),e.jsx(x,{size:"sm",variant:"outline",onClick:c,children:e.jsx(N,{className:"h-4 w-4"})})]})]})})},se=({messageId:s,userName:t,content:a,liked:r,likes:l,commentsCount:n,onLike:c,onComment:m})=>{const{handleShare:i}=g({initialLiked:r,initialLikes:l,messageId:s,userName:t,content:a});return e.jsxs("div",{className:"flex justify-between w-full border-t pt-2",children:[e.jsxs(x,{variant:"ghost",size:"sm",className:`flex-1 ${r?"text-red-500":""}`,onClick:c,children:[e.jsx($,{className:`h-4 w-4 mr-1 ${r?"fill-current":""}`}),l>0&&e.jsx("span",{children:l})]}),e.jsxs(x,{variant:"ghost",size:"sm",className:"flex-1",onClick:m,children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),n>0?e.jsx("span",{children:n}):"Comment"]}),e.jsxs(x,{variant:"ghost",size:"sm",className:"flex-1",onClick:i,children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Share"]})]})},te=({message:s,onSelect:t})=>{const a=Math.floor(Math.random()*5),{liked:r,likes:l,handleLike:n,handleComment:c}=g({messageId:s.id,userName:s.user.name,content:s.content}),m=()=>{t(s.id)},i=o=>{o.stopPropagation(),t(s.id),c(o)};return e.jsxs(E,{className:"slide-up",children:[e.jsx(R,{className:"p-0",children:e.jsx(_,{user:s.user,location:s.location,isPublic:s.isPublic,timestamp:s.timestamp})}),e.jsx(q,{className:"p-0",children:e.jsx(U,{content:s.content,mediaUrl:s.mediaUrl})}),e.jsxs(Y,{className:"p-0 flex-col gap-2",children:[e.jsx(ee,{expiresAt:s.expiresAt,messageId:s.id,position:s.position,onViewMessage:m}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx(se,{messageId:s.id,userName:s.user.name,content:s.content,liked:r,likes:l,commentsCount:a,onLike:n,onComment:i})})]})]})},ae=s=>{const[t,a]=u.useState({showPublic:!0,showFollowers:!0}),[r,l]=u.useState("recent"),[n,c]=u.useState(""),m=s.filter(i=>{if(!(i.isPublic&&t.showPublic)&&!(!i.isPublic&&t.showFollowers))return!1;if(n){const o=n.toLowerCase();return i.content.toLowerCase().includes(o)||i.location.toLowerCase().includes(o)||i.user.name.toLowerCase().includes(o)}return!0}).sort((i,o)=>r==="recent"?new Date(o.timestamp).getTime()-new Date(i.timestamp).getTime():new Date(i.expiresAt).getTime()-new Date(o.expiresAt).getTime());return{filters:t,setFilters:a,sortBy:r,setSortBy:l,searchQuery:n,setSearchQuery:c,filteredAndSortedMessages:m}},re=()=>{const[s,t]=u.useState(null),{filteredMessages:a}=S(),{filters:r,setFilters:l,sortBy:n,setSortBy:c,searchQuery:m,setSearchQuery:i,filteredAndSortedMessages:o}=ae(a),h=d=>{t(d)},p=()=>{t(null)},f=d=>{c(d)};return e.jsxs("div",{className:"message-list bg-lo-off-white p-4",children:[e.jsx(Z,{filters:r,onFiltersChange:l,sortBy:n,onSortChange:f,onSearch:i}),o.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No messages found."})}):e.jsx("div",{className:"space-y-4 pb-4",children:o.map(d=>e.jsx(te,{message:{...d,position:d.position||{x:0,y:0}},onSelect:h},d.id))}),s&&(()=>{const d=a.find(v=>v.id===s);return d?e.jsx(y,{message:d,onClose:p}):null})()]})},Me=()=>e.jsxs("div",{className:"min-h-screen flex flex-col pb-20",children:[e.jsx(b,{}),e.jsx(re,{}),e.jsx(W,{})]});export{Me as default};
