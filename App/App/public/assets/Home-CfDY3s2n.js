import{j as e,a as Hs,u as Ks,b as Js,P as Xt,f as Xs,n as Zs}from"./ui-DPaiNdCo.js";import{R as ye,r as m,f as Zt}from"./vendor-Erj86lFQ.js";import{M as gt,I as Qs,G as Qt,O as Oe}from"./maps-CAbQPzAx.js";import{B as O,t as E,c as de,u as De,s as Y,a as ea,e as es,b as ts,d as ss}from"./index--9NxnRVI.js";import{I as Ce}from"./input-B56E1p0u.js";import{D as ta,a as sa,b as aa,c as Ot}from"./dropdown-menu-BJEofygb.js";import{S as as,F as ra,L as na,N as $e,X as ve,e as ia,b as ne,f as oa,A as la,g as ca,U as da,a as Ae,h as ua,i as rs,P as it,j as ma,k as ns,V as pe,I as is,l as os,G as ls,m as ha,E as fa,n as Ke,o as ga,R as ze,p as Ft,M as Ye,q as ot,r as We,s as pt,t as ke,u as xt,v as je,W as pa,w as xa,x as lt,T as cs,H as Vt,y as Ut,z as va,B as vt,D as wa,J as ds,K as ba,O as ya,Q as ja,Y as Na,Z as Sa,_ as ct,$ as dt,a0 as Ca,a1 as ka,a2 as Ma,C as qt,a3 as Se,a4 as La,a5 as qe,a6 as Ea,a7 as Aa}from"./icons-KaFMl-Yu.js";import{g as Ia,a as Ta,M as Pa,u as wt}from"./useMessages-DL79cIHx.js";import{C as oe,d as me,a as bt,b as yt,e as Da}from"./card-dL58-B1z.js";import{T as $a,a as _a,b as Fe,c as Ve}from"./tabs-DzTUDrSt.js";import{B as be}from"./badge-Cp48qLeW.js";import{u as Ra,S as Oa,a as Fa,b as Va,c as Ua,d as rt}from"./select-BqNKLrJS.js";import{L as ce}from"./label-BwPas5T7.js";import{T as us}from"./textarea-22JmvlCb.js";import{A as ms,a as hs,b as fs}from"./avatar-mWBahg0l.js";import{f as gs,D as ps,a as xs,b as vs,c as ws}from"./dialog-DeOXp7R6.js";import{u as bs,E as qa}from"./EventDetailModal-L-MauCi8.js";import{B as Ba}from"./BottomNavigation-D2RT3nlO.js";import"./supabase-ptc-ZlA7.js";import"./query-BhlUNxwW.js";import"./scroll-area-D1-s-naE.js";import"./index-BdQq_4o_.js";import"./en-US-BL2atPzf.js";const za=({filters:t,onFilterChange:s,onSearchBoxLoad:r,map:n})=>{const o=ye.useRef(null),[l,a]=ye.useState(!1);ye.useEffect(()=>{if(!o.current||!window.google?.maps?.places)return;const c=new google.maps.places.SearchBox(o.current);return r(c),()=>{google.maps.event.clearInstanceListeners(c)}},[r]);const d=()=>{a(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(c=>{const{latitude:h,longitude:y}=c.coords;if(n){const f=new google.maps.LatLng(h,y);n.setCenter(f),n.setZoom(16)}a(!1)},c=>{console.error("Error getting location:",c),a(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}):a(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-0 inset-x-0 z-30",style:{paddingTop:"env(safe-area-inset-top, 16px)"},children:e.jsx("div",{className:"mx-4 mt-3",children:e.jsx("div",{className:"relative max-w-md mx-auto",children:e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(Ce,{ref:o,type:"text",placeholder:"Search places, events, locations...",className:"w-full h-12 pl-12 pr-14 bg-white/95 backdrop-blur-xl shadow-2xl border-0 rounded-3xl text-base placeholder:text-gray-500 focus:bg-white focus:shadow-3xl transition-all duration-300 focus:ring-2 focus:ring-lo-teal/20"}),e.jsx(as,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsxs(ta,{children:[e.jsx(sa,{asChild:!0,children:e.jsx(O,{size:"icon",variant:"ghost",className:"h-11 w-11 min-h-[44px] min-w-[44px] rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(ra,{className:"h-4 w-4"})})}),e.jsxs(aa,{className:"w-56 mt-2 shadow-xl border-0 rounded-2xl backdrop-blur-xl bg-white/95",children:[e.jsx("div",{className:"px-3 py-2 border-b border-gray-100",children:e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Content Filters"})}),e.jsx(Ot,{checked:t.showPublic,onCheckedChange:c=>s("showPublic",c),className:"px-3 py-3 rounded-xl mx-1 my-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(na,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"Public Posts"})]})}),e.jsx(Ot,{checked:t.showFollowers,onCheckedChange:c=>s("showFollowers",c),className:"px-3 py-3 rounded-xl mx-1 my-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-4 w-4 rounded-full bg-gradient-to-r from-purple-500 to-pink-500"}),e.jsx("span",{className:"font-medium",children:"Following"})]})})]})]})})]})})})}),e.jsx("div",{className:"absolute bottom-28 right-4 z-20 flex flex-col space-y-3",children:e.jsx(O,{onClick:d,disabled:l,className:"h-14 w-14 bg-white/95 backdrop-blur-xl shadow-2xl border-0 rounded-full hover:bg-white hover:shadow-3xl transition-all duration-300 transform hover:scale-105 active:scale-95",variant:"outline",children:e.jsx($e,{className:`h-6 w-6 text-gray-700 ${l?"animate-pulse":""}`,fill:l?"currentColor":"none"})})})]})},Ya=({onCancelStreetView:t,onCreateMessage:s,isInStreetView:r})=>e.jsxs("div",{className:"absolute right-8 top-8 z-20 flex flex-col gap-2",children:[e.jsxs(O,{onClick:t,className:"flex items-center gap-2 shadow-lg",variant:"destructive",children:[e.jsx(ve,{className:"h-4 w-4"}),"Exit Street View"]}),r&&e.jsxs(O,{onClick:s,className:"flex items-center gap-2 shadow-lg bg-lo-teal hover:bg-lo-teal/90",variant:"default",children:[e.jsx(ia,{className:"h-4 w-4"}),"Drop Lo Here"]})]}),ys=()=>{const[t,s]=m.useState(null),[r,n]=m.useState(null),[o,l]=m.useState(!1),[a,d]=m.useState(!1),[c,h]=m.useState(null),y=m.useRef(null),f=m.useCallback(p=>{s(p);const i=p.getStreetView();y.current=i,i.setOptions({enableCloseButton:!0,imageDateControl:!0,visible:!1,motionTracking:!1,motionTrackingControl:!1,addressControl:!0}),i.addListener("visible_changed",()=>{l(i.getVisible()),d(i.getVisible()),i.getVisible()&&E({title:"Street View activated",description:"You can now drop a Lo in Street View mode"})}),i.addListener("position_changed",()=>{if(i.getVisible()){const u=i.getPosition();u&&h({lat:u.lat(),lng:u.lng()})}}),i.addListener("click",u=>{if(i.getVisible()&&u.latLng){const g={lat:u.latLng.lat(),lng:u.latLng.lng()};window.dispatchEvent(new CustomEvent("streetViewClick",{detail:g}))}}),i.addListener("pano_changed",()=>{if(i.getVisible()){const u=i.getPosition();u&&h({lat:u.lat(),lng:u.lng()})}})},[]),v=m.useCallback(()=>{t&&(t.getStreetView().setVisible(!1),l(!1),d(!1),h(null))},[t]),S=m.useCallback(p=>{if(!t)return;l(!0),new google.maps.StreetViewService().getPanorama({location:new google.maps.LatLng(p.lat,p.lng),radius:50},(u,g)=>{if(g===google.maps.StreetViewStatus.OK){const j=t.getStreetView();j.setPosition(new google.maps.LatLng(p.lat,p.lng)),j.setVisible(!0),d(!0),h(p),E({title:"Street View Loaded",description:"Now viewing location in Street View mode"})}else l(!1),E({title:"Street View not available",description:"Street View isn't available at this location",variant:"destructive"})})},[t]),x=m.useCallback(()=>{s(null)},[]),w=m.useCallback(p=>{console.log("üîç Search box loaded:",p),n(p);const i=p.addListener("places_changed",()=>{console.log("üîç Places changed event triggered");const u=p.getPlaces();if(console.log("üîç Places found:",u?.length||0),!u||u.length===0){console.log("üîç No places returned from search"),E({title:"No results found",description:"Please try a different search term",variant:"destructive"});return}const g=u[0];if(console.log("üîç Selected place:",g.name,g.geometry?.location?.toString()),!g.geometry||!g.geometry.location){console.log("üîç Place has no geometry/location"),E({title:"No location found",description:"Please try a different search term",variant:"destructive"});return}t?(console.log("üîç Updating map to show location"),g.geometry.viewport?t.fitBounds(g.geometry.viewport):(t.setCenter(g.geometry.location),t.setZoom(15)),document.querySelectorAll('input[placeholder*="Search places"]').forEach(N=>N.value=""),E({title:"Location found",description:`Showing results for ${g.name||"selected location"}`})):console.log("üîç Map not available for location update")});return()=>{i&&google.maps.event.removeListener(i)}},[t]);return{map:t,searchBox:r,isAttemptingStreetView:o,isInStreetView:a,streetViewPosition:c,onLoad:f,onUnmount:x,onSearchBoxLoad:w,handleCancelStreetView:v,activateStreetView:S}},js=()=>{const[t,s]=m.useState(null),[r,n]=m.useState(!1),[,o]=m.useState({});return{selectedMessage:t,setSelectedMessage:s,isCreating:r,setIsCreating:n,handleClose:()=>{s(null),n(!1),o({})}}},Wa=({map:t,isPlacingPin:s,setNewPinPosition:r,onCreateMessage:n})=>{const o=Zt(),{setSelectedMessage:l}=js(),{isAttemptingStreetView:a,isInStreetView:d,streetViewPosition:c,handleCancelStreetView:h,activateStreetView:y}=ys();return m.useEffect(()=>{if(o.state&&o.state.activateStreetView&&o.state.center&&t){const{lat:f,lng:v}=o.state.center;setTimeout(()=>{y({lat:f,lng:v}),o.state.messageId&&l(o.state.messageId)},500)}},[o.state,t,y,l]),m.useEffect(()=>{const f=v=>{s&&d&&v.detail&&(r(v.detail),E({title:"Street View location selected",description:"Now you can create your Lo at this location"}))};return window.addEventListener("streetViewClick",f),()=>{window.removeEventListener("streetViewClick",f)}},[s,d,r]),a?e.jsx(Ya,{onCancelStreetView:h,onCreateMessage:n,isInStreetView:d}):null},Ga=({isPlacingPin:t})=>t?e.jsxs("div",{className:"absolute left-1/2 top-8 z-50 transform -translate-x-1/2 bg-background/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg flex items-center gap-2 border border-primary/50 pulse",children:[e.jsx(ne,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Click anywhere on the map to place your Lo"})]}):null,Ha=({messageType:t,userName:s,mediaUrl:r,isLivestream:n=!1,isLive:o=!1,isEvent:l=!1,size:a=36})=>{const d=Ia(t),c=s?.charAt(0)||"?",y=t==="text"?`<svg xmlns="http://www.w3.org/2000/svg" width="${a}" height="${a}" viewBox="0 0 ${a} ${a}">
        <circle cx="${a/2}" cy="${a/2}" r="${a/2-2}" fill="${d}" stroke="white" stroke-width="2"/>
        <text x="${a/2}" y="${a/2+4}" font-family="Arial" font-size="${a/3}" fill="white" text-anchor="middle">${c}</text>
      </svg>`:t==="livestream"?o?`<svg xmlns="http://www.w3.org/2000/svg" width="${a+12}" height="${a+12}" viewBox="0 0 ${a+12} ${a+12}">
          <!-- Pulsing outer ring -->
          <circle cx="${(a+12)/2}" cy="${(a+12)/2}" r="${(a+12)/2-1}" fill="${d}" opacity="0.3">
            <animate attributeName="r" values="${(a+12)/2-8};${(a+12)/2-1};${(a+12)/2-8}" dur="2s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.7;0.2;0.7" dur="2s" repeatCount="indefinite"/>
          </circle>
          <!-- Main marker -->
          <circle cx="${(a+12)/2}" cy="${(a+12)/2}" r="${a/2-1}" fill="${d}" stroke="white" stroke-width="2"/>
          <!-- Live indicator -->
          <circle cx="${(a+12)/2}" cy="${(a+12)/2}" r="${a/2-8}" fill="white" opacity="0.9"/>
          <text x="${(a+12)/2}" y="${(a+12)/2+2}" font-family="Arial" font-size="8" fill="${d}" text-anchor="middle">‚óè</text>
          <text x="${(a+12)/2}" y="${(a+12)/2-6}" font-family="Arial" font-size="6" fill="${d}" text-anchor="middle">LIVE</text>
        </svg>`:`<svg xmlns="http://www.w3.org/2000/svg" width="${a+8}" height="${a+8}" viewBox="0 0 ${a+8} ${a+8}">
          <circle cx="${(a+8)/2}" cy="${(a+8)/2}" r="${(a+8)/2-1}" fill="white" stroke="${d}" stroke-width="2"/>
          <circle cx="${(a+8)/2}" cy="${(a+8)/2}" r="${a/2-2}" fill="${d}" opacity="0.9"/>
          <circle cx="${(a+8)/2}" cy="${(a+8)/2}" r="${a/2-6}" fill="white" opacity="0.8"/>
          <text x="${(a+8)/2}" y="${(a+8)/2+2}" font-family="Arial" font-size="8" fill="${d}" text-anchor="middle">‚ñ∂</text>
        </svg>`:t==="event"?`<svg xmlns="http://www.w3.org/2000/svg" width="${a+8}" height="${a+8}" viewBox="0 0 ${a+8} ${a+8}">
        <!-- Outer border with slight glow effect -->
        <circle cx="${(a+8)/2}" cy="${(a+8)/2}" r="${(a+8)/2-1}" fill="white" stroke="${d}" stroke-width="3" opacity="0.9"/>
        <!-- Main marker background -->
        <circle cx="${(a+8)/2}" cy="${(a+8)/2}" r="${a/2-1}" fill="${d}" opacity="0.95"/>
        <!-- Calendar icon background -->
        <rect x="${(a+8)/2-8}" y="${(a+8)/2-8}" width="16" height="16" rx="2" fill="white" opacity="0.9"/>
        <!-- Calendar top -->
        <rect x="${(a+8)/2-6}" y="${(a+8)/2-7}" width="12" height="2" fill="${d}"/>
        <!-- Calendar body -->
        <rect x="${(a+8)/2-6}" y="${(a+8)/2-4}" width="12" height="10" fill="white" stroke="${d}" stroke-width="0.5"/>
        <!-- Calendar dots -->
        <circle cx="${(a+8)/2-3}" cy="${(a+8)/2-1}" r="1" fill="${d}"/>
        <circle cx="${(a+8)/2}" cy="${(a+8)/2-1}" r="1" fill="${d}"/>
        <circle cx="${(a+8)/2+3}" cy="${(a+8)/2-1}" r="1" fill="${d}"/>
        <circle cx="${(a+8)/2-3}" cy="${(a+8)/2+2}" r="1" fill="${d}"/>
        <circle cx="${(a+8)/2}" cy="${(a+8)/2+2}" r="1" fill="${d}"/>
      </svg>`:`<svg xmlns="http://www.w3.org/2000/svg" width="${a+8}" height="${a+8}" viewBox="0 0 ${a+8} ${a+8}">
      <!-- Outer border -->
      <circle cx="${(a+8)/2}" cy="${(a+8)/2}" r="${(a+8)/2-1}" fill="white" stroke="${d}" stroke-width="2"/>
      <!-- Inner content area -->
      <circle cx="${(a+8)/2}" cy="${(a+8)/2}" r="${a/2-2}" fill="${d}" opacity="0.9"/>
      <!-- Preview placeholder (will be replaced with actual image) -->
      <circle cx="${(a+8)/2}" cy="${(a+8)/2}" r="${a/2-6}" fill="white" opacity="0.8"/>
      <text x="${(a+8)/2}" y="${(a+8)/2+2}" font-family="Arial" font-size="8" fill="${d}" text-anchor="middle">${t==="video"?"‚ñ∂":"üì∑"}</text>
    </svg>`;return"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(y)},Ns=({messages:t,onMessageClick:s})=>(console.log(`üó∫Ô∏è MessageMarkers: Rendering ${t.length} messages`),t.length>0&&console.log("üìç First message position:",t[0].position),e.jsx(e.Fragment,{children:t.map(r=>{const n=r.isEvent||!1,o=Ta(r.mediaUrl,r.isLivestream,n),l=r.user?.name||"Unknown",a=r.isLivestream||!1,d=r.isLive||!1,c=Ha({messageType:o,userName:l,mediaUrl:r.mediaUrl,isLivestream:a,isLive:d,isEvent:n,size:36}),h=o==="text"?36:o==="livestream"&&d||o==="event"?48:44,y=h/2;return e.jsx(gt,{position:{lat:r.position.x,lng:r.position.y},onClick:()=>s(r.id),icon:{url:c,anchor:new google.maps.Point(y,y),scaledSize:new google.maps.Size(h,h)},visible:!0,zIndex:r.id.startsWith("new-")?100:2,animation:r.id.startsWith("new-")?google.maps.Animation.BOUNCE:google.maps.Animation.DROP},r.id)})}));var jt="Switch",[Ka,An]=Hs(jt),[Ja,Xa]=Ka(jt),Ss=m.forwardRef((t,s)=>{const{__scopeSwitch:r,name:n,checked:o,defaultChecked:l,required:a,disabled:d,value:c="on",onCheckedChange:h,form:y,...f}=t,[v,S]=m.useState(null),x=Ks(s,g=>S(g)),w=m.useRef(!1),p=v?y||!!v.closest("form"):!0,[i=!1,u]=Js({prop:o,defaultProp:l,onChange:h});return e.jsxs(Ja,{scope:r,checked:i,disabled:d,children:[e.jsx(Xt.button,{type:"button",role:"switch","aria-checked":i,"aria-required":a,"data-state":Ms(i),"data-disabled":d?"":void 0,disabled:d,value:c,...f,ref:x,onClick:Xs(t.onClick,g=>{u(j=>!j),p&&(w.current=g.isPropagationStopped(),w.current||g.stopPropagation())})}),p&&e.jsx(Za,{control:v,bubbles:!w.current,name:n,value:c,checked:i,required:a,disabled:d,form:y,style:{transform:"translateX(-100%)"}})]})});Ss.displayName=jt;var Cs="SwitchThumb",ks=m.forwardRef((t,s)=>{const{__scopeSwitch:r,...n}=t,o=Xa(Cs,r);return e.jsx(Xt.span,{"data-state":Ms(o.checked),"data-disabled":o.disabled?"":void 0,...n,ref:s})});ks.displayName=Cs;var Za=t=>{const{control:s,checked:r,bubbles:n=!0,...o}=t,l=m.useRef(null),a=Ra(r),d=Zs(s);return m.useEffect(()=>{const c=l.current,h=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(h,"checked").set;if(a!==r&&f){const v=new Event("click",{bubbles:n});f.call(c,r),c.dispatchEvent(v)}},[a,r,n]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...o,tabIndex:-1,ref:l,style:{...t.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Ms(t){return t?"checked":"unchecked"}var Ls=Ss,Qa=ks;const Nt=m.forwardRef(({className:t,...s},r)=>e.jsx(Ls,{className:de("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:r,children:e.jsx(Qa,{className:de("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Nt.displayName=Ls.displayName;const er=({isPublic:t,onToggle:s})=>e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(ce,{htmlFor:"public-toggle",children:"Make public"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t?"Anyone can see this message":"Only followers can see this message"})]}),e.jsx(Nt,{id:"public-toggle",checked:t,onCheckedChange:s})]}),tr=({isPinPlaced:t,onMovePin:s})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 flex items-center text-sm text-muted-foreground",children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),t?e.jsx("span",{children:"Pin placed! Move it to adjust location"}):e.jsx("span",{children:"Place your pin on the map"})]}),t&&s&&e.jsxs(O,{type:"button",variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:s,children:[e.jsx(oa,{className:"h-4 w-4"}),"Move Pin"]})]});function sr(t){return Object.prototype.toString.call(t)==="[object Object]"}function Bt(t){return sr(t)||Array.isArray(t)}function ar(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function St(t,s){const r=Object.keys(t),n=Object.keys(s);if(r.length!==n.length)return!1;const o=JSON.stringify(Object.keys(t.breakpoints||{})),l=JSON.stringify(Object.keys(s.breakpoints||{}));return o!==l?!1:r.every(a=>{const d=t[a],c=s[a];return typeof d=="function"?`${d}`==`${c}`:!Bt(d)||!Bt(c)?d===c:St(d,c)})}function zt(t){return t.concat().sort((s,r)=>s.name>r.name?1:-1).map(s=>s.options)}function rr(t,s){if(t.length!==s.length)return!1;const r=zt(t),n=zt(s);return r.every((o,l)=>{const a=n[l];return St(o,a)})}function Ct(t){return typeof t=="number"}function ut(t){return typeof t=="string"}function Je(t){return typeof t=="boolean"}function Yt(t){return Object.prototype.toString.call(t)==="[object Object]"}function Q(t){return Math.abs(t)}function kt(t){return Math.sign(t)}function Le(t,s){return Q(t-s)}function nr(t,s){if(t===0||s===0||Q(t)<=Q(s))return 0;const r=Le(Q(t),Q(s));return Q(r/t)}function Ie(t){return Te(t).map(Number)}function he(t){return t[_e(t)]}function _e(t){return Math.max(0,t.length-1)}function Mt(t,s){return s===_e(t)}function Wt(t,s=0){return Array.from(Array(t),(r,n)=>s+n)}function Te(t){return Object.keys(t)}function Es(t,s){return[t,s].reduce((r,n)=>(Te(n).forEach(o=>{const l=r[o],a=n[o],d=Yt(l)&&Yt(a);r[o]=d?Es(l,a):a}),r),{})}function mt(t,s){return typeof s.MouseEvent<"u"&&t instanceof s.MouseEvent}function ir(t,s){const r={start:n,center:o,end:l};function n(){return 0}function o(c){return l(c)/2}function l(c){return s-c}function a(c,h){return ut(t)?r[t](c):t(s,c,h)}return{measure:a}}function Pe(){let t=[];function s(o,l,a,d={passive:!0}){let c;if("addEventListener"in o)o.addEventListener(l,a,d),c=()=>o.removeEventListener(l,a,d);else{const h=o;h.addListener(a),c=()=>h.removeListener(a)}return t.push(c),n}function r(){t=t.filter(o=>o())}const n={add:s,clear:r};return n}function or(t,s,r,n){const o=Pe(),l=1e3/60;let a=null,d=0,c=0;function h(){o.add(t,"visibilitychange",()=>{t.hidden&&x()})}function y(){S(),o.clear()}function f(p){if(!c)return;a||(a=p);const i=p-a;for(a=p,d+=i;d>=l;)r(l),d-=l;const u=d/l;n(u),c&&s.requestAnimationFrame(f)}function v(){c||(c=s.requestAnimationFrame(f))}function S(){s.cancelAnimationFrame(c),a=null,d=0,c=0}function x(){a=null,d=0}return{init:h,destroy:y,start:v,stop:S,update:()=>r(l),render:n}}function lr(t,s){const r=s==="rtl",n=t==="y",o=n?"y":"x",l=n?"x":"y",a=!n&&r?-1:1,d=y(),c=f();function h(x){const{height:w,width:p}=x;return n?w:p}function y(){return n?"top":r?"right":"left"}function f(){return n?"bottom":r?"left":"right"}function v(x){return x*a}return{scroll:o,cross:l,startEdge:d,endEdge:c,measureSize:h,direction:v}}function Ne(t=0,s=0){const r=Q(t-s);function n(h){return h<t}function o(h){return h>s}function l(h){return n(h)||o(h)}function a(h){return l(h)?n(h)?t:s:h}function d(h){return r?h-r*Math.ceil((h-s)/r):h}return{length:r,max:s,min:t,constrain:a,reachedAny:l,reachedMax:o,reachedMin:n,removeOffset:d}}function As(t,s,r){const{constrain:n}=Ne(0,t),o=t+1;let l=a(s);function a(v){return r?Q((o+v)%o):n(v)}function d(){return l}function c(v){return l=a(v),f}function h(v){return y().set(d()+v)}function y(){return As(t,d(),r)}const f={get:d,set:c,add:h,clone:y};return f}function cr(t,s,r,n,o,l,a,d,c,h,y,f,v,S,x,w,p,i,u){const{cross:g,direction:j}=t,N=["INPUT","SELECT","TEXTAREA"],b={passive:!1},k=Pe(),C=Pe(),M=Ne(50,225).constrain(S.measure(20)),L={mouse:300,touch:400},A={mouse:500,touch:600},_=x?43:25;let P=!1,V=0,T=0,I=!1,R=!1,z=!1,H=!1;function ee($){if(!u)return;function G(re){(Je(u)||u($,re))&&U(re)}const se=s;k.add(se,"dragstart",re=>re.preventDefault(),b).add(se,"touchmove",()=>{},b).add(se,"touchend",()=>{}).add(se,"touchstart",G).add(se,"mousedown",G).add(se,"touchcancel",W).add(se,"contextmenu",W).add(se,"click",ae,!0)}function X(){k.clear(),C.clear()}function te(){const $=H?r:s;C.add($,"touchmove",D,b).add($,"touchend",W).add($,"mousemove",D,b).add($,"mouseup",W)}function K($){const G=$.nodeName||"";return N.includes(G)}function F(){return(x?A:L)[H?"mouse":"touch"]}function B($,G){const se=f.add(kt($)*-1),re=y.byDistance($,!x).distance;return x||Q($)<M?re:p&&G?re*.5:y.byIndex(se.get(),0).distance}function U($){const G=mt($,n);H=G,z=x&&G&&!$.buttons&&P,P=Le(o.get(),a.get())>=2,!(G&&$.button!==0)&&(K($.target)||(I=!0,l.pointerDown($),h.useFriction(0).useDuration(0),o.set(a),te(),V=l.readPoint($),T=l.readPoint($,g),v.emit("pointerDown")))}function D($){if(!mt($,n)&&$.touches.length>=2)return W($);const se=l.readPoint($),re=l.readPoint($,g),le=Le(se,V),ue=Le(re,T);if(!R&&!H&&(!$.cancelable||(R=le>ue,!R)))return W($);const fe=l.pointerMove($);le>w&&(z=!0),h.useFriction(.3).useDuration(.75),d.start(),o.add(j(fe)),$.preventDefault()}function W($){const se=y.byDistance(0,!1).index!==f.get(),re=l.pointerUp($)*F(),le=B(j(re),se),ue=nr(re,le),fe=_-10*ue,ge=i+ue/50;R=!1,I=!1,C.clear(),h.useDuration(fe).useFriction(ge),c.distance(le,!x),H=!1,v.emit("pointerUp")}function ae($){z&&($.stopPropagation(),$.preventDefault(),z=!1)}function Z(){return I}return{init:ee,destroy:X,pointerDown:Z}}function dr(t,s){let n,o;function l(f){return f.timeStamp}function a(f,v){const x=`client${(v||t.scroll)==="x"?"X":"Y"}`;return(mt(f,s)?f:f.touches[0])[x]}function d(f){return n=f,o=f,a(f)}function c(f){const v=a(f)-a(o),S=l(f)-l(n)>170;return o=f,S&&(n=f),v}function h(f){if(!n||!o)return 0;const v=a(o)-a(n),S=l(f)-l(n),x=l(f)-l(o)>170,w=v/S;return S&&!x&&Q(w)>.1?w:0}return{pointerDown:d,pointerMove:c,pointerUp:h,readPoint:a}}function ur(){function t(r){const{offsetTop:n,offsetLeft:o,offsetWidth:l,offsetHeight:a}=r;return{top:n,right:o+l,bottom:n+a,left:o,width:l,height:a}}return{measure:t}}function mr(t){function s(n){return t*(n/100)}return{measure:s}}function hr(t,s,r,n,o,l,a){const d=[t].concat(n);let c,h,y=[],f=!1;function v(p){return o.measureSize(a.measure(p))}function S(p){if(!l)return;h=v(t),y=n.map(v);function i(u){for(const g of u){if(f)return;const j=g.target===t,N=n.indexOf(g.target),b=j?h:y[N],k=v(j?t:n[N]);if(Q(k-b)>=.5){p.reInit(),s.emit("resize");break}}}c=new ResizeObserver(u=>{(Je(l)||l(p,u))&&i(u)}),r.requestAnimationFrame(()=>{d.forEach(u=>c.observe(u))})}function x(){f=!0,c&&c.disconnect()}return{init:S,destroy:x}}function fr(t,s,r,n,o,l){let a=0,d=0,c=o,h=l,y=t.get(),f=0;function v(b){const k=b/1e3,C=c*k,M=n.get()-t.get(),L=!c;let A=0;return L?(a=0,r.set(n),t.set(n),A=M):(r.set(t),a+=M/C,a*=h,y+=a,t.add(a*k),A=y-f),d=kt(A),f=y,N}function S(){const b=n.get()-s.get();return Q(b)<.001}function x(){return c}function w(){return d}function p(){return a}function i(){return g(o)}function u(){return j(l)}function g(b){return c=b,N}function j(b){return h=b,N}const N={direction:w,duration:x,velocity:p,seek:v,settled:S,useBaseFriction:u,useBaseDuration:i,useFriction:j,useDuration:g};return N}function gr(t,s,r,n,o){const l=o.measure(10),a=o.measure(50),d=Ne(.1,.99);let c=!1;function h(){return!(c||!t.reachedAny(r.get())||!t.reachedAny(s.get()))}function y(S){if(!h())return;const x=t.reachedMin(s.get())?"min":"max",w=Q(t[x]-s.get()),p=r.get()-s.get(),i=d.constrain(w/a);r.subtract(p*i),!S&&Q(p)<l&&(r.set(t.constrain(r.get())),n.useDuration(25).useBaseFriction())}function f(S){c=!S}return{shouldConstrain:h,constrain:y,toggleActive:f}}function pr(t,s,r,n,o){const l=Ne(-s+t,0),a=f(),d=y(),c=v();function h(x,w){return Le(x,w)<1}function y(){const x=a[0],w=he(a),p=a.lastIndexOf(x),i=a.indexOf(w)+1;return Ne(p,i)}function f(){return r.map((x,w)=>{const{min:p,max:i}=l,u=l.constrain(x),g=!w,j=Mt(r,w);return g?i:j||h(p,u)?p:h(i,u)?i:u}).map(x=>parseFloat(x.toFixed(3)))}function v(){if(s<=t+o)return[l.max];if(n==="keepSnaps")return a;const{min:x,max:w}=d;return a.slice(x,w)}return{snapsContained:c,scrollContainLimit:d}}function xr(t,s,r){const n=s[0],o=r?n-t:he(s);return{limit:Ne(o,n)}}function vr(t,s,r,n){const l=s.min+.1,a=s.max+.1,{reachedMin:d,reachedMax:c}=Ne(l,a);function h(v){return v===1?c(r.get()):v===-1?d(r.get()):!1}function y(v){if(!h(v))return;const S=t*(v*-1);n.forEach(x=>x.add(S))}return{loop:y}}function wr(t){const{max:s,length:r}=t;function n(l){const a=l-s;return r?a/-r:0}return{get:n}}function br(t,s,r,n,o){const{startEdge:l,endEdge:a}=t,{groupSlides:d}=o,c=f().map(s.measure),h=v(),y=S();function f(){return d(n).map(w=>he(w)[a]-w[0][l]).map(Q)}function v(){return n.map(w=>r[l]-w[l]).map(w=>-Q(w))}function S(){return d(h).map(w=>w[0]).map((w,p)=>w+c[p])}return{snaps:h,snapsAligned:y}}function yr(t,s,r,n,o,l){const{groupSlides:a}=o,{min:d,max:c}=n,h=y();function y(){const v=a(l),S=!t||s==="keepSnaps";return r.length===1?[l]:S?v:v.slice(d,c).map((x,w,p)=>{const i=!w,u=Mt(p,w);if(i){const g=he(p[0])+1;return Wt(g)}if(u){const g=_e(l)-he(p)[0]+1;return Wt(g,he(p)[0])}return x})}return{slideRegistry:h}}function jr(t,s,r,n,o){const{reachedAny:l,removeOffset:a,constrain:d}=n;function c(x){return x.concat().sort((w,p)=>Q(w)-Q(p))[0]}function h(x){const w=t?a(x):d(x),p=s.map((u,g)=>({diff:y(u-w,0),index:g})).sort((u,g)=>Q(u.diff)-Q(g.diff)),{index:i}=p[0];return{index:i,distance:w}}function y(x,w){const p=[x,x+r,x-r];if(!t)return x;if(!w)return c(p);const i=p.filter(u=>kt(u)===w);return i.length?c(i):he(p)-r}function f(x,w){const p=s[x]-o.get(),i=y(p,w);return{index:x,distance:i}}function v(x,w){const p=o.get()+x,{index:i,distance:u}=h(p),g=!t&&l(p);if(!w||g)return{index:i,distance:x};const j=s[i]-u,N=x+y(j,0);return{index:i,distance:N}}return{byDistance:v,byIndex:f,shortcut:y}}function Nr(t,s,r,n,o,l,a){function d(f){const v=f.distance,S=f.index!==s.get();l.add(v),v&&(n.duration()?t.start():(t.update(),t.render(1),t.update())),S&&(r.set(s.get()),s.set(f.index),a.emit("select"))}function c(f,v){const S=o.byDistance(f,v);d(S)}function h(f,v){const S=s.clone().set(f),x=o.byIndex(S.get(),v);d(x)}return{distance:c,index:h}}function Sr(t,s,r,n,o,l,a,d){const c={passive:!0,capture:!0};let h=0;function y(S){if(!d)return;function x(w){if(new Date().getTime()-h>10)return;a.emit("slideFocusStart"),t.scrollLeft=0;const u=r.findIndex(g=>g.includes(w));Ct(u)&&(o.useDuration(0),n.index(u,0),a.emit("slideFocus"))}l.add(document,"keydown",f,!1),s.forEach((w,p)=>{l.add(w,"focus",i=>{(Je(d)||d(S,i))&&x(p)},c)})}function f(S){S.code==="Tab"&&(h=new Date().getTime())}return{init:y}}function Me(t){let s=t;function r(){return s}function n(c){s=a(c)}function o(c){s+=a(c)}function l(c){s-=a(c)}function a(c){return Ct(c)?c:c.get()}return{get:r,set:n,add:o,subtract:l}}function Is(t,s){const r=t.scroll==="x"?l:a,n=s.style;let o=!1;function l(f){return`translate3d(${f}px,0px,0px)`}function a(f){return`translate3d(0px,${f}px,0px)`}function d(f){o||(n.transform=r(t.direction(f)))}function c(f){o=!f}function h(){o||(n.transform="",s.getAttribute("style")||s.removeAttribute("style"))}return{clear:h,to:d,toggleActive:c}}function Cr(t,s,r,n,o,l,a,d,c){const y=Ie(o),f=Ie(o).reverse(),v=i().concat(u());function S(k,C){return k.reduce((M,L)=>M-o[L],C)}function x(k,C){return k.reduce((M,L)=>S(M,C)>0?M.concat([L]):M,[])}function w(k){return l.map((C,M)=>({start:C-n[M]+.5+k,end:C+s-.5+k}))}function p(k,C,M){const L=w(C);return k.map(A=>{const _=M?0:-r,P=M?r:0,V=M?"end":"start",T=L[A][V];return{index:A,loopPoint:T,slideLocation:Me(-1),translate:Is(t,c[A]),target:()=>d.get()>T?_:P}})}function i(){const k=a[0],C=x(f,k);return p(C,r,!1)}function u(){const k=s-a[0]-1,C=x(y,k);return p(C,-r,!0)}function g(){return v.every(({index:k})=>{const C=y.filter(M=>M!==k);return S(C,s)<=.1})}function j(){v.forEach(k=>{const{target:C,translate:M,slideLocation:L}=k,A=C();A!==L.get()&&(M.to(A),L.set(A))})}function N(){v.forEach(k=>k.translate.clear())}return{canLoop:g,clear:N,loop:j,loopPoints:v}}function kr(t,s,r){let n,o=!1;function l(c){if(!r)return;function h(y){for(const f of y)if(f.type==="childList"){c.reInit(),s.emit("slidesChanged");break}}n=new MutationObserver(y=>{o||(Je(r)||r(c,y))&&h(y)}),n.observe(t,{childList:!0})}function a(){n&&n.disconnect(),o=!0}return{init:l,destroy:a}}function Mr(t,s,r,n){const o={};let l=null,a=null,d,c=!1;function h(){d=new IntersectionObserver(x=>{c||(x.forEach(w=>{const p=s.indexOf(w.target);o[p]=w}),l=null,a=null,r.emit("slidesInView"))},{root:t.parentElement,threshold:n}),s.forEach(x=>d.observe(x))}function y(){d&&d.disconnect(),c=!0}function f(x){return Te(o).reduce((w,p)=>{const i=parseInt(p),{isIntersecting:u}=o[i];return(x&&u||!x&&!u)&&w.push(i),w},[])}function v(x=!0){if(x&&l)return l;if(!x&&a)return a;const w=f(x);return x&&(l=w),x||(a=w),w}return{init:h,destroy:y,get:v}}function Lr(t,s,r,n,o,l){const{measureSize:a,startEdge:d,endEdge:c}=t,h=r[0]&&o,y=x(),f=w(),v=r.map(a),S=p();function x(){if(!h)return 0;const u=r[0];return Q(s[d]-u[d])}function w(){if(!h)return 0;const u=l.getComputedStyle(he(n));return parseFloat(u.getPropertyValue(`margin-${c}`))}function p(){return r.map((u,g,j)=>{const N=!g,b=Mt(j,g);return N?v[g]+y:b?v[g]+f:j[g+1][d]-u[d]}).map(Q)}return{slideSizes:v,slideSizesWithGaps:S,startGap:y,endGap:f}}function Er(t,s,r,n,o,l,a,d,c){const{startEdge:h,endEdge:y,direction:f}=t,v=Ct(r);function S(i,u){return Ie(i).filter(g=>g%u===0).map(g=>i.slice(g,g+u))}function x(i){return i.length?Ie(i).reduce((u,g,j)=>{const N=he(u)||0,b=N===0,k=g===_e(i),C=o[h]-l[N][h],M=o[h]-l[g][y],L=!n&&b?f(a):0,A=!n&&k?f(d):0,_=Q(M-A-(C+L));return j&&_>s+c&&u.push(g),k&&u.push(i.length),u},[]).map((u,g,j)=>{const N=Math.max(j[g-1]||0);return i.slice(N,u)}):[]}function w(i){return v?S(i,r):x(i)}return{groupSlides:w}}function Ar(t,s,r,n,o,l,a){const{align:d,axis:c,direction:h,startIndex:y,loop:f,duration:v,dragFree:S,dragThreshold:x,inViewThreshold:w,slidesToScroll:p,skipSnaps:i,containScroll:u,watchResize:g,watchSlides:j,watchDrag:N,watchFocus:b}=l,k=2,C=ur(),M=C.measure(s),L=r.map(C.measure),A=lr(c,h),_=A.measureSize(M),P=mr(_),V=ir(d,_),T=!f&&!!u,I=f||!!u,{slideSizes:R,slideSizesWithGaps:z,startGap:H,endGap:ee}=Lr(A,M,L,r,I,o),X=Er(A,_,p,f,M,L,H,ee,k),{snaps:te,snapsAligned:K}=br(A,V,M,L,X),F=-he(te)+he(z),{snapsContained:B,scrollContainLimit:U}=pr(_,F,K,u,k),D=T?B:K,{limit:W}=xr(F,D,f),ae=As(_e(D),y,f),Z=ae.clone(),J=Ie(r),$=({dragHandler:we,scrollBody:tt,scrollBounds:st,options:{loop:Re}},at)=>{Re||st.constrain(we.pointerDown()),tt.seek(at)},G=({scrollBody:we,translate:tt,location:st,offsetLocation:Re,scrollLooper:at,slideLooper:qs,dragHandler:Bs,animation:zs,eventHandler:Pt,scrollBounds:Ys,options:{loop:Dt}},$t)=>{const _t=we.settled(),Ws=!Ys.shouldConstrain(),Rt=Dt?_t:_t&&Ws;Rt&&!Bs.pointerDown()&&(zs.stop(),Pt.emit("settle")),Rt||Pt.emit("scroll");const Gs=st.get()*$t+fe.get()*(1-$t);Re.set(Gs),Dt&&(at.loop(we.direction()),qs.loop()),tt.to(Re.get())},se=or(n,o,we=>$(et,we),we=>G(et,we)),re=.68,le=D[ae.get()],ue=Me(le),fe=Me(le),ge=Me(le),q=Me(le),ie=fr(ue,ge,fe,q,v,re),xe=jr(f,D,F,W,q),Qe=Nr(se,ae,Z,ie,xe,q,a),At=wr(W),It=Pe(),Vs=Mr(s,r,a,w),{slideRegistry:Tt}=yr(T,u,D,U,X,J),Us=Sr(t,r,Tt,Qe,ie,It,a,b),et={ownerDocument:n,ownerWindow:o,eventHandler:a,containerRect:M,slideRects:L,animation:se,axis:A,dragHandler:cr(A,t,n,o,q,dr(A,o),ue,se,Qe,ie,xe,ae,a,P,S,x,i,re,N),eventStore:It,percentOfView:P,index:ae,indexPrevious:Z,limit:W,location:ue,offsetLocation:ge,previousLocation:fe,options:l,resizeHandler:hr(s,a,o,r,A,g,C),scrollBody:ie,scrollBounds:gr(W,ge,q,ie,P),scrollLooper:vr(F,W,ge,[ue,ge,fe,q]),scrollProgress:At,scrollSnapList:D.map(At.get),scrollSnaps:D,scrollTarget:xe,scrollTo:Qe,slideLooper:Cr(A,_,F,R,z,te,D,ge,r),slideFocus:Us,slidesHandler:kr(s,a,j),slidesInView:Vs,slideIndexes:J,slideRegistry:Tt,slidesToScroll:X,target:q,translate:Is(A,s)};return et}function Ir(){let t={},s;function r(h){s=h}function n(h){return t[h]||[]}function o(h){return n(h).forEach(y=>y(s,h)),c}function l(h,y){return t[h]=n(h).concat([y]),c}function a(h,y){return t[h]=n(h).filter(f=>f!==y),c}function d(){t={}}const c={init:r,emit:o,off:a,on:l,clear:d};return c}const Tr={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function Pr(t){function s(l,a){return Es(l,a||{})}function r(l){const a=l.breakpoints||{},d=Te(a).filter(c=>t.matchMedia(c).matches).map(c=>a[c]).reduce((c,h)=>s(c,h),{});return s(l,d)}function n(l){return l.map(a=>Te(a.breakpoints||{})).reduce((a,d)=>a.concat(d),[]).map(t.matchMedia)}return{mergeOptions:s,optionsAtMedia:r,optionsMediaQueries:n}}function Dr(t){let s=[];function r(l,a){return s=a.filter(({options:d})=>t.optionsAtMedia(d).active!==!1),s.forEach(d=>d.init(l,t)),a.reduce((d,c)=>Object.assign(d,{[c.name]:c}),{})}function n(){s=s.filter(l=>l.destroy())}return{init:r,destroy:n}}function Ge(t,s,r){const n=t.ownerDocument,o=n.defaultView,l=Pr(o),a=Dr(l),d=Pe(),c=Ir(),{mergeOptions:h,optionsAtMedia:y,optionsMediaQueries:f}=l,{on:v,off:S,emit:x}=c,w=A;let p=!1,i,u=h(Tr,Ge.globalOptions),g=h(u),j=[],N,b,k;function C(){const{container:J,slides:$}=g;b=(ut(J)?t.querySelector(J):J)||t.children[0];const se=ut($)?b.querySelectorAll($):$;k=[].slice.call(se||b.children)}function M(J){const $=Ar(t,b,k,n,o,J,c);if(J.loop&&!$.slideLooper.canLoop()){const G=Object.assign({},J,{loop:!1});return M(G)}return $}function L(J,$){p||(u=h(u,J),g=y(u),j=$||j,C(),i=M(g),f([u,...j.map(({options:G})=>G)]).forEach(G=>d.add(G,"change",A)),g.active&&(i.translate.to(i.location.get()),i.animation.init(),i.slidesInView.init(),i.slideFocus.init(Z),i.eventHandler.init(Z),i.resizeHandler.init(Z),i.slidesHandler.init(Z),i.options.loop&&i.slideLooper.loop(),b.offsetParent&&k.length&&i.dragHandler.init(Z),N=a.init(Z,j)))}function A(J,$){const G=X();_(),L(h({startIndex:G},J),$),c.emit("reInit")}function _(){i.dragHandler.destroy(),i.eventStore.clear(),i.translate.clear(),i.slideLooper.clear(),i.resizeHandler.destroy(),i.slidesHandler.destroy(),i.slidesInView.destroy(),i.animation.destroy(),a.destroy(),d.clear()}function P(){p||(p=!0,d.clear(),_(),c.emit("destroy"),c.clear())}function V(J,$,G){!g.active||p||(i.scrollBody.useBaseFriction().useDuration($===!0?0:g.duration),i.scrollTo.index(J,G||0))}function T(J){const $=i.index.add(1).get();V($,J,-1)}function I(J){const $=i.index.add(-1).get();V($,J,1)}function R(){return i.index.add(1).get()!==X()}function z(){return i.index.add(-1).get()!==X()}function H(){return i.scrollSnapList}function ee(){return i.scrollProgress.get(i.location.get())}function X(){return i.index.get()}function te(){return i.indexPrevious.get()}function K(){return i.slidesInView.get()}function F(){return i.slidesInView.get(!1)}function B(){return N}function U(){return i}function D(){return t}function W(){return b}function ae(){return k}const Z={canScrollNext:R,canScrollPrev:z,containerNode:W,internalEngine:U,destroy:P,off:S,on:v,emit:x,plugins:B,previousScrollSnap:te,reInit:w,rootNode:D,scrollNext:T,scrollPrev:I,scrollProgress:ee,scrollSnapList:H,scrollTo:V,selectedScrollSnap:X,slideNodes:ae,slidesInView:K,slidesNotInView:F};return L(s,r),setTimeout(()=>c.emit("init"),0),Z}Ge.globalOptions=void 0;function Lt(t={},s=[]){const r=m.useRef(t),n=m.useRef(s),[o,l]=m.useState(),[a,d]=m.useState(),c=m.useCallback(()=>{o&&o.reInit(r.current,n.current)},[o]);return m.useEffect(()=>{St(r.current,t)||(r.current=t,c())},[t,c]),m.useEffect(()=>{rr(n.current,s)||(n.current=s,c())},[s,c]),m.useEffect(()=>{if(ar()&&a){Ge.globalOptions=Lt.globalOptions;const h=Ge(a,r.current,n.current);return l(h),()=>h.destroy()}else l(void 0)},[a,l]),[d,o]}Lt.globalOptions=void 0;const Ts=m.createContext(null);function Xe(){const t=m.useContext(Ts);if(!t)throw new Error("useCarousel must be used within a <Carousel />");return t}const Ps=m.forwardRef(({orientation:t="horizontal",opts:s,setApi:r,plugins:n,className:o,children:l,...a},d)=>{const[c,h]=Lt({...s,axis:t==="horizontal"?"x":"y"},n),[y,f]=m.useState(!1),[v,S]=m.useState(!1),x=m.useCallback(u=>{u&&(f(u.canScrollPrev()),S(u.canScrollNext()))},[]),w=m.useCallback(()=>{h?.scrollPrev()},[h]),p=m.useCallback(()=>{h?.scrollNext()},[h]),i=m.useCallback(u=>{u.key==="ArrowLeft"?(u.preventDefault(),w()):u.key==="ArrowRight"&&(u.preventDefault(),p())},[w,p]);return m.useEffect(()=>{!h||!r||r(h)},[h,r]),m.useEffect(()=>{if(h)return x(h),h.on("reInit",x),h.on("select",x),()=>{h?.off("select",x)}},[h,x]),e.jsx(Ts.Provider,{value:{carouselRef:c,api:h,opts:s,orientation:t||(s?.axis==="y"?"vertical":"horizontal"),scrollPrev:w,scrollNext:p,canScrollPrev:y,canScrollNext:v},children:e.jsx("div",{ref:d,onKeyDownCapture:i,className:de("relative",o),role:"region","aria-roledescription":"carousel",...a,children:l})})});Ps.displayName="Carousel";const Ds=m.forwardRef(({className:t,...s},r)=>{const{carouselRef:n,orientation:o}=Xe();return e.jsx("div",{ref:n,className:"overflow-hidden",children:e.jsx("div",{ref:r,className:de("flex",o==="horizontal"?"-ml-4":"-mt-4 flex-col",t),...s})})});Ds.displayName="CarouselContent";const $s=m.forwardRef(({className:t,...s},r)=>{const{orientation:n}=Xe();return e.jsx("div",{ref:r,role:"group","aria-roledescription":"slide",className:de("min-w-0 shrink-0 grow-0 basis-full",n==="horizontal"?"pl-4":"pt-4",t),...s})});$s.displayName="CarouselItem";const _s=m.forwardRef(({className:t,variant:s="outline",size:r="icon",...n},o)=>{const{orientation:l,scrollPrev:a,canScrollPrev:d}=Xe();return e.jsxs(O,{ref:o,variant:s,size:r,className:de("absolute  h-8 w-8 rounded-full",l==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!d,onClick:a,...n,children:[e.jsx(la,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Previous slide"})]})});_s.displayName="CarouselPrevious";const Rs=m.forwardRef(({className:t,variant:s="outline",size:r="icon",...n},o)=>{const{orientation:l,scrollNext:a,canScrollNext:d}=Xe();return e.jsxs(O,{ref:o,variant:s,size:r,className:de("absolute h-8 w-8 rounded-full",l==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!d,onClick:a,...n,children:[e.jsx(ca,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Next slide"})]})});Rs.displayName="CarouselNext";const Gt=({files:t,onFilesChange:s,maxFiles:r=10,allowedTypes:n=["image/*","video/*"]})=>{const[o,l]=m.useState(!1);m.useState({});const[a,d]=m.useState({}),c=m.useRef(null),h=g=>g.size>50*1024*1024?(E({title:"File too large",description:"Please select files under 50MB",variant:"destructive"}),!1):n.some(N=>g.type.match(N.replace("*",".*")))?!0:(E({title:"Invalid file type",description:"Please select images or videos only",variant:"destructive"}),!1),y=g=>new Promise(j=>{const N=new FileReader;N.onload=()=>j(N.result),N.readAsDataURL(g)}),f=async g=>{const N=Array.from(g).filter(h);if(t.length+N.length>r){E({title:"Too many files",description:`Maximum ${r} files allowed`,variant:"destructive"});return}const b={};for(const k of N){const C=await y(k);b[k.name]=C}d(k=>({...k,...b})),s([...t,...N])},v=g=>{const j=t[g],N=t.filter((b,k)=>k!==g);if(a[j.name]){URL.revokeObjectURL(a[j.name]);const b={...a};delete b[j.name],d(b)}s(N)},S=m.useCallback(g=>{g.preventDefault(),l(!0)},[]),x=m.useCallback(g=>{g.preventDefault(),l(!1)},[]),w=m.useCallback(g=>{g.preventDefault(),l(!1),f(g.dataTransfer.files)},[t,r]),p=()=>{c.current?.click()},i=g=>{if(g===0)return"0 Bytes";const j=1024,N=["Bytes","KB","MB","GB"],b=Math.floor(Math.log(g)/Math.log(j));return parseFloat((g/Math.pow(j,b)).toFixed(2))+" "+N[b]},u=g=>g.type.startsWith("video/")?e.jsx(pe,{className:"h-4 w-4"}):e.jsx(is,{className:"h-4 w-4"});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors cursor-pointer ${o?"border-primary bg-primary/5":"border-gray-300 hover:border-primary/50"}`,onDragOver:S,onDragLeave:x,onDrop:w,onClick:p,children:[e.jsx("input",{ref:c,type:"file",multiple:!0,accept:n.join(","),onChange:g=>g.target.files&&f(g.target.files),className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-full",children:e.jsx(da,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:o?"Drop files here":"Upload Media"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Drag & drop or click to select photos and videos"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Up to ",r," files, 50MB each"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(O,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"Camera"]}),e.jsxs(O,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(ua,{className:"h-4 w-4"}),"Gallery"]})]})]})]}),t.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium",children:["Selected Media (",t.length,"/",r,")"]}),t.length>1&&e.jsxs(be,{variant:"secondary",className:"gap-1",children:[e.jsx(rs,{className:"h-3 w-3"}),"Carousel"]})]}),t.length===1?e.jsxs(oe,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[a[t[0].name]&&e.jsx("div",{className:"aspect-video bg-black flex items-center justify-center",children:t[0].type.startsWith("video/")?e.jsx("video",{src:a[t[0].name],className:"max-h-full max-w-full",controls:!0}):e.jsx("img",{src:a[t[0].name],alt:"Preview",className:"max-h-full max-w-full object-contain"})}),e.jsxs("div",{className:"absolute top-2 right-2 flex space-x-2",children:[e.jsx(O,{size:"sm",variant:"secondary",className:"h-8 w-8 p-0",onClick:()=>{},children:e.jsx(it,{className:"h-3 w-3"})}),e.jsx(O,{size:"sm",variant:"destructive",className:"h-8 w-8 p-0",onClick:()=>v(0),children:e.jsx(ve,{className:"h-3 w-3"})})]})]}),e.jsx(me,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[u(t[0]),e.jsx("span",{className:"truncate",children:t[0].name})]}),e.jsx("span",{className:"text-muted-foreground",children:i(t[0].size)})]})})]}):e.jsxs(Ps,{className:"w-full",children:[e.jsx(Ds,{className:"-ml-2",children:t.map((g,j)=>e.jsx($s,{className:"pl-2 basis-1/2 sm:basis-1/3",children:e.jsx(oe,{className:"overflow-hidden",children:e.jsxs("div",{className:"relative aspect-square bg-black flex items-center justify-center",children:[a[g.name]&&e.jsx(e.Fragment,{children:g.type.startsWith("video/")?e.jsx("video",{src:a[g.name],className:"w-full h-full object-cover"}):e.jsx("img",{src:a[g.name],alt:"Preview",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx(O,{size:"sm",variant:"destructive",className:"h-6 w-6 p-0",onClick:()=>v(j),children:e.jsx(ve,{className:"h-2 w-2"})})}),e.jsx("div",{className:"absolute bottom-1 left-1",children:u(g)})]})})},g.name))}),e.jsx(_s,{}),e.jsx(Rs,{})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(O,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(it,{className:"h-4 w-4"}),"Edit"]}),e.jsxs(O,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(ma,{className:"h-4 w-4"}),"Crop"]}),e.jsxs(O,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(ns,{className:"h-4 w-4"}),"Filter"]})]})]})]})},$r=({position:t,onPositionChange:s,isPinPlaced:r,locationName:n,onLocationNameChange:o,isPrivate:l,onPrivacyChange:a})=>{const[d,c]=m.useState(""),[h,y]=m.useState(!1),[f,v]=m.useState([{id:"1",name:"Central Park",category:"Park",distance:"0.2 miles",coordinates:{lat:40.785091,lng:-73.968285}},{id:"2",name:"Times Square",category:"Tourist Attraction",distance:"1.5 miles",coordinates:{lat:40.758896,lng:-73.98513}},{id:"3",name:"Brooklyn Bridge",category:"Landmark",distance:"3.2 miles",coordinates:{lat:40.706086,lng:-73.996864}}]),[S,x]=m.useState(""),[w,p]=m.useState(!1),i=m.useCallback(()=>{if(!navigator.geolocation){E({title:"Geolocation not supported",description:"Your browser doesn't support geolocation",variant:"destructive"});return}navigator.geolocation.getCurrentPosition(b=>{const k={lat:b.coords.latitude,lng:b.coords.longitude};s(k),o("Current Location"),E({title:"Location found",description:"Using your current location"})},b=>{console.error("Geolocation error:",b),E({title:"Location access denied",description:"Please enable location services to use this feature",variant:"destructive"})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},[s,o]),u=m.useCallback(async b=>{b.trim()&&(y(!0),setTimeout(()=>{y(!1),b.toLowerCase().includes("coffee")&&v(k=>[{id:"search-1",name:"Starbucks Coffee",category:"Coffee Shop",distance:"0.1 miles",coordinates:{lat:40.7589,lng:-73.9851}},...k.slice(0,2)])},1e3))},[]),g=b=>{s(b.coordinates),o(b.name),E({title:"Location selected",description:`Selected ${b.name}`})},j=()=>{S.trim()&&t&&(o(S),p(!1),x(""),E({title:"Custom location set",description:`Location named "${S}"`}))},N=b=>`${b.lat.toFixed(6)}, ${b.lng.toFixed(6)}`;return e.jsxs("div",{className:"space-y-4",children:[e.jsx(oe,{className:`border-2 ${r?"border-green-200 bg-green-50":"border-orange-200 bg-orange-50"}`,children:e.jsx(me,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-full ${r?"bg-green-100":"bg-orange-100"}`,children:e.jsx(ne,{className:`h-4 w-4 ${r?"text-green-600":"text-orange-600"}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r?n||"Location Selected":"Select Location"}),t&&e.jsx("p",{className:"text-xs text-muted-foreground",children:N(t)})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:r&&e.jsx(be,{variant:"secondary",className:"gap-1",children:l?e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"h-3 w-3"}),"Private"]}):e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"h-3 w-3"}),"Public"]})})})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(O,{variant:"outline",className:"gap-2",onClick:i,children:[e.jsx($e,{className:"h-4 w-4"}),"Use Current"]}),e.jsxs(O,{variant:"outline",className:"gap-2",onClick:()=>E({title:"Map selector",description:"Click on the map to place a pin"}),children:[e.jsx(ha,{className:"h-4 w-4"}),"Place Pin"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"location-search",children:"Search Places"}),e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{id:"location-search",placeholder:"Search for restaurants, parks, landmarks...",value:d,onChange:b=>c(b.target.value),onKeyPress:b=>b.key==="Enter"&&u(d),className:"pl-10"})]}),h&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Searching..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{children:"Suggested Locations"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:f.map(b=>e.jsx(oe,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>g(b),children:e.jsx(me,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-1 bg-primary/10 rounded",children:e.jsx(ne,{className:"h-3 w-3 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:b.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[b.category," ‚Ä¢ ",b.distance]})]})]}),e.jsx(O,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",children:e.jsx(ne,{className:"h-3 w-3"})})]})})},b.id))})]}),r&&e.jsx("div",{className:"space-y-3",children:w?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"custom-location",children:"Custom Location Name"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Ce,{id:"custom-location",placeholder:"Enter custom location name...",value:S,onChange:b=>x(b.target.value),onKeyPress:b=>b.key==="Enter"&&j()}),e.jsx(O,{size:"sm",onClick:j,disabled:!S.trim(),children:"Save"})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ce,{children:"Location Name"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n||"Unnamed Location"})]}),e.jsxs(O,{size:"sm",variant:"outline",onClick:()=>p(!0),className:"gap-2",children:[e.jsx(it,{className:"h-3 w-3"}),"Edit"]})]})}),r&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[l?e.jsx(fa,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(Ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx(ce,{htmlFor:"location-privacy",children:"Hide precise location"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l?"Others will see general area only":"Others will see exact location"})]})]}),e.jsx(Nt,{id:"location-privacy",checked:l,onCheckedChange:a})]}),t&&e.jsxs(oe,{children:[e.jsx(bt,{className:"pb-3",children:e.jsxs(yt,{className:"text-sm flex items-center gap-2",children:[e.jsx(ga,{className:"h-4 w-4"}),"Location Preview"]})}),e.jsx(me,{className:"p-0",children:e.jsx("div",{className:"h-32 bg-muted flex items-center justify-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Map preview for ",N(t)]})})})]})]})},_r=({onStreamStart:t,onStreamEnd:s,isStreaming:r})=>{const[n,o]=m.useState(""),[l,a]=m.useState(""),[d,c]=m.useState("720p"),[h,y]=m.useState(!0),[f,v]=m.useState(!0),[S,x]=m.useState(0),[w,p]=m.useState(0),[i,u]=m.useState("disconnected"),[g,j]=m.useState(0),N=m.useRef(null),b=m.useRef(null),k=m.useRef(null);m.useEffect(()=>()=>{b.current&&b.current.getTracks().forEach(T=>T.stop()),k.current&&clearInterval(k.current)},[]);const C=async()=>{if(!n.trim()){E({title:"Stream title required",description:"Please enter a title for your live stream",variant:"destructive"});return}try{u("connecting");const T=await navigator.mediaDevices.getUserMedia({video:{width:d==="1080p"?1920:d==="720p"?1280:640,height:d==="1080p"?1080:d==="720p"?720:480,frameRate:30},audio:h});b.current=T,N.current&&(N.current.srcObject=T,N.current.play()),p(0),k.current=setInterval(()=>{p(R=>R+1)},1e3);const I=setInterval(()=>{x(R=>Math.max(0,R+Math.floor(Math.random()*3)-1))},5e3);return u("connected"),j(Math.floor(Math.random()*1e3)+500),t({title:n,description:l,quality:d,stream:T}),E({title:"Live stream started!",description:"You're now broadcasting live"}),()=>clearInterval(I)}catch(T){console.error("Stream start error:",T),u("disconnected"),E({title:"Failed to start stream",description:"Please check camera and microphone permissions",variant:"destructive"})}},M=()=>{b.current&&(b.current.getTracks().forEach(T=>T.stop()),b.current=null),N.current&&(N.current.srcObject=null),k.current&&(clearInterval(k.current),k.current=null),u("disconnected"),j(0),s(),E({title:"Stream ended",description:`Your live stream lasted ${_(w)}`})},L=async()=>{b.current&&(b.current.getAudioTracks().forEach(I=>{I.enabled=!h}),y(!h))},A=async()=>{b.current&&(b.current.getVideoTracks().forEach(I=>{I.enabled=!f}),v(!f))},_=T=>{const I=Math.floor(T/3600),R=Math.floor(T%3600/60),z=T%60;return I>0?`${I}:${R.toString().padStart(2,"0")}:${z.toString().padStart(2,"0")}`:`${R}:${z.toString().padStart(2,"0")}`},P=()=>{switch(i){case"connected":return e.jsx(xa,{className:"h-4 w-4 text-green-500"});case"connecting":return e.jsx(Ft,{className:"h-4 w-4 text-yellow-500 animate-pulse"});default:return e.jsx(pa,{className:"h-4 w-4 text-red-500"})}},V=()=>{switch(i){case"connected":return"bg-green-500";case"connecting":return"bg-yellow-500";default:return"bg-gray-500"}};return r?e.jsxs("div",{className:"space-y-4",children:[e.jsx(oe,{className:"border-red-200 bg-red-50",children:e.jsx(me,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full animate-pulse ${V()}`}),e.jsx("span",{className:"text-red-600 font-semibold",children:"LIVE"})]}),e.jsx("div",{className:"text-sm text-red-600",children:_(w)})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:S})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[P(),e.jsxs("span",{children:[g," kbps"]})]})]})]})})}),e.jsx(oe,{children:e.jsx(me,{className:"p-0",children:e.jsxs("div",{className:"relative aspect-video bg-black rounded-md overflow-hidden",children:[e.jsx("video",{ref:N,className:"w-full h-full object-cover",autoPlay:!0,muted:!0,playsInline:!0}),e.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(O,{size:"sm",variant:h?"secondary":"destructive",onClick:L,className:"h-10 w-10 p-0",children:h?e.jsx(Ye,{className:"h-4 w-4"}):e.jsx(ot,{className:"h-4 w-4"})}),e.jsx(O,{size:"sm",variant:f?"secondary":"destructive",onClick:A,className:"h-10 w-10 p-0",children:f?e.jsx(pe,{className:"h-4 w-4"}):e.jsx(We,{className:"h-4 w-4"})})]}),e.jsxs(O,{size:"sm",variant:"destructive",onClick:M,className:"gap-2",children:[e.jsx(xt,{className:"h-4 w-4"}),"End Stream"]})]})}),e.jsx("div",{className:"absolute top-4 left-4 right-4",children:e.jsxs("div",{className:"bg-black/50 backdrop-blur-sm rounded-lg p-3 text-white",children:[e.jsx("h3",{className:"font-semibold truncate",children:n}),l&&e.jsx("p",{className:"text-sm opacity-90 truncate",children:l})]})})]})})}),e.jsx(oe,{children:e.jsx(me,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-center space-x-1 text-2xl font-bold",children:[e.jsx(ke,{className:"h-5 w-5"}),S]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Viewers"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-center space-x-1 text-2xl font-bold",children:[e.jsx(je,{className:"h-5 w-5"}),_(w)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Duration"})]})]})})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(oe,{children:[e.jsx(bt,{children:e.jsxs(yt,{className:"text-lg flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5 text-red-500"}),"Go Live"]})}),e.jsxs(me,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"stream-title",children:"Stream Title *"}),e.jsx(Ce,{id:"stream-title",placeholder:"What's happening?",value:n,onChange:T=>o(T.target.value),maxLength:100}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.length,"/100 characters"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"stream-description",children:"Description (Optional)"}),e.jsx(Ce,{id:"stream-description",placeholder:"Tell viewers what to expect...",value:l,onChange:T=>a(T.target.value),maxLength:200})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"stream-quality",children:"Quality"}),e.jsxs(Oa,{value:d,onValueChange:c,children:[e.jsx(Fa,{children:e.jsx(Va,{})}),e.jsxs(Ua,{children:[e.jsx(rt,{value:"480p",children:"480p (Standard)"}),e.jsx(rt,{value:"720p",children:"720p (HD)"}),e.jsx(rt,{value:"1080p",children:"1080p (Full HD)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{children:"Camera Preview"}),e.jsx("div",{className:"aspect-video bg-black rounded-md flex items-center justify-center",children:e.jsx("video",{ref:N,className:"w-full h-full object-cover rounded-md",autoPlay:!0,muted:!0,playsInline:!0})})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(O,{onClick:C,className:"bg-red-500 hover:bg-red-600 text-white px-8",disabled:i==="connecting",children:i==="connecting"?e.jsxs(e.Fragment,{children:[e.jsx(Ft,{className:"h-4 w-4 mr-2 animate-pulse"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Start Live Stream"]})})})]})]}),e.jsx(oe,{children:e.jsx(me,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-around",children:[e.jsxs(O,{variant:h?"default":"outline",size:"sm",onClick:()=>y(!h),className:"gap-2",children:[h?e.jsx(Ye,{className:"h-4 w-4"}):e.jsx(ot,{className:"h-4 w-4"}),"Audio"]}),e.jsxs(O,{variant:f?"default":"outline",size:"sm",onClick:()=>v(!f),className:"gap-2",children:[f?e.jsx(pe,{className:"h-4 w-4"}):e.jsx(We,{className:"h-4 w-4"}),"Video"]}),e.jsxs(O,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(pt,{className:"h-4 w-4"}),"Settings"]})]})})})]})},nt=({content:t,onContentChange:s,placeholder:r="What's happening here?",maxLength:n=500,onHashtagsChange:o,onMentionsChange:l,showFormatting:a=!0})=>{const[d,c]=m.useState(!1),[h,y]=m.useState(!1),[f,v]=m.useState([]),[S,x]=m.useState(!1),[w,p]=m.useState(0),i=m.useRef(null),u=["üòÄ","üòÇ","‚ù§Ô∏è","üëç","üî•","üéâ","üòç","ü§î","üòé","üíØ","üìç","üåü","‚ú®","üôå"],g=["#photography","#travel","#food","#nature","#sunset","#citylife","#weekend"],j=["@john_doe","@jane_smith","@local_explorer","@foodie_friend"],N=I=>{const R=/#[a-zA-Z0-9_]+/g;return I.match(R)||[]},b=I=>{const R=/@[a-zA-Z0-9_]+/g;return I.match(R)||[]},k=I=>{const R=I.target.value;if(R.length<=n){s(R);const z=N(R),H=b(R);o?.(z),l?.(H);const ee=I.target.selectionStart;p(ee);const te=R.substring(0,ee).split(/\s/).pop()||"";if(te.startsWith("#")){const K=te.substring(1).toLowerCase(),F=g.filter(B=>B.toLowerCase().includes(K));v(F),x(F.length>0)}else if(te.startsWith("@")){const K=te.substring(1).toLowerCase(),F=j.filter(B=>B.toLowerCase().includes(K));v(F),x(F.length>0)}else x(!1)}else E({title:"Character limit reached",description:`Maximum ${n} characters allowed`,variant:"destructive"})},C=I=>{if(i.current){const R=i.current,z=R.selectionStart,H=R.selectionEnd,ee=t.substring(0,z)+I+t.substring(H);s(ee),setTimeout(()=>{if(i.current){const X=z+I.length;i.current.setSelectionRange(X,X),i.current.focus()}},0)}},M=I=>{C(I+" "),y(!1)},L=I=>{if(i.current){i.current;const R=t.substring(0,w),z=t.substring(w),H=R.lastIndexOf(" "),ee=H===-1?0:H+1,X=t.substring(0,ee)+I+" "+z;s(X),x(!1),setTimeout(()=>{if(i.current){const te=ee+I.length+1;i.current.setSelectionRange(te,te),i.current.focus()}},0)}},A=()=>{t.trim()&&(localStorage.setItem("message_draft",t),c(!0),E({title:"Draft saved",description:"Your message has been saved as a draft"}))},_=()=>{const I=localStorage.getItem("message_draft");I&&(s(I),E({title:"Draft loaded",description:"Your saved draft has been loaded"}))},P=()=>{localStorage.removeItem("message_draft"),c(!1),E({title:"Draft cleared",description:"Saved draft has been removed"})};m.useEffect(()=>{localStorage.getItem("message_draft")&&!t&&c(!0)},[]);const V=t.length,T=V>n*.8;return e.jsxs("div",{className:"space-y-3",children:[d&&e.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(lt,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-blue-600",children:"Draft available"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(O,{size:"sm",variant:"outline",onClick:_,children:"Load Draft"}),e.jsx(O,{size:"sm",variant:"ghost",onClick:P,children:e.jsx(cs,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(us,{ref:i,value:t,onChange:k,placeholder:r,className:"min-h-[120px] resize-none pr-16 text-base leading-relaxed",rows:6}),e.jsx("div",{className:"absolute bottom-3 right-3",children:e.jsxs(be,{variant:T?"destructive":"secondary",className:"text-xs",children:[V,"/",n]})})]}),S&&f.length>0&&e.jsx(oe,{className:"absolute z-10 w-full max-w-xs",children:e.jsx(me,{className:"p-2",children:e.jsx("div",{className:"space-y-1",children:f.map((I,R)=>e.jsx(O,{variant:"ghost",size:"sm",className:"w-full justify-start text-sm",onClick:()=>L(I),children:I},R))})})}),a&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{size:"sm",variant:"outline",onClick:()=>C("#"),className:"h-8 px-2",children:e.jsx(Vt,{className:"h-3 w-3"})}),e.jsx(O,{size:"sm",variant:"outline",onClick:()=>C("@"),className:"h-8 px-2",children:e.jsx(Ut,{className:"h-3 w-3"})}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{size:"sm",variant:"outline",onClick:()=>y(!h),className:"h-8 px-2",children:e.jsx(va,{className:"h-3 w-3"})}),h&&e.jsx(oe,{className:"absolute bottom-10 left-0 z-10 p-2",children:e.jsx("div",{className:"grid grid-cols-7 gap-1",children:u.map((I,R)=>e.jsx(O,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-lg hover:bg-muted",onClick:()=>M(I),children:I},R))})})]}),e.jsx(O,{size:"sm",variant:"outline",onClick:A,className:"h-8 px-2",disabled:!t.trim(),children:e.jsx(lt,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"flex items-center space-x-3 text-xs text-muted-foreground",children:[N(t).length>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Vt,{className:"h-3 w-3"}),e.jsx("span",{children:N(t).length})]}),b(t).length>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ut,{className:"h-3 w-3"}),e.jsx("span",{children:b(t).length})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(vt,{className:"h-3 w-3"}),e.jsxs("span",{children:[t.split(/\s+/).filter(I=>I.length>0).length," words"]})]})]})]}),(N(t).length>0||b(t).length>0)&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[N(t).map((I,R)=>e.jsx(be,{variant:"secondary",className:"text-xs",children:I},`hashtag-${R}`)),b(t).map((I,R)=>e.jsx(be,{variant:"outline",className:"text-xs",children:I},`mention-${R}`))]})]})},Rr=({onClose:t,initialPosition:s,addMessage:r,updateMessage:n})=>{const{user:o}=De(),[l,a]=m.useState(""),[d,c]=m.useState(!0),[h,y]=m.useState(null),[f,v]=m.useState(null),[S,x]=m.useState(!1),[w,p]=m.useState(s),[i,u]=m.useState(!1),[g,j]=m.useState("text"),[N,b]=m.useState([]),[k,C]=m.useState(""),[M,L]=m.useState([]),[A,_]=m.useState([]),[P,V]=m.useState(!1),[T,I]=m.useState(0),[R,z]=m.useState(!1);m.useEffect(()=>{s&&(p(s),u(!0))},[s]);const H=()=>{if(l.trim()){const K={content:l,activeTab:g,mediaFiles:N,locationName:k,hashtags:M,mentions:A,isPublic:d,position:w,timestamp:Date.now()};localStorage.setItem("lo_draft",JSON.stringify(K)),V(!0),E({title:"Draft saved",description:"Your Lo has been saved as a draft"})}},ee=()=>{localStorage.removeItem("lo_draft"),V(!1)};m.useEffect(()=>{localStorage.getItem("lo_draft")&&!l&&V(!0)},[]),m.useEffect(()=>{I(l.length)},[l]);const X=async K=>{if(K.preventDefault(),!w||!i){E({title:"Location required",description:"Please place and confirm the pin location for your Lo",variant:"destructive"});return}if(!o){E({title:"Authentication required",description:"Please sign in to post a Lo",variant:"destructive"});return}x(!0);try{let F=f,B="text";N.length>0?B=N[0].type.startsWith("video/")?"video":"image":h&&(B=h.type.startsWith("video/")?"video":"image"),g==="live"&&(B="livestream");const{data:U,error:D}=await Y.from("messages").insert({content:l,location:k||"Current Location",user_id:o.id,is_public:d,lat:w.lat,lng:w.lng,media_url:F||null,expires_at:new Date(Date.now()+24*60*60*1e3).toISOString()}).select("*, profiles:user_id(name, username, avatar_url)").single();if(D)throw console.error("‚ùå Database error:",D),D;console.log("‚úÖ Message saved to database:",U);const W={id:`new-${U.id}`,content:U.content,location:U.location,user:{name:U.profiles?.name||o.user_metadata?.full_name||"Current User",avatar:U.profiles?.avatar_url||o.user_metadata?.avatar_url||"/placeholder.svg"},isPublic:U.is_public,timestamp:U.created_at,expiresAt:U.expires_at,mediaUrl:U.media_url||void 0,position:{x:U.lat,y:U.lng},hashtags:M,mentions:A,postType:B,mediaFiles:N.length>0?N.map(Z=>Z.name):void 0};console.log("üìç Adding message to map with position:",W.position),r(W),ee(),setTimeout(()=>{n(W.id,{id:U.id})},2e3),setTimeout(()=>{console.log("üîÑ Triggering message refresh..."),window.dispatchEvent(new CustomEvent("refreshMessages"))},100),E({title:"Lo posted!",description:B==="livestream"?"Your live stream Lo is now active!":N.length>1?`Your Lo with ${N.length} media files has been posted!`:B==="video"?"Your video Lo has been posted!":B==="image"?"Your photo Lo has been posted!":"Your Lo is live on the map!"}),t()}catch(F){console.error("Error posting message:",F),E({title:"Error posting Lo",description:F.message||"Failed to post your Lo. Please try again.",variant:"destructive"})}finally{x(!1)}},te=S||!l.trim()||!i;return e.jsx(oe,{className:"w-full max-w-2xl mx-auto bg-white fade-in",children:e.jsxs("form",{onSubmit:X,children:[e.jsx(bt,{className:"pb-3",children:e.jsxs(yt,{className:"text-xl flex justify-between items-center",children:[e.jsx("span",{children:"Create Lo"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[P&&e.jsxs(be,{variant:"secondary",className:"gap-1",children:[e.jsx(je,{className:"h-3 w-3"}),"Draft"]}),e.jsx(O,{type:"button",variant:"ghost",size:"icon",onClick:t,children:e.jsx(ve,{className:"h-4 w-4"})})]})]})}),e.jsxs(me,{className:"space-y-4",children:[e.jsxs($a,{value:g,onValueChange:j,className:"w-full",children:[e.jsxs(_a,{className:"grid w-full grid-cols-4",children:[e.jsxs(Fe,{value:"text",className:"gap-2",children:[e.jsx(vt,{className:"h-4 w-4"}),"Text"]}),e.jsxs(Fe,{value:"photo",className:"gap-2",children:[e.jsx(is,{className:"h-4 w-4"}),"Photo"]}),e.jsxs(Fe,{value:"video",className:"gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Video"]}),e.jsxs(Fe,{value:"live",className:"gap-2",children:[e.jsx(ze,{className:"h-4 w-4"}),"Live"]})]}),e.jsx(Ve,{value:"text",className:"space-y-4 mt-4",children:e.jsx(nt,{content:l,onContentChange:a,onHashtagsChange:L,onMentionsChange:_,placeholder:"What's happening here?",maxLength:500})}),e.jsx(Ve,{value:"photo",className:"space-y-4 mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(nt,{content:l,onContentChange:a,onHashtagsChange:L,onMentionsChange:_,placeholder:"Add a caption to your photo...",maxLength:300,showFormatting:!1}),e.jsx(Gt,{files:N,onFilesChange:b,maxFiles:10,allowedTypes:["image/*"]})]})}),e.jsx(Ve,{value:"video",className:"space-y-4 mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(nt,{content:l,onContentChange:a,onHashtagsChange:L,onMentionsChange:_,placeholder:"Describe your video...",maxLength:300,showFormatting:!1}),e.jsx(Gt,{files:N,onFilesChange:b,maxFiles:5,allowedTypes:["video/*"]})]})}),e.jsx(Ve,{value:"live",className:"space-y-4 mt-4",children:e.jsx(_r,{onStreamStart:K=>{console.log("Stream started:",K)},onStreamEnd:()=>{console.log("Stream ended")},isStreaming:!1})})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Location"]}),e.jsx(O,{type:"button",variant:"ghost",size:"sm",onClick:()=>z(!R),children:e.jsx(pt,{className:"h-4 w-4"})})]}),R?e.jsx($r,{position:w,onPositionChange:p,isPinPlaced:i,locationName:k,onLocationNameChange:C,isPrivate:!d,onPrivacyChange:K=>c(!K)}):e.jsx(tr,{isPinPlaced:i})]}),!R&&e.jsx(er,{isPublic:d,onToggle:c})]}),e.jsxs(Da,{className:"flex justify-between",children:[e.jsx("div",{className:"flex space-x-2",children:e.jsxs(O,{type:"button",variant:"outline",onClick:H,disabled:!l.trim(),className:"gap-2",children:[e.jsx(lt,{className:"h-4 w-4"}),"Save Draft"]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(O,{type:"button",variant:"outline",onClick:t,children:"Cancel"}),e.jsx(O,{type:"submit",className:`transition-opacity ${!l.trim()||!i?"opacity-50":"opacity-100"}`,disabled:te,children:S?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(wa,{className:"h-4 w-4 mr-2 animate-spin"}),"Posting..."]}):"Post Lo"})]})]})]})})},Or=({onClose:t,initialPosition:s,addMessage:r,updateMessage:n})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx(Rr,{onClose:t,initialPosition:s,addMessage:r,updateMessage:n})}),Fr=({isCreating:t,isInStreetView:s,isPlacingPin:r,newPinPosition:n,userAvatar:o,userName:l,handleClose:a,handleCreateMessage:d,addMessage:c,updateMessage:h})=>e.jsxs(e.Fragment,{children:[r&&!s&&e.jsx(Ga,{isPlacingPin:r}),r&&n&&e.jsx(Ns,{messages:[{id:"new-pin",position:{x:n.lat,y:n.lng},isPublic:!0,user:{avatar:o,name:l||"New"}}],onMessageClick:()=>{}}),t&&n&&e.jsx(Or,{onClose:a,initialPosition:n,addMessage:c,updateMessage:h})]}),Vr=({selectedMessage:t,filteredMessages:s,onMessageClick:r,onClose:n})=>e.jsxs(e.Fragment,{children:[e.jsx(Ns,{messages:s,onMessageClick:r}),t&&(()=>{const o=s.find(l=>l.id===t);return o?e.jsx(Pa,{message:o,onClose:n}):null})()]}),Ze=()=>{const[t,s]=m.useState([]),[r,n]=m.useState(!0),{toast:o}=ea(),{user:l}=De(),a=m.useRef(null);m.useEffect(()=>(d(),c(),()=>{a.current&&Y.removeChannel(a.current)}),[]);const d=async()=>{try{n(!0);const{data:x,error:w}=await Y.from("live_streams").select("*").eq("is_live",!0).order("created_at",{ascending:!1});if(w)throw w;const p=[...new Set(x?.map(j=>j.user_id)||[])],{data:i,error:u}=await Y.from("profiles").select("id, name, username, avatar_url").in("id",p);if(u)throw u;const g=x?.map(j=>({...j,profiles:i?.find(N=>N.id===j.user_id)}))||[];s(g)}catch(x){console.error("Error fetching live streams:",x),o({title:"Error",description:"Failed to load live streams",variant:"destructive"})}finally{n(!1)}},c=()=>{a.current=Y.channel("live-streams-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"live_streams"},x=>{console.log("New live stream:",x),d()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"live_streams"},x=>{console.log("Live stream updated:",x),s(w=>w.map(p=>p.id===x.new.id?{...p,...x.new}:p))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"live_streams"},x=>{console.log("Live stream deleted:",x),s(w=>w.filter(p=>p.id!==x.old.id))}).subscribe()};return{liveStreams:t,isLoading:r,startLiveStream:async x=>{if(!l)return null;try{const{data:w,error:p}=await Y.from("live_streams").insert({user_id:l.id,title:x.title||null,description:x.description||null,start_lat:x.lat,start_lng:x.lng,current_lat:x.lat,current_lng:x.lng}).select().single();if(p)throw p;return o({title:"Success",description:"Live stream started!"}),w.id}catch(w){return console.error("Error starting live stream:",w),o({title:"Error",description:"Failed to start live stream",variant:"destructive"}),null}},updateStreamLocation:async(x,w,p)=>{try{const{error:i}=await Y.rpc("update_live_stream_location",{stream_id_param:x,new_lat:w,new_lng:p});if(i)throw i}catch(i){console.error("Error updating stream location:",i)}},endLiveStream:async x=>{try{const{error:w}=await Y.rpc("end_live_stream",{stream_id_param:x});if(w)throw w;return o({title:"Success",description:"Live stream ended!"}),!0}catch(w){return console.error("Error ending live stream:",w),o({title:"Error",description:"Failed to end live stream",variant:"destructive"}),!1}},joinStreamAsViewer:async x=>{if(!l)return!1;try{const{error:w}=await Y.from("live_stream_viewers").upsert({stream_id:x,viewer_id:l.id,is_active:!0});if(w)throw w;return!0}catch(w){return console.error("Error joining stream:",w),!1}},leaveStreamAsViewer:async x=>{if(!l)return!1;try{const{error:w}=await Y.from("live_stream_viewers").update({is_active:!1,left_at:new Date().toISOString()}).eq("stream_id",x).eq("viewer_id",l.id);if(w)throw w;return!0}catch(w){return console.error("Error leaving stream:",w),!1}},fetchLiveStreams:d}},Ur=({liveStreams:t,onStreamSelect:s,selectedStreamId:r,setSelectedStreamId:n})=>{const{joinStreamAsViewer:o}=Ze(),l=c=>{n(c.id)},a=async c=>{await o(c.id),s(c),n(null)},d=(c,h)=>{const y=document.createElement("canvas"),f=y.getContext("2d"),v=60;if(y.width=v,y.height=v,f){const S=f.createRadialGradient(v/2,v/2,10,v/2,v/2,v/2);S.addColorStop(0,"rgba(59, 130, 246, 0.8)"),S.addColorStop(1,"rgba(59, 130, 246, 0.2)"),f.fillStyle=S,f.beginPath(),f.arc(v/2,v/2,v/2,0,2*Math.PI),f.fill(),f.fillStyle="rgb(59, 130, 246)",f.beginPath(),f.arc(v/2,v/2,20,0,2*Math.PI),f.fill(),f.strokeStyle="white",f.lineWidth=3,f.stroke(),f.fillStyle="red",f.beginPath(),f.arc(v-8,8,6,0,2*Math.PI),f.fill(),f.strokeStyle="white",f.lineWidth=2,f.stroke()}return{url:y.toDataURL(),scaledSize:new google.maps.Size(v,v),anchor:new google.maps.Point(v/2,v/2)}};return e.jsx(e.Fragment,{children:t.map(c=>e.jsxs(ye.Fragment,{children:[e.jsx(gt,{position:{lat:c.current_lat,lng:c.current_lng},icon:d(c.profiles?.avatar_url||void 0,c.profiles?.name||c.profiles?.username||void 0),onClick:()=>l(c),animation:google.maps.Animation.BOUNCE}),r===c.id&&e.jsx(Qs,{position:{lat:c.current_lat,lng:c.current_lng},onCloseClick:()=>n(null),children:e.jsxs("div",{className:"p-3 max-w-xs",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs(ms,{className:"h-12 w-12 ring-2 ring-red-500",children:[e.jsx(hs,{src:c.profiles?.avatar_url||void 0}),e.jsx(fs,{children:c.profiles?.name?.charAt(0)||c.profiles?.username?.charAt(0)||"U"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-sm truncate",children:c.profiles?.name||c.profiles?.username||"Anonymous"}),e.jsx(be,{variant:"destructive",className:"text-xs",children:"LIVE"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"h-3 w-3"}),e.jsx("span",{children:c.viewer_count})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-3 w-3"}),e.jsx("span",{children:gs(new Date(c.created_at),{addSuffix:!1})})]})]})]})]}),c.title&&e.jsx("h4",{className:"font-medium text-sm mb-2 line-clamp-2",children:c.title}),c.description&&e.jsx("p",{className:"text-xs text-gray-600 mb-3 line-clamp-2",children:c.description}),e.jsxs(O,{onClick:()=>a(c),size:"sm",className:"w-full bg-red-500 hover:bg-red-600",children:[e.jsx(Ke,{className:"h-3 w-3 mr-2"}),"Watch Stream"]})]})})]},c.id))})},qr=({stream:t,isOpen:s,onClose:r})=>{const{leaveStreamAsViewer:n}=Ze(),[o,l]=m.useState(!1);m.useEffect(()=>{t&&s&&l(!0)},[t,s]);const a=async()=>{t&&o&&(await n(t.id),l(!1)),r()};return t?e.jsx(ps,{open:s,onOpenChange:a,children:e.jsx(xs,{className:"sm:max-w-4xl h-[80vh] p-0",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(vs,{className:"p-4 border-b flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ms,{className:"h-10 w-10 ring-2 ring-red-500",children:[e.jsx(hs,{src:t.profiles?.avatar_url||void 0}),e.jsx(fs,{children:t.profiles?.name?.charAt(0)||t.profiles?.username?.charAt(0)||"U"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"text-lg",children:t.profiles?.name||t.profiles?.username||"Anonymous"}),e.jsx(be,{variant:"destructive",className:"text-xs",children:"LIVE"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"h-3 w-3"}),e.jsxs("span",{children:[t.viewer_count," viewers"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-3 w-3"}),e.jsx("span",{children:gs(new Date(t.created_at),{addSuffix:!0})})]})]})]})]}),e.jsx(O,{variant:"ghost",size:"icon",onClick:a,children:e.jsx(ve,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1 bg-black flex items-center justify-center",children:e.jsxs("div",{className:"text-white text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-red-500 rounded-full flex items-center justify-center mb-4 mx-auto",children:e.jsx("div",{className:"w-8 h-8 bg-red-500 rounded-full animate-pulse"})}),e.jsx("p",{className:"text-lg font-semibold mb-2",children:"Live Stream"}),e.jsx("p",{className:"text-sm text-gray-300",children:"This is where the actual video stream would appear"}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Video streaming integration would be implemented here"})]})}),e.jsxs("div",{className:"w-80 bg-background border-l p-4 flex flex-col",children:[t.title&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Stream Title"}),e.jsx("p",{className:"text-sm",children:t.title})]}),t.description&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Location Tracking"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Started at:"}),e.jsx("br",{}),e.jsxs("span",{className:"font-mono text-xs",children:[t.start_lat.toFixed(6),", ",t.start_lng.toFixed(6)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Current location:"}),e.jsx("br",{}),e.jsxs("span",{className:"font-mono text-xs",children:[t.current_lat.toFixed(6),", ",t.current_lng.toFixed(6)]})]})]})]}),e.jsx("div",{className:"mt-auto",children:e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Watch the streamer's location update in real-time on the map"})})]})]})]})})}):null},Et=()=>{const t=Zt(),[s,r]=m.useState({lat:34.0522,lng:-118.2437});return m.useEffect(()=>{if(t.state){const{center:n,messageId:o}=t.state;n&&r(n)}},[t.state]),m.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(n=>{t.state?.center||r({lat:n.coords.latitude,lng:n.coords.longitude})},()=>{console.log("Error getting location")})},[t.state]),{userLocation:s}},Br=({isOpen:t,onClose:s})=>{const[r,n]=m.useState(""),[o,l]=m.useState(""),[a,d]=m.useState(!1),[c,h]=m.useState(null),[y,f]=m.useState(0),[v,S]=m.useState(!1),[x,w]=m.useState(""),p=m.useRef(null),i=m.useRef(null),u=m.useRef(null),{userLocation:g}=Et(),{startLiveStream:j,updateStreamLocation:N,endLiveStream:b}=Ze(),k=m.useCallback(P=>{if(!navigator.geolocation){E({title:"Location not supported",description:"Your device doesn't support location tracking",variant:"destructive"});return}const V={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};u.current=navigator.geolocation.watchPosition(T=>{const{latitude:I,longitude:R}=T.coords;N(P,I,R)},T=>{console.error("Location tracking error:",T),E({title:"Location tracking error",description:"Failed to track your location",variant:"destructive"})},V)},[N]),C=m.useCallback(()=>{u.current!==null&&(navigator.geolocation.clearWatch(u.current),u.current=null)},[]),M=async()=>{try{console.log("üé• Testing camera access..."),w("");const P=/iPad|iPhone|iPod/.test(navigator.userAgent);if(console.log("üé• Device type - iOS:",P),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera API not available on this device");const V={video:{width:{ideal:640,max:1280},height:{ideal:480,max:720},facingMode:"user"},audio:!1};console.log("üé• Requesting camera with test constraints:",V);const T=await navigator.mediaDevices.getUserMedia(V);if(console.log("üé• Camera access granted! Stream:",T),console.log("üé• Video tracks:",T.getVideoTracks()),i.current&&i.current.getTracks().forEach(I=>I.stop()),i.current=T,S(!0),p.current){p.current.srcObject=T,P&&(p.current.setAttribute("playsinline","true"),p.current.setAttribute("webkit-playsinline","true"),p.current.muted=!0);try{await p.current.play(),console.log("üé• Video preview started successfully")}catch(I){console.error("üé• Video play error:",I),p.current.muted=!0,p.current.load(),await p.current.play()}}E({title:"Camera connected!",description:"Camera preview is now active"})}catch(P){console.error("üé• Camera test failed:",P),w(P.message||"Camera access failed"),S(!1);let V="Camera access failed";P.name==="NotAllowedError"?V="Camera permission denied. Please enable camera access in iOS Settings > Safari > Camera.":P.name==="NotFoundError"?V="No camera found on this device.":P.name==="NotReadableError"&&(V="Camera is being used by another app. Please close other camera apps and try again."),E({title:"Camera test failed",description:V,variant:"destructive"})}},L=async()=>{try{if(console.log("üìπ Starting live stream - requesting camera access..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera access not supported on this device");const P={video:{width:{ideal:1280,max:1920},height:{ideal:720,max:1080},facingMode:"user",frameRate:{ideal:30,max:30}},audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}};console.log("üìπ Requesting media with constraints:",P);const V=await navigator.mediaDevices.getUserMedia(P);if(console.log("üìπ Media stream obtained:",V),console.log("üìπ Video tracks:",V.getVideoTracks()),console.log("üìπ Audio tracks:",V.getAudioTracks()),i.current=V,p.current){p.current.srcObject=V,p.current.setAttribute("playsinline","true"),p.current.setAttribute("webkit-playsinline","true"),p.current.muted=!0;try{await p.current.play(),console.log("üìπ Video playback started successfully")}catch(I){console.error("üìπ Video play error:",I),p.current.load(),await p.current.play()}}const T=await j({title:r.trim()||void 0,description:o.trim()||void 0,lat:g.lat,lng:g.lng});T&&(h(T),d(!0),k(T),E({title:"Live stream started",description:"You're now live! Your location will be tracked in real-time."}))}catch(P){console.error("üìπ Error starting live stream:",P);let V="Please check your camera and microphone permissions";if(P.name==="NotAllowedError")V="Camera and microphone access denied. Please enable permissions in settings.";else if(P.name==="NotFoundError")V="No camera or microphone found on this device.";else if(P.name==="NotReadableError")V="Camera is being used by another app. Please close other camera apps.";else if(P.name==="OverconstrainedError"){V="Camera doesn't support the required settings. Trying fallback...";try{const T=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});i.current=T,p.current&&(p.current.srcObject=T,p.current.setAttribute("playsinline","true"),p.current.setAttribute("webkit-playsinline","true"),p.current.muted=!0,await p.current.play()),E({title:"Camera started with basic settings",description:"Using fallback camera configuration"});return}catch(T){console.error("üìπ Fallback also failed:",T)}}E({title:"Failed to start stream",description:V,variant:"destructive"})}},A=async()=>{if(c)try{C(),i.current&&(i.current.getTracks().forEach(P=>P.stop()),i.current=null),p.current&&(p.current.srcObject=null),await b(c),d(!1),h(null),n(""),l(""),f(0),E({title:"Stream ended",description:"Your live stream has been ended successfully."}),s()}catch(P){console.error("Error ending stream:",P),E({title:"Error ending stream",description:"There was an issue ending your stream",variant:"destructive"})}},_=()=>{a?A():(i.current&&(i.current.getTracks().forEach(P=>P.stop()),i.current=null),p.current&&(p.current.srcObject=null),n(""),l(""),s())};return m.useEffect(()=>()=>{C(),i.current&&i.current.getTracks().forEach(P=>P.stop())},[C]),e.jsx(ps,{open:t,onOpenChange:_,children:e.jsxs(xs,{className:"sm:max-w-lg",children:[e.jsx(vs,{children:e.jsx(ws,{children:a?"Live Stream Active":"Start Live Stream"})}),e.jsxs("div",{className:"space-y-4",children:[!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"title",children:"Stream Title (optional)"}),e.jsx(Ce,{id:"title",placeholder:"What's happening?",value:r,onChange:P=>n(P.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"description",children:"Description (optional)"}),e.jsx(us,{id:"description",placeholder:"Tell viewers what to expect...",value:o,onChange:P=>l(P.target.value),rows:3})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:"Your location will be tracked and updated in real-time"})]})]}),e.jsxs("div",{className:"relative bg-black rounded-md overflow-hidden",style:{aspectRatio:"16/9"},children:[e.jsx("video",{ref:p,className:"w-full h-full object-cover",autoPlay:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",controls:!1,preload:"none"}),a&&e.jsxs("div",{className:"absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-md text-sm font-medium flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),"LIVE"]}),a&&e.jsxs("div",{className:"absolute top-2 right-2 bg-black/70 text-white px-2 py-1 rounded-md text-sm flex items-center gap-1",children:[e.jsx(ke,{className:"h-3 w-3"}),y]}),!a&&!v&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-white text-center space-y-3",children:[e.jsx(pe,{className:"h-8 w-8 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"Camera preview will appear here"}),x&&e.jsx("p",{className:"text-xs text-red-300 bg-red-900/30 px-2 py-1 rounded",children:x}),e.jsx(O,{onClick:M,size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",children:"Test Camera"})]})}),!a&&v&&i.current&&e.jsx("div",{className:"absolute bottom-2 left-2 bg-green-500/80 text-white px-2 py-1 rounded text-xs",children:"‚úÖ Camera Ready"})]}),e.jsx("div",{className:"flex gap-2",children:a?e.jsxs(O,{onClick:A,variant:"destructive",className:"flex-1",children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"End Stream"]}):e.jsxs(e.Fragment,{children:[e.jsxs(O,{onClick:L,className:"flex-1 bg-red-500 hover:bg-red-600",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Go Live"]}),e.jsx(O,{onClick:_,variant:"outline",children:"Cancel"})]})}),a&&e.jsxs("div",{className:"text-sm text-muted-foreground text-center",children:[e.jsx("p",{children:"Your location is being tracked and shared with viewers"}),e.jsx("p",{children:"Viewers can see your real-time movement on the map"})]})]})]})})},Os=({userLocation:t,onRetry:s,error:r})=>{const n=es.get("GOOGLE_MAPS_API_KEY"),o=n?`https://maps.googleapis.com/maps/api/staticmap?center=${t.lat},${t.lng}&zoom=13&size=600x400&maptype=roadmap&markers=color:red%7C${t.lat},${t.lng}&key=${n}`:null;return e.jsxs("div",{className:"w-full h-full bg-gray-100 relative flex flex-col items-center justify-center",children:[e.jsx("div",{className:"absolute top-4 left-4 right-4 z-20",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ne,{className:"h-5 w-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-800 mb-1",children:"Google Maps Not Available"}),e.jsx("p",{className:"text-xs text-red-700 mb-3",children:r||"Unable to load interactive map. Using fallback view."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{size:"sm",variant:"outline",onClick:s,className:"bg-white border-red-300 text-red-700 hover:bg-red-50",children:[e.jsx(ds,{className:"h-3 w-3 mr-1"}),"Retry"]}),e.jsxs(O,{size:"sm",variant:"outline",onClick:()=>window.open("/diagnostic","_blank"),className:"bg-white border-red-300 text-red-700 hover:bg-red-50",children:[e.jsx(pt,{className:"h-3 w-3 mr-1"}),"Diagnose"]})]})]})]})})}),e.jsx("div",{className:"flex-1 w-full flex items-center justify-center p-4 pt-32",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden max-w-md w-full",children:[e.jsxs("div",{className:"bg-blue-600 text-white p-3 text-center",children:[e.jsx("h4",{className:"font-semibold",children:"Static Map View"}),e.jsxs("p",{className:"text-xs opacity-90",children:["Current Location: ",t.lat.toFixed(4),", ",t.lng.toFixed(4)]})]}),o?e.jsx("img",{src:o,alt:"Static map showing current location",className:"w-full h-64 object-cover",onError:l=>{const a=l.target;a.style.display="none";const d=a.nextElementSibling;d&&(d.style.display="flex")}}):null,e.jsxs("div",{className:"w-full h-64 bg-gray-200 hidden items-center justify-center flex-col",style:{display:"none"},children:[e.jsx(ne,{className:"h-12 w-12 text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Map unavailable"}),e.jsxs("p",{className:"text-gray-500 text-xs",children:["Lat: ",t.lat.toFixed(4),", Lng: ",t.lng.toFixed(4)]})]}),e.jsx("div",{className:"p-3 bg-gray-50",children:e.jsx("p",{className:"text-xs text-gray-600 text-center",children:"Interactive features unavailable in fallback mode"})})]})}),e.jsx("div",{className:"absolute bottom-4 left-4 right-4 z-20",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-800 mb-2",children:"Troubleshooting Tips:"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Check your internet connection"}),e.jsx("li",{children:"‚Ä¢ Ensure Google Maps API key is configured"}),e.jsx("li",{children:"‚Ä¢ Visit /diagnostic page for detailed analysis"}),e.jsx("li",{children:"‚Ä¢ Contact support if issue persists"})]})]})})]})};class zr extends m.Component{retryCount=0;maxRetries=3;constructor(s){super(s),this.state={hasError:!1}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error("Google Maps Error Boundary caught an error:",s,r),this.setState({error:s,errorInfo:r}),es.get("ENABLE_CRASH_REPORTING")&&this.reportError(s,r)}reportError=(s,r)=>{const n={error:s.message,stack:s.stack,componentStack:r.componentStack,props:this.props,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href};console.warn("Map Error Report:",n)};handleRetry=()=>{this.retryCount<this.maxRetries?(this.retryCount++,this.setState({hasError:!1,error:void 0,errorInfo:void 0})):console.warn("Max retry attempts reached for Google Maps")};getErrorMessage=()=>{const{error:s}=this.state,{fallbackMessage:r}=this.props;return r||(s?.message?s.message.includes("API key")?"Google Maps API key is invalid or missing. Please check your configuration.":s.message.includes("quota")?"Google Maps API quota exceeded. Please try again later.":s.message.includes("network")?"Network error loading Google Maps. Please check your internet connection.":s.message.includes("loading")?"Failed to load Google Maps. This might be due to network issues or API restrictions.":`Google Maps error: ${s.message}`:"An unexpected error occurred while loading Google Maps.")};render(){if(this.state.hasError){const s=this.getErrorMessage(),r=this.retryCount<this.maxRetries;return e.jsx(Os,{userLocation:this.props.userLocation,onRetry:r?this.handleRetry:()=>window.location.reload(),error:s})}return this.props.children}}const Yr=()=>{const[t,s]=m.useState(null),[r,n]=m.useState(!1),o=m.useCallback(d=>{if(r&&d.latLng){const c={lat:d.latLng?.lat()||0,lng:d.latLng?.lng()||0};s(c),E({title:"Location selected",description:"Now you can create your Lo at this location"})}},[r]);m.useEffect(()=>{const d=c=>{r&&c.detail&&(s(c.detail),E({title:"Street View location selected",description:"Now you can create your Lo at this street view location"}))};return window.addEventListener("streetViewClick",d),()=>{window.removeEventListener("streetViewClick",d)}},[r]);const l=m.useCallback(()=>{n(!0),s(null),E({title:"Place your Lo",description:"Click anywhere on the map or in Street View to select a location"})},[]),a=m.useCallback(()=>{n(!1),s(null)},[]);return{newPinPosition:t,isPlacingPin:r,handleMapClick:o,startPinPlacement:l,endPinPlacement:a,setNewPinPosition:s}},Wr=[{featureType:"all",elementType:"labels.text.fill",stylers:[{color:"#333333"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#9b87f5"},{visibility:"on"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#f6f7fb"},{lightness:10}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#403E43"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#f1f0fb"},{lightness:15}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#E5DEFF"},{lightness:10}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#d3e4fd"},{lightness:15}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#f2fce2"},{lightness:10}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#0EA5E9"},{opacity:.3}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#fec6a1"},{lightness:20}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#F2FCE2"},{lightness:10}]}],Gr={styles:Wr,disableDefaultUI:!0,zoomControl:!1,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,scaleControl:!1,rotateControl:!1,draggable:!0,scrollwheel:!0,disableDoubleClickZoom:!1,keyboardShortcuts:!0,gestureHandling:"greedy"},Ht=({isStartingSoon:t=!1,eventCategory:s="general",eventSource:r="ticketmaster",priceRange:n="medium",onClick:o})=>{const a=(h=>{const y={music:{icon:e.jsx(ba,{className:"w-3 h-3"}),colors:"from-purple-500 to-pink-600"},sports:{icon:e.jsx(ya,{className:"w-3 h-3"}),colors:"from-green-500 to-emerald-600"},theater:{icon:e.jsx(ja,{className:"w-3 h-3"}),colors:"from-red-500 to-rose-600"},arts:{icon:e.jsx(ns,{className:"w-3 h-3"}),colors:"from-indigo-500 to-purple-600"},family:{icon:e.jsx(Na,{className:"w-3 h-3"}),colors:"from-orange-500 to-amber-600"},gaming:{icon:e.jsx(Sa,{className:"w-3 h-3"}),colors:"from-blue-500 to-cyan-600"},general:{icon:e.jsx(ct,{className:"w-3 h-3"}),colors:"from-amber-500 to-yellow-600"}};return y[h.toLowerCase()]||y.general})(s),d=()=>{switch(n){case"low":return"bg-green-100 border-green-400 text-green-700";case"high":return"bg-red-100 border-red-400 text-red-700";default:return"bg-yellow-100 border-yellow-400 text-yellow-700"}},c=t?{outerGlow:"bg-red-400 animate-pulse shadow-lg shadow-red-400/50",markerBg:"bg-gradient-to-br from-red-500 to-red-700",tailColor:"border-t-red-700",pulseRing:"border-red-400 animate-ping"}:{outerGlow:"bg-amber-400/60 shadow-md shadow-amber-400/30",markerBg:`bg-gradient-to-br ${a.colors}`,tailColor:"border-t-amber-600",pulseRing:"border-amber-400"};return e.jsxs("div",{className:`
        group relative cursor-pointer transition-all duration-300 ease-out
        hover:scale-110 active:scale-95 touch-manipulation
        ${t?"animate-bounce":""}
      `,onClick:o,role:"button",tabIndex:0,"aria-label":`${s} event ${t?"(starting soon)":""}`,onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),o?.())},children:[e.jsx("div",{className:`
          absolute inset-0 rounded-full blur-sm transition-all duration-300
          ${c.outerGlow}
          w-10 h-10 -top-2 -left-2 group-hover:w-12 group-hover:h-12 group-hover:-top-3 group-hover:-left-3
        `}),e.jsxs("div",{className:`
        relative w-8 h-8 rounded-full border-3 border-white shadow-xl
        flex items-center justify-center text-white transition-all duration-200
        ${c.markerBg}
        group-hover:shadow-2xl
      `,children:[a.icon,e.jsx("div",{className:`
            absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-white
            ${c.markerBg}
          `,children:e.jsx("div",{className:"w-full h-full rounded-full bg-white/30"})})]}),e.jsx("div",{className:`
        absolute left-1/2 transform -translate-x-1/2 top-6
        w-0 h-0 border-l-[5px] border-r-[5px] border-t-[8px] border-transparent
        ${c.tailColor}
        drop-shadow-sm
      `}),e.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2",children:e.jsx("div",{className:`
          text-xs px-2 py-0.5 rounded-full border font-medium
          ${r==="ticketmaster"?"bg-blue-100 border-blue-400 text-blue-700":"bg-green-100 border-green-400 text-green-700"}
          opacity-0 group-hover:opacity-100 transition-opacity duration-200
        `,children:r==="ticketmaster"?"TM":"EB"})}),e.jsx("div",{className:"absolute -top-3 -left-3",children:e.jsx("div",{className:`
          w-4 h-4 rounded-full border-2 text-xs flex items-center justify-center font-bold
          ${d()}
          opacity-0 group-hover:opacity-100 transition-opacity duration-200
        `,children:n==="low"?"$":n==="high"?"$$$":"$$"})}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`absolute inset-0 rounded-full border-2 ${c.pulseRing} w-8 h-8 opacity-75`}),e.jsx("div",{className:`absolute inset-0 rounded-full border-2 ${c.pulseRing} w-8 h-8 animation-delay-75`})]}),e.jsxs("div",{className:"sr-only",children:[s," event marker. Click to view details.",t&&" This event is starting soon!"]})]})},Fs=ye.forwardRef(({isEventsOnlyMode:t=!1},s)=>{const{userLocation:r}=Et(),{filters:n,filteredMessages:o,addMessage:l,updateMessage:a,handleFilterChange:d}=wt(),{events:c,eventsStartingSoon:h}=bs(),{user:y}=De(),{setMap:f}=ts(),{isLoaded:v,loadError:S,apiKeyValid:x,retry:w}=ss(),[p,i]=m.useState(null),[u,g]=m.useState(!1),{liveStreams:j}=Ze(),[N,b]=m.useState(null),[k,C]=m.useState(null),[M,L]=m.useState(!1),[A,_]=m.useState(!1),{selectedMessage:P,setSelectedMessage:V,isCreating:T,setIsCreating:I,handleClose:R}=js(),{map:z,isInStreetView:H,onLoad:ee,onUnmount:X,onSearchBoxLoad:te}=ys(),K=m.useCallback(q=>{q.setOptions({gestureHandling:"greedy",draggable:!0,scrollwheel:!0}),ee(q),f(q)},[ee,f]),{newPinPosition:F,isPlacingPin:B,handleMapClick:U,startPinPlacement:D,endPinPlacement:W,setNewPinPosition:ae}=Yr();ye.useImperativeHandle(s,()=>({panTo:q=>{z&&(z.panTo(q),z.setZoom(15))}}),[z]);const Z=m.useCallback(()=>{if(I(!0),D(),V(null),H&&z){const ie=z.getStreetView().getPosition();if(ie){const xe={lat:ie.lat(),lng:ie.lng()};ae(xe)}}},[H,z,D]);m.useEffect(()=>{const q=()=>{Z()};return window.addEventListener("createMessage",q),()=>{window.removeEventListener("createMessage",q)}},[Z]);const J=q=>{V(q),T&&(I(!1),W())},$=q=>{C(q),L(!0)},G=()=>{L(!1),C(null)},se=()=>{_(!1)},re=q=>{i(q),g(!0)},le=()=>{g(!1),i(null)};if(S||!x)return e.jsx(Os,{userLocation:r||{lat:37.7749,lng:-122.4194},onRetry:w,error:S?.message||(x?void 0:"Invalid or missing Google Maps API key")});if(!v)return e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading Google Maps..."})]})});const ue=y?.user_metadata?.avatar_url||"/placeholder.svg",fe=y?.user_metadata?.name,ge=`map-container relative w-full h-full ${B?"cursor-pin":""}`;return e.jsx(zr,{userLocation:r||{lat:37.7749,lng:-122.4194},fallbackMessage:"Google Maps failed to load properly. Using fallback view.",children:e.jsxs("div",{className:ge,children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx(za,{filters:n,onFilterChange:d,onSearchBoxLoad:te,map:z}),e.jsx(Wa,{map:z,isPlacingPin:B,setNewPinPosition:ae,onCreateMessage:Z}),e.jsx(Qt,{mapContainerClassName:"w-full h-full",center:r,zoom:13,onLoad:K,onUnmount:X,onClick:U,options:Gr,children:t?e.jsx(e.Fragment,{children:c.map(q=>{if(!q.lat||!q.lng)return null;const ie=h.some(xe=>xe.id===q.id);return e.jsx(Oe,{position:{lat:q.lat,lng:q.lng},mapPaneName:Oe.OVERLAY_MOUSE_TARGET,children:e.jsx("div",{style:{position:"absolute",transform:"translate(-50%, -100%)",zIndex:40},children:e.jsx(Ht,{isStartingSoon:ie,onClick:()=>re(q)})})},q.id)})}):e.jsxs(e.Fragment,{children:[e.jsx(Vr,{selectedMessage:P,filteredMessages:o,onMessageClick:J,onClose:R}),e.jsx(Ur,{liveStreams:j,onStreamSelect:$,selectedStreamId:N,setSelectedStreamId:b}),c.map(q=>{if(!q.lat||!q.lng)return null;const ie=h.some(xe=>xe.id===q.id);return e.jsx(Oe,{position:{lat:q.lat,lng:q.lng},mapPaneName:Oe.OVERLAY_MOUSE_TARGET,children:e.jsx("div",{style:{position:"absolute",transform:"translate(-50%, -100%)",zIndex:40},children:e.jsx(Ht,{isStartingSoon:ie,onClick:()=>re(q)})})},q.id)})]})}),!t&&e.jsx(Fr,{isCreating:T,isInStreetView:H,isPlacingPin:B,newPinPosition:F,userAvatar:ue,userName:fe,handleClose:R,handleCreateMessage:Z,addMessage:l,updateMessage:a})]}),!t&&e.jsxs(e.Fragment,{children:[e.jsx(qr,{stream:k,isOpen:M,onClose:G}),e.jsx(Br,{isOpen:A,onClose:se})]}),e.jsx(qa,{event:p,isOpen:u,onClose:le})]})})});Fs.displayName="MapView";const Ee=[{id:"new-york",name:"New York",displayName:"NYC",coordinates:{lat:40.7128,lng:-74.006},radius:30,population:83e5,timezone:"America/New_York",state:"NY",ticketmasterMarketId:"35"},{id:"los-angeles",name:"Los Angeles",displayName:"LA",coordinates:{lat:34.0522,lng:-118.2437},radius:35,population:39e5,timezone:"America/Los_Angeles",state:"CA",ticketmasterMarketId:"27"},{id:"chicago",name:"Chicago",displayName:"Chicago",coordinates:{lat:41.8781,lng:-87.6298},radius:25,population:27e5,timezone:"America/Chicago",state:"IL",ticketmasterMarketId:"8"},{id:"houston",name:"Houston",displayName:"Houston",coordinates:{lat:29.7604,lng:-95.3698},radius:30,population:23e5,timezone:"America/Chicago",state:"TX",ticketmasterMarketId:"18"},{id:"phoenix",name:"Phoenix",displayName:"Phoenix",coordinates:{lat:33.4484,lng:-112.074},radius:25,population:16e5,timezone:"America/Phoenix",state:"AZ",ticketmasterMarketId:"17"},{id:"philadelphia",name:"Philadelphia",displayName:"Philly",coordinates:{lat:39.9526,lng:-75.1652},radius:20,population:16e5,timezone:"America/New_York",state:"PA",ticketmasterMarketId:"29"},{id:"san-antonio",name:"San Antonio",displayName:"San Antonio",coordinates:{lat:29.4241,lng:-98.4936},radius:20,population:15e5,timezone:"America/Chicago",state:"TX",ticketmasterMarketId:"59"},{id:"san-diego",name:"San Diego",displayName:"San Diego",coordinates:{lat:32.7157,lng:-117.1611},radius:25,population:14e5,timezone:"America/Los_Angeles",state:"CA",ticketmasterMarketId:"37"},{id:"dallas",name:"Dallas",displayName:"Dallas",coordinates:{lat:32.7767,lng:-96.797},radius:30,population:13e5,timezone:"America/Chicago",state:"TX",ticketmasterMarketId:"11"},{id:"san-jose",name:"San Jose",displayName:"Bay Area",coordinates:{lat:37.3382,lng:-121.8863},radius:25,population:1e6,timezone:"America/Los_Angeles",state:"CA",ticketmasterMarketId:"41"},{id:"atlanta",name:"Atlanta",displayName:"Atlanta",coordinates:{lat:33.749,lng:-84.388},radius:30,population:5e5,timezone:"America/New_York",state:"GA",ticketmasterMarketId:"1"},{id:"miami",name:"Miami",displayName:"Miami",coordinates:{lat:25.7617,lng:-80.1918},radius:25,population:47e4,timezone:"America/New_York",state:"FL",ticketmasterMarketId:"21"},{id:"denver",name:"Denver",displayName:"Denver",coordinates:{lat:39.7392,lng:-104.9903},radius:25,population:715e3,timezone:"America/Denver",state:"CO",ticketmasterMarketId:"12"},{id:"seattle",name:"Seattle",displayName:"Seattle",coordinates:{lat:47.6062,lng:-122.3321},radius:25,population:75e4,timezone:"America/Los_Angeles",state:"WA",ticketmasterMarketId:"49"},{id:"las-vegas",name:"Las Vegas",displayName:"Las Vegas",coordinates:{lat:36.1699,lng:-115.1398},radius:20,population:65e4,timezone:"America/Los_Angeles",state:"NV",ticketmasterMarketId:"20"}];[...Ee];function He(t,s,r,n){const l=Ue(r-t),a=Ue(n-s),d=Math.sin(l/2)*Math.sin(l/2)+Math.cos(Ue(t))*Math.cos(Ue(r))*Math.sin(a/2)*Math.sin(a/2);return 3959*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}function Ue(t){return t*(Math.PI/180)}function ht(t,s,r={}){console.log(`üîç CITY DETECTION: Starting detection for location ${t}, ${s}`);let n=Ee[0],o=1/0;console.log(`üîç CITY DETECTION: Checking ${Ee.length} cities...`);const l=He(t,s,33.749,-84.388);console.log(`üîç SPECIAL CHECK: Distance to Atlanta (33.7490, -84.3880): ${Math.round(l)} miles`);for(const a of Ee){const d=He(t,s,a.coordinates.lat,a.coordinates.lng);console.log(`üîç ${a.displayName} (${a.id}): ${Math.round(d)} miles away (coords: ${a.coordinates.lat}, ${a.coordinates.lng})`),d<o&&(o=d,n=a,console.log(`üéØ NEW CLOSEST: ${a.displayName} (${a.id}) at ${Math.round(d)} miles`))}return console.log(`‚úÖ FINAL RESULT: ${n.displayName} (${n.id}) is ${Math.round(o)} miles away`),n}function Hr(t,s,r=50){console.log(`üîç EVENT RADIUS CHECK: Testing location ${t}, ${s} within ${r} miles`);let n=1/0,o="";for(const l of Ee){const a=He(t,s,l.coordinates.lat,l.coordinates.lng);if(a<n&&(n=a,o=l.displayName),console.log(`üîç ${l.displayName}: ${Math.round(a)} miles away`),a<=r)return console.log(`‚úÖ WITHIN RADIUS: ${l.displayName} is within ${r} miles`),!0}return console.log(`‚ùå OUTSIDE RADIUS: Closest city ${o} is ${Math.round(n)} miles away (max: ${r})`),!1}function Kt(t){return`${{"new-york":"üóΩ","los-angeles":"üå¥",chicago:"üèôÔ∏è",houston:"üöÄ",phoenix:"üåµ",philadelphia:"üîî","san-antonio":"ü§†","san-diego":"üèñÔ∏è",dallas:"ü§†","san-jose":"üíª",atlanta:"üçë",miami:"üèñÔ∏è",denver:"‚õ∞Ô∏è",seattle:"‚òï","las-vegas":"üé∞"}[t.id]||"üèôÔ∏è"} ${t.displayName}`}function Kr(t,s){const r=ht(t,s),n=He(t,s,r.coordinates.lat,r.coordinates.lng);return n>50?Math.min(100,n+r.radius):r.population>1e6?Math.max(r.radius,35):r.radius}const Jr=t=>{const[s,r]=m.useState(null),[n,o]=m.useState(null),[l,a]=m.useState(!0),[d,c]=m.useState(50),[h,y]=m.useState({preferLargeMetros:!0}),f=m.useCallback(()=>{if(!t)return;const p=t.getCenter();if(!p)return;const i=p.lat(),u=p.lng();console.log(`üó∫Ô∏è MAP CENTER: Detecting city from map center: ${i}, ${u}`),o({lat:i,lng:u});const g=Kr(i,u);c(g);const j=Hr(i,u,150);if(a(j),console.log(`üó∫Ô∏è MAP CENTER: Within range of major cities: ${j} (optimal radius: ${g} miles)`),j){const N=ht(i,u,{maxDistance:200,preferLargeMetros:h.preferLargeMetros});r(N);const b=Math.round(v(i,u,N.coordinates.lat,N.coordinates.lng));console.log(`üéØ MAP CITY: Detected ${N.displayName} (${N.id}) from map position`),console.log(`üéØ MAP CITY: Distance to ${N.displayName}: ${b} miles (metro: ${N.metroArea})`),console.log(`üéØ MAP CITY: Using radius: ${N.radius} miles, TM Market: ${N.ticketmasterMarketId||"N/A"}`)}else{const N=ht(i,u,{maxDistance:500,preferLargeMetros:!0}),b=v(i,u,N.coordinates.lat,N.coordinates.lng);b<=300?(r(N),console.log(`üó∫Ô∏è FALLBACK CITY: Using ${N.displayName} (${Math.round(b)} miles away) for remote location`)):(r(null),console.log(`üó∫Ô∏è MAP CENTER: Location too remote - no events available (nearest: ${N.displayName} at ${Math.round(b)} miles)`))}},[t]),v=(p,i,u,g)=>{const N=S(u-p),b=S(g-i),k=Math.sin(N/2)*Math.sin(N/2)+Math.cos(S(p))*Math.cos(S(u))*Math.sin(b/2)*Math.sin(b/2);return 3959*(2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k)))},S=p=>p*(Math.PI/180);m.useEffect(()=>{if(!t)return;console.log("üó∫Ô∏è MAP SETUP: Setting up map center detection listeners"),f();const p=t.addListener("center_changed",()=>{setTimeout(f,500)}),i=t.addListener("zoom_changed",()=>{setTimeout(f,500)}),u=t.addListener("idle",()=>{f()});return console.log("üó∫Ô∏è MAP SETUP: Map listeners registered successfully"),()=>{google.maps.event.removeListener(p),google.maps.event.removeListener(i),google.maps.event.removeListener(u),console.log("üó∫Ô∏è MAP CLEANUP: Removed map listeners")}},[t,f]);const x=m.useCallback(()=>{f()},[f]),w=m.useCallback(p=>{y(i=>({...i,...p})),setTimeout(()=>f(),100)},[f]);return{currentCity:s,mapCenter:n,isWithinRange:l,searchRadius:d,updateCityDetection:x,updateDetectionOptions:w,detectionOptions:h}};class Xr{logs=[];isCapturing=!1;originalConsole={log:console.log,error:console.error,warn:console.warn,info:console.info};startCapture(){this.logs=[],this.isCapturing=!0,console.log=(...s)=>{const r=s.map(n=>typeof n=="object"?JSON.stringify(n,null,2):String(n)).join(" ");this.logs.push(`[LOG] ${r}`),this.originalConsole.log(...s)},console.error=(...s)=>{const r=s.map(n=>typeof n=="object"?JSON.stringify(n,null,2):String(n)).join(" ");this.logs.push(`[ERROR] ${r}`),this.originalConsole.error(...s)},console.warn=(...s)=>{const r=s.map(n=>typeof n=="object"?JSON.stringify(n,null,2):String(n)).join(" ");this.logs.push(`[WARN] ${r}`),this.originalConsole.warn(...s)}}stopCapture(){this.isCapturing=!1,console.log=this.originalConsole.log,console.error=this.originalConsole.error,console.warn=this.originalConsole.warn}getLogs(){return this.logs.join(`
`)}copyToClipboard(){const s=this.getLogs();if(navigator.clipboard)navigator.clipboard.writeText(s).then(()=>{this.originalConsole.log("üìã Debug logs copied to clipboard!")}).catch(r=>{this.originalConsole.error("Failed to copy logs:",r)});else{const r=document.createElement("textarea");r.value=s,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r),this.originalConsole.log("üìã Debug logs copied to clipboard!")}}downloadLogs(){const s=this.getLogs(),r=new Blob([s],{type:"text/plain"}),n=URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download=`lo-debug-${new Date().toISOString()}.txt`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)}clear(){this.logs=[]}}const Be=new Xr;Be.startCapture();typeof window<"u"&&(window.debugLogger=Be,window.copyLogs=()=>Be.copyToClipboard(),window.downloadLogs=()=>Be.downloadLogs(),console.log("üêõ Debug Logger Active! Use window.copyLogs() to copy logs to clipboard"));const Zr=({className:t="",onEventsOnlyModeChange:s})=>{const[r,n]=m.useState(!1),[o,l]=m.useState(!1),[a,d]=m.useState(0),[c,h]=m.useState(!1),{events:y,refetch:f}=bs(),{map:v}=ts(),{currentCity:S,isWithinRange:x,mapCenter:w}=Jr(v);m.useEffect(()=>{const g=y.filter(j=>{const N=new Date(j.event_start_date),b=new Date,k=new Date(b.getTime()+24*60*60*1e3);return N>=b&&N<=k});l(g.length>0),d(g.length)},[y]);const p=async()=>{o&&c?(await u(),h(!1),l(!1),d(0),s?.(!1),E({title:"üó∫Ô∏è Map Restored",description:"All content is now visible on the map",duration:2e3})):(h(!0),s?.(!0),o?(await u(),setTimeout(()=>i(),500)):await i())},i=async()=>{if(!S){E({title:"üìç Location Required",description:"Detecting your location to find nearby events...",duration:3e3});return}n(!0);try{const{data:g,error:j}=await Y.functions.invoke("fetch-events-realtime",{body:{source:["ticketmaster","predicthq"],center:S.coordinates,radius:S.radius,timeframe:"24h"}});if(j)throw j;await f(),l(!0),d(g?.events?.total||g?.totalEvents||0),E({title:`üé´ ${Kt(S)} Events Only!`,description:`Showing ${g?.events?.total||g?.totalEvents||0} events in ${S.displayName} ‚Ä¢ Other content hidden for better performance`,duration:3e3})}catch(g){console.error("Error loading events:",g),g.message?.includes("Edge Function returned a non-2xx status code")||g.message?.includes("NOT_FOUND")?(E({title:"üîß Setup Required",description:"Please deploy the events function. Check console for instructions.",duration:5e3}),console.info(`
üîß EVENTS SETUP REQUIRED:

The events function needs to be deployed:

1. Deploy function: supabase functions deploy fetch-events-realtime
2. Set environment variables:
   - TICKETMASTER_API_KEY=your_api_key
   - EVENTBRITE_PRIVATE_TOKEN=your_eventbrite_token
   - SUPABASE_SERVICE_ROLE_KEY=your_service_key
3. Ensure database migration is applied

See REALTIME_EVENTS_SETUP.md for detailed instructions.
        `)):E({title:"‚ùå Connection Error",description:"Failed to connect to event services. Please try again.",variant:"destructive",duration:4e3})}finally{n(!1)}},u=async()=>{n(!0);try{console.log("üßπ Clearing all events...");const{error:g}=await Y.from("messages").delete().eq("message_type","event").in("event_source",["ticketmaster","seatgeek","predicthq","yelp","eventbrite"]);if(g)throw g;await f(),E({title:"üßπ Events Hidden",description:"All events have been removed from the map",duration:2e3})}catch(g){console.error("Error clearing events:",g),E({title:"‚ùå Clear Error",description:"Failed to clear events from map",variant:"destructive"})}finally{n(!1)}};return e.jsxs("div",{className:`flex flex-col items-center space-y-3 ${t}`,children:[e.jsxs("button",{onClick:p,disabled:r,className:`
          relative flex min-h-[64px] min-w-[220px] items-center justify-center rounded-2xl border px-6 py-4 text-lg font-bold text-white transition-transform duration-200
          backdrop-blur-xl
          ${o&&c?"bg-gradient-to-r from-purple-600/30 to-indigo-500/30 border-purple-400/40":o?"bg-gradient-to-r from-emerald-500/30 to-teal-500/30 border-emerald-400/40":"bg-gradient-to-r from-amber-400/30 to-yellow-400/30 border-amber-300/40"}
          ${r?"scale-95 opacity-80":"hover:scale-[1.02] active:scale-95"}
          disabled:cursor-not-allowed disabled:transform-none disabled:opacity-60
        `,children:[o&&e.jsx("div",{className:"absolute inset-0 rounded-2xl bg-gradient-to-r from-transparent via-white/10 to-transparent"}),e.jsxs("div",{className:"relative flex items-center space-x-3",children:[r?e.jsx(dt,{className:"w-7 h-7 animate-spin"}):o?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-white rounded-full motion-safe:animate-pulse"}),e.jsx(ct,{className:"w-6 h-6"})]}):e.jsx(ct,{className:"w-7 h-7"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"text-base leading-tight",children:r?"Loading...":o&&c?"Exit Events Mode":o?"Events Only Mode":"Show Events"}),e.jsx("span",{className:"text-sm opacity-90 leading-tight",children:o&&c?`Events Only ‚Ä¢ ${a} Found`:o?`${a} Live Events`:S?`${S.displayName} ‚Ä¢ 24h`:"Next 24 Hours"})]}),!r&&e.jsx(Ca,{className:"w-5 h-5 ml-2"})]})]}),o&&e.jsxs("div",{className:"glass px-4 py-2 rounded-2xl flex items-center space-x-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-green-400",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full motion-safe:animate-pulse"}),e.jsxs("span",{className:"font-medium text-white",children:[a," Active"]})]}),e.jsxs("div",{className:"flex items-center space-x-1 text-white/80",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:"Next 24h"})]}),e.jsxs("div",{className:"flex items-center space-x-1 text-white/80",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:S?.displayName||"No City"})]})]}),!x&&S&&e.jsxs("div",{className:"text-xs text-amber-600 text-center max-w-xs",children:["üìç You're outside major cities - showing ",S.displayName," events"]}),!S&&v&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[e.jsx(dt,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{children:"Detecting city from map..."})]}),!o&&!r&&S&&e.jsxs("p",{className:"text-xs text-gray-500 text-center max-w-xs",children:["Move map to any major city ‚Ä¢ Tap to show live events for ",Kt(S)]}),!1]})},Qr=({onStreamStart:t,onStreamEnd:s,onClose:r,isStreaming:n,viewerCount:o=0,streamTitle:l="",onTitleChange:a})=>{const d=m.useRef(null),c=m.useRef(null),[h,y]=m.useState(null),[f,v]=m.useState(!0),[S,x]=m.useState(!0),[w,p]=m.useState("user"),[i,u]=m.useState([]),[g,j]=m.useState(!1),[N,b]=m.useState(0),[k,C]=m.useState(l),[M,L]=m.useState(!1),[A,_]=m.useState(!1);m.useEffect(()=>{let F;return n?F=setInterval(()=>{b(B=>B+1)},1e3):b(0),()=>clearInterval(F)},[n]),m.useEffect(()=>{(async()=>{try{const U=(await navigator.mediaDevices.enumerateDevices()).filter(D=>D.kind==="videoinput");u(U)}catch(B){console.error("Error getting devices:",B)}})()},[]),m.useEffect(()=>(!M&&!A&&P(),()=>{R()}),[w]);const P=async()=>{L(!0)},V=async()=>{L(!1),_(!1),await I()},T=()=>{L(!1),_(!0),y(!1)},I=async()=>{try{j(!0),c.current&&c.current.getTracks().forEach(U=>U.stop());const F={video:{facingMode:w,width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}},B=await navigator.mediaDevices.getUserMedia(F);c.current=B,d.current&&(d.current.srcObject=B,d.current.play()),y(!0),_(!1),E({title:"Camera & Microphone Ready!",description:"You can now start livestreaming"})}catch(F){console.error("Error accessing camera:",F),y(!1),_(!0);let B="Please allow camera and microphone access";F.name==="NotAllowedError"?B="Camera and microphone access was denied. Please enable permissions in your browser settings.":F.name==="NotFoundError"?B="No camera or microphone found on this device.":F.name==="NotReadableError"&&(B="Camera or microphone is already in use by another application."),E({title:"Camera & Microphone Access Required",description:B,variant:"destructive"})}finally{j(!1)}},R=()=>{c.current&&(c.current.getTracks().forEach(F=>F.stop()),c.current=null),d.current&&(d.current.srcObject=null)},z=()=>{if(c.current){const F=c.current.getVideoTracks()[0];F&&(F.enabled=!F.enabled,v(F.enabled))}},H=()=>{if(c.current){const F=c.current.getAudioTracks()[0];F&&(F.enabled=!F.enabled,x(F.enabled))}},ee=()=>{p(F=>F==="user"?"environment":"user")},X=()=>{if(!c.current){E({title:"Camera not ready",description:"Please wait for camera to initialize",variant:"destructive"});return}if(!k.trim()){E({title:"Title required",description:"Please add a title for your livestream",variant:"destructive"});return}t?.(c.current),a?.(k),E({title:"Live stream started!",description:"You're now broadcasting live to your location"})},te=()=>{s?.(),b(0),E({title:"Live stream ended",description:"Your broadcast has been stopped"})},K=F=>{const B=Math.floor(F/60),U=F%60;return`${B.toString().padStart(2,"0")}:${U.toString().padStart(2,"0")}`};return M?e.jsxs("div",{className:"text-center p-8 bg-gradient-to-br from-red-50 to-orange-50 rounded-lg border border-red-200",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(pe,{className:"h-8 w-8 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Camera & Microphone Access Required"}),e.jsx("p",{className:"text-gray-600 mb-4 text-sm leading-relaxed",children:'To start livestreaming, this app needs access to your camera and microphone. Your browser will ask for permission when you click "Allow Access".'}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-500 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx(pe,{className:"h-3 w-3"}),e.jsx("span",{children:"Camera: To broadcast your video"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx(Ye,{className:"h-3 w-3"}),e.jsx("span",{children:"Microphone: To broadcast your audio"})]})]}),e.jsxs("div",{className:"flex space-x-3 justify-center",children:[e.jsx("button",{onClick:T,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:V,className:"px-6 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors flex items-center space-x-2",children:[e.jsx("span",{children:"Allow Access"}),e.jsx(pe,{className:"h-4 w-4"})]})]})]}):h===null?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Setting up camera..."})]}):h===!1||A?e.jsxs("div",{className:"text-center p-8 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(We,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Camera & Microphone Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-4 text-sm leading-relaxed",children:"Livestreaming requires camera and microphone permissions. Please:"}),e.jsxs("div",{className:"text-left text-xs text-gray-600 bg-white p-3 rounded border mb-6 space-y-1",children:[e.jsx("div",{children:"1. Click the camera icon in your browser's address bar"}),e.jsx("div",{children:'2. Select "Allow" for both camera and microphone'}),e.jsx("div",{children:"3. Refresh the page if needed"})]}),e.jsxs("div",{className:"flex space-x-3 justify-center",children:[e.jsx("button",{onClick:()=>L(!0),className:"px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg font-medium transition-colors",children:"Try Again"}),r&&e.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors",children:"Cancel"})]})]}):e.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"relative aspect-video",children:[e.jsx("video",{ref:d,className:"w-full h-full object-cover",muted:!0,playsInline:!0}),g&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),n&&e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center bg-red-500 text-white px-2 py-1 rounded-full text-sm font-bold",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full mr-1 animate-pulse"}),"LIVE"]}),e.jsx("span",{className:"bg-black/50 text-white px-2 py-1 rounded text-sm",children:K(N)})]}),e.jsxs("div",{className:"flex items-center bg-black/50 text-white px-2 py-1 rounded text-sm",children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),o]})]}),r&&e.jsx("button",{onClick:r,className:"absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 text-white rounded-full transition-colors",children:e.jsx(ve,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("input",{type:"text",value:k,onChange:F=>C(F.target.value),placeholder:"What's your stream about?",className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500",maxLength:100,disabled:n}),e.jsxs("div",{className:"text-right text-xs text-gray-500 mt-1",children:[k.length,"/100"]})]}),e.jsxs("div",{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:z,className:`p-3 rounded-full transition-colors ${f?"bg-emerald-500 hover:bg-emerald-600 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,children:f?e.jsx(pe,{className:"h-5 w-5"}):e.jsx(We,{className:"h-5 w-5"})}),e.jsx("button",{onClick:H,className:`p-3 rounded-full transition-colors ${S?"bg-emerald-500 hover:bg-emerald-600 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,children:S?e.jsx(Ye,{className:"h-5 w-5"}):e.jsx(ot,{className:"h-5 w-5"})}),i.length>1&&e.jsx("button",{onClick:ee,className:"p-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full transition-colors",disabled:n,children:e.jsx(ka,{className:"h-5 w-5"})})]}),e.jsx("div",{children:n?e.jsxs("button",{onClick:te,className:"flex items-center space-x-2 px-6 py-3 bg-gray-800 hover:bg-black text-white rounded-full font-semibold transition-colors",children:[e.jsx(xt,{className:"h-4 w-4"}),e.jsx("span",{children:"End Stream"})]}):e.jsxs("button",{onClick:X,disabled:!h||g,className:"flex items-center space-x-2 px-6 py-3 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white rounded-full font-semibold transition-colors",children:[e.jsx(Ma,{className:"h-4 w-4"}),e.jsx("span",{children:"Go Live"})]})})]}),n&&e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ke,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[o," viewer",o!==1?"s":""]})]}),e.jsxs("div",{children:["Duration: ",K(N)]})]}),e.jsx("div",{className:"text-emerald-600 font-medium",children:"Broadcasting live"})]})]})]})};class Jt{static streams=new Map;static streamConnections=new Map;static async startLiveStream(s,r,n,o=!1){try{const l=(await Y.auth.getUser()).data.user;if(!l)throw new Error("User not authenticated");const{data:a}=await Y.from("profiles").select("name, avatar_url").eq("id",l.id).single(),d=`stream_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,c=`wss://stream.example.com/live/${d}`,h={id:d,title:r,streamUrl:c,location:n,userId:l.id,userName:a?.name||l.email||"Anonymous",userAvatar:a?.avatar_url,isLive:!0,viewerCount:0,startedAt:new Date().toISOString(),isPrivate:o};this.streams.set(d,h),this.streamConnections.set(d,s);const{error:y}=await Y.from("messages").insert({content:r,user_id:l.id,lat:n.lat,lng:n.lng,is_public:!o,message_type:"livestream",livestream_url:c,livestream_title:r,is_live:!0});if(y)throw y;return Y.channel("livestreams").send({type:"broadcast",event:"stream_started",payload:h}),console.log("üî¥ LiveStream started:",h),h}catch(l){throw console.error("Error starting livestream:",l),new Error(`Failed to start livestream: ${l.message}`)}}static async endLiveStream(s){try{const r=this.streams.get(s);if(!r)throw new Error("Stream not found");const n=this.streamConnections.get(s);n&&(n.getTracks().forEach(a=>a.stop()),this.streamConnections.delete(s)),r.isLive=!1,r.endedAt=new Date().toISOString();const{error:o}=await Y.from("messages").update({is_live:!1,ended_at:r.endedAt}).eq("livestream_url",r.streamUrl);if(o)throw o;Y.channel("livestreams").send({type:"broadcast",event:"stream_ended",payload:{streamId:s}}),this.streams.delete(s),r.streamUrl.startsWith("blob:")&&URL.revokeObjectURL(r.streamUrl),console.log("üî¥ LiveStream ended:",s)}catch(r){throw console.error("Error ending livestream:",r),new Error(`Failed to end livestream: ${r.message}`)}}static async getActiveLiveStreams(s){try{let r=Y.from("messages").select(`
          id,
          content,
          lat,
          lng,
          created_at,
          livestream_url,
          livestream_title,
          is_live,
          user_id,
          profiles (
            name,
            avatar_url
          )
        `).eq("message_type","livestream").eq("is_live",!0).order("created_at",{ascending:!1});const{data:n,error:o}=await r;if(o)throw o;const l=(n||[]).map(a=>({id:a.id,title:a.livestream_title||a.content,streamUrl:a.livestream_url,location:{lat:a.lat,lng:a.lng,name:"Live Location"},userId:a.user_id,userName:a.profiles?.name||"Anonymous",userAvatar:a.profiles?.avatar_url,isLive:a.is_live,viewerCount:Math.floor(Math.random()*50),startedAt:a.created_at,isPrivate:!1}));return s&&l.sort((a,d)=>{const c=this.calculateDistance(s,a.location),h=this.calculateDistance(s,d.location);return c-h}),l}catch(r){return console.error("Error fetching livestreams:",r),[]}}static async joinLiveStream(s){try{const r=this.streams.get(s);if(r)return r.viewerCount++,r;const{data:n,error:o}=await Y.from("messages").select(`
          id,
          content,
          lat,
          lng,
          created_at,
          livestream_url,
          livestream_title,
          is_live,
          user_id,
          profiles (
            name,
            avatar_url
          )
        `).eq("id",s).eq("message_type","livestream").eq("is_live",!0).single();if(o||!n)return null;const l={id:n.id,title:n.livestream_title||n.content,streamUrl:n.livestream_url,location:{lat:n.lat,lng:n.lng,name:"Live Location"},userId:n.user_id,userName:n.profiles?.name||"Anonymous",userAvatar:n.profiles?.avatar_url,isLive:n.is_live,viewerCount:Math.floor(Math.random()*50)+1,startedAt:n.created_at,isPrivate:!1};return this.streams.set(s,l),l}catch(r){return console.error("Error joining livestream:",r),null}}static leaveLiveStream(s){const r=this.streams.get(s);r&&(r.viewerCount=Math.max(0,r.viewerCount-1))}static calculateDistance(s,r){const o=this.toRadians(r.lat-s.lat),l=this.toRadians(r.lng-s.lng),a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(this.toRadians(s.lat))*Math.cos(this.toRadians(r.lat))*Math.sin(l/2)*Math.sin(l/2);return 6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}static toRadians(s){return s*(Math.PI/180)}static getOptimalStreamSettings(s){switch(s){case"poor":return{quality:"low",frameRate:15,bitrate:5e5};case"good":return{quality:"medium",frameRate:24,bitrate:1e6};case"excellent":return{quality:"high",frameRate:30,bitrate:25e5};default:return{quality:"medium",frameRate:24,bitrate:1e6}}}}const en=({isOpen:t,onClose:s,onPostCreated:r})=>{const[n,o]=m.useState("type"),[l,a]=m.useState(""),[d,c]=m.useState(null),[h,y]=m.useState(!1),[f,v]=m.useState(!1),[S,x]=m.useState(null),[w,p]=m.useState(null),i=m.useRef(null),[u,g]=m.useState(!1),[j,N]=m.useState(null),[b,k]=m.useState(""),{userLocation:C}=Et(),[M,L]=m.useState(null),[A,_]=m.useState("");m.useState(!1);const{isLoaded:P,loadError:V,apiKeyValid:T}=ss();m.useEffect(()=>{t&&(o("type"),a(""),c(null),y(!1),x(null),p(null),g(!1),N(null),k(""),L(null),_(""))},[t]),m.useEffect(()=>{C&&!M&&(L(C),window.google&&P&&new google.maps.Geocoder().geocode({location:C},(D,W)=>{W==="OK"&&D?.[0]&&_(D[0].formatted_address.split(",")[0])}))},[C,M,P]);const I=U=>{const D=U.target.files?.[0];if(!D)return;if(!D.type.startsWith("image/")&&!D.type.startsWith("video/")){E({title:"Invalid file type",description:"Please select an image or video file",variant:"destructive"});return}const W=D.type.startsWith("video/")?100*1024*1024:5*1024*1024;if(D.size>W){E({title:"File too large",description:`File must be smaller than ${D.type.startsWith("video/")?"100MB":"5MB"}`,variant:"destructive"});return}x(D);const ae=new FileReader;ae.onloadend=()=>{const Z=ae.result;p(Z)},ae.readAsDataURL(D)},R=U=>{c(U),o("location")},z=()=>{if(!M){E({title:"Location required",description:"Please select a location for your Lo",variant:"destructive"});return}o("content")},H=U=>{if(U.latLng){const D={lat:U.latLng.lat(),lng:U.latLng.lng()};L(D),new google.maps.Geocoder().geocode({location:D},(ae,Z)=>{Z==="OK"&&ae?.[0]&&_(ae[0].formatted_address.split(",")[0])})}},ee=async U=>{if(U.preventDefault(),d==="live"){E({title:"Already streaming!",description:"Your livestream is already active"});return}if(!l.trim()&&!S){E({title:"Content required",description:"Please add some content to your Lo",variant:"destructive"});return}if(!M){E({title:"Location required",description:"Please select a location for your Lo",variant:"destructive"});return}v(!0);try{const D={id:`post-${Date.now()}`,content:l.trim(),type:d,mediaUrl:w||void 0,isPrivate:h,location:{lat:M.lat,lng:M.lng,name:A||"Selected Location"},createdAt:new Date().toISOString(),user:{id:"current-user",name:"You",avatar:"/placeholder-avatar.png"}};r?.(D)}catch(D){console.error("Error creating post:",D),E({title:"Failed to post",description:"Please try again",variant:"destructive"})}finally{v(!1)}},X=()=>{x(null),p(null),i.current&&(i.current.value="")};if(!t)return null;const te=()=>e.jsx("div",{className:"flex items-center justify-center space-x-2 mb-6",children:["type","location","content"].map((U,D)=>e.jsxs(ye.Fragment,{children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full transition-all ${n===U?"bg-lo-teal text-white":D<["type","location","content"].indexOf(n)?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,children:D<["type","location","content"].indexOf(n)?e.jsx(qt,{className:"w-5 h-5"}):e.jsx("span",{className:"text-sm font-semibold",children:D+1})}),D<2&&e.jsx("div",{className:`w-12 h-0.5 transition-all ${D<["type","location","content"].indexOf(n)?"bg-green-500":"bg-gray-200"}`})]},U))}),K=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 text-center mb-6",children:"What would you like to share?"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>R("text"),className:"flex items-center justify-between p-4 rounded-xl border-2 border-gray-200 hover:border-lo-teal hover:bg-lo-teal/5 transition-all group",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(vt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Text Message"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Share your thoughts"})]})]}),e.jsx(Se,{className:"w-5 h-5 text-gray-400 group-hover:text-lo-teal transition-colors"})]}),e.jsxs("button",{type:"button",onClick:()=>R("media"),className:"flex items-center justify-between p-4 rounded-xl border-2 border-gray-200 hover:border-lo-teal hover:bg-lo-teal/5 transition-all group",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:e.jsx(Ae,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Photo/Video"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Share visual moments"})]})]}),e.jsx(Se,{className:"w-5 h-5 text-gray-400 group-hover:text-lo-teal transition-colors"})]}),e.jsxs("button",{type:"button",onClick:()=>R("live"),className:"flex items-center justify-between p-4 rounded-xl border-2 border-gray-200 hover:border-red-500 hover:bg-red-50 transition-all group",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center",children:e.jsx(ze,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Go Live"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Stream from your location"})]})]}),e.jsx(Se,{className:"w-5 h-5 text-gray-400 group-hover:text-red-500 transition-colors"})]})]})]}),F=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>o("type"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Se,{className:"w-5 h-5 text-gray-500 rotate-180"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Location"}),e.jsx("div",{className:"w-9"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{type:"button",onClick:()=>{C&&(L(C),new google.maps.Geocoder().geocode({location:C},(D,W)=>{W==="OK"&&D?.[0]&&_(D[0].formatted_address.split(",")[0])}))},className:"w-full flex items-center justify-between p-3 rounded-lg bg-lo-teal/10 border border-lo-teal/30 hover:bg-lo-teal/20 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($e,{className:"w-5 h-5 text-lo-teal"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Use Current Location"})]}),M&&M.lat===C?.lat&&e.jsx(qt,{className:"w-5 h-5 text-lo-teal"})]}),P&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-64 rounded-xl overflow-hidden border border-gray-200",children:e.jsx(Qt,{mapContainerClassName:"w-full h-full",center:M||C||{lat:40.7128,lng:-74.006},zoom:15,onClick:H,options:{disableDefaultUI:!0,zoomControl:!0,clickableIcons:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]},children:M&&e.jsx(gt,{position:M,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#13D3AA",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2}})})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"Tap on the map to select a different location"})]}),M&&e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ne,{className:"w-5 h-5 text-lo-teal mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:A||"Selected Location"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[M.lat.toFixed(6),", ",M.lng.toFixed(6)]})]})]})}),e.jsxs(O,{onClick:z,disabled:!M,className:"w-full bg-gradient-to-r from-lo-teal to-emerald-500 hover:from-emerald-600 hover:to-lo-teal text-white",children:["Continue to Create Lo",e.jsx(Se,{className:"w-4 h-4 ml-2"})]})]})]}),B=()=>{switch(n){case"type":return K();case"location":return F();case"content":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>o("location"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Se,{className:"w-5 h-5 text-gray-500 rotate-180"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create Your Lo"}),e.jsx("div",{className:"w-9"})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"inline-flex items-center space-x-2 px-3 py-1.5 bg-lo-teal/10 rounded-full",children:[e.jsx(ne,{className:"w-4 h-4 text-lo-teal"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:A||"Selected Location"})]})}),d==="live"?e.jsx(Qr,{isStreaming:u,onStreamStart:async U=>{if(!M){E({title:"Location required",description:"Please select a location first",variant:"destructive"});return}try{const D=await Jt.startLiveStream(U,b||"Live from my location",{lat:M.lat,lng:M.lng,name:A||"Selected Location"},h);N(D),g(!0),r?.({id:D.id,content:D.title,type:"live",isLive:!0,streamUrl:D.streamUrl,location:D.location,createdAt:D.startedAt})}catch(D){E({title:"Failed to start stream",description:D.message,variant:"destructive"})}},onStreamEnd:async()=>{if(j)try{await Jt.endLiveStream(j.id),g(!1),N(null),s()}catch(U){E({title:"Error ending stream",description:U.message,variant:"destructive"})}},viewerCount:j?.viewerCount||0,streamTitle:b,onTitleChange:k}):e.jsxs(e.Fragment,{children:[d!=="media"&&e.jsxs("div",{children:[e.jsx("textarea",{value:l,onChange:U=>a(U.target.value),placeholder:"What's happening at this location?",className:"w-full p-3 border border-gray-200 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-lo-teal focus:border-transparent",rows:4,maxLength:500}),e.jsxs("div",{className:"text-right text-xs text-gray-500 mt-1",children:[l.length,"/500"]})]}),d==="media"&&e.jsxs("div",{children:[S?e.jsxs("div",{className:"relative",children:[S?.type.startsWith("image/")?e.jsx("img",{src:w,alt:"Preview",className:"w-full h-48 object-cover rounded-lg"}):e.jsx("video",{src:w,className:"w-full h-48 object-cover rounded-lg",controls:!0}),e.jsx("button",{type:"button",onClick:X,className:"absolute top-2 right-2 p-1 bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors",children:e.jsx(ve,{className:"h-4 w-4"})})]}):e.jsx("div",{onClick:()=>i.current?.click(),className:"border-2 border-dashed border-gray-200 rounded-lg p-6 text-center cursor-pointer hover:border-lo-teal hover:bg-gray-50 transition-all",children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:"p-3 bg-gray-100 rounded-full",children:e.jsx(Ae,{className:"h-6 w-6 text-gray-500"})}),e.jsx("p",{className:"text-sm text-gray-700 font-medium",children:"Add photo or video"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Max 5MB (photo) / 100MB (video)"})]})}),e.jsx("input",{ref:i,type:"file",accept:"image/*,video/*",onChange:I,className:"hidden"}),S&&e.jsx("div",{className:"mt-3",children:e.jsx("textarea",{value:l,onChange:U=>a(U.target.value),placeholder:"Add a caption...",className:"w-full p-3 border border-gray-200 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-lo-teal focus:border-transparent",rows:2,maxLength:500})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[h?e.jsx(os,{className:"h-4 w-4 text-orange-500"}):e.jsx(ls,{className:"h-4 w-4 text-lo-teal"}),e.jsx("span",{className:"text-sm text-gray-700",children:h?"Private (Followers only)":"Public (Everyone)"})]}),e.jsx("button",{type:"button",onClick:()=>y(!h),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${h?"bg-orange-500":"bg-lo-teal"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${h?"translate-x-6":"translate-x-1"}`})})]})]})]});default:return null}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 glass-overlay",onClick:s}),e.jsxs("div",{className:"relative glass-card w-full max-w-lg max-h-[90vh] overflow-hidden animate-fade-in",style:{background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.37)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 glass border-b border-white/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-white liquid-text",children:"Create Lo"}),e.jsx("button",{onClick:s,className:"p-1.5 glass hover:bg-white/20 rounded-full transition-all",children:e.jsx(ve,{className:"h-4 w-4 text-white"})})]}),e.jsxs("form",{onSubmit:ee,className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 p-4 overflow-y-auto",children:[te(),B()]}),n==="content"&&d!=="live"&&e.jsxs("div",{className:"flex space-x-3 p-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>o("location"),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors",children:"Back"}),e.jsx("button",{type:"submit",disabled:f||!l.trim()&&!S,className:"flex-1 liquid-button disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Posting..."})]}):e.jsx("span",{children:"Post Lo"})})]})]})]})]})},tn=({isOpen:t,onClose:s,userLocation:r})=>{const n=m.useRef(null),o=m.useRef(null),[l,a]=m.useState(null),[d,c]=m.useState({alpha:0,beta:0,gamma:0}),[h,y]=m.useState([]),{messages:f}=wt(),v=m.useRef(),S=(i,u,g,j)=>{const b=i*Math.PI/180,k=g*Math.PI/180,C=(g-i)*Math.PI/180,M=(j-u)*Math.PI/180,L=Math.sin(C/2)*Math.sin(C/2)+Math.cos(b)*Math.cos(k)*Math.sin(M/2)*Math.sin(M/2);return 6371e3*(2*Math.atan2(Math.sqrt(L),Math.sqrt(1-L)))},x=(i,u,g,j)=>{const N=i*Math.PI/180,b=g*Math.PI/180,k=(j-u)*Math.PI/180,C=Math.sin(k)*Math.cos(b),M=Math.cos(N)*Math.sin(b)-Math.sin(N)*Math.cos(b)*Math.cos(k);return(Math.atan2(C,M)*180/Math.PI+360)%360};m.useEffect(()=>t?((async()=>{try{const u=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}});a(u),n.current&&(n.current.srcObject=u)}catch(u){console.error("Error accessing camera:",u),E({title:"Camera Access Required",description:"Please grant camera permissions to use AR view",variant:"destructive"})}})(),()=>{l&&l.getTracks().forEach(u=>u.stop())}):void 0,[t]),m.useEffect(()=>{if(!t)return;const i=u=>{c({alpha:u.alpha||0,beta:u.beta||0,gamma:u.gamma||0})};return window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",i),()=>{window.removeEventListener("deviceorientation",i)}},[t]),m.useEffect(()=>{if(!r||!f)return;const i=f.filter(u=>u.position).map(u=>({id:u.id,content:u.content,lat:u.position.x,lng:u.position.y,distance:S(r.lat,r.lng,u.position.x,u.position.y),bearing:x(r.lat,r.lng,u.position.x,u.position.y),user:u.user})).filter(u=>u.distance<1e3).sort((u,g)=>u.distance-g.distance);y(i)},[f,r]),m.useEffect(()=>{if(!t||!o.current||!n.current)return;const i=o.current,u=i.getContext("2d");if(!u)return;const g=()=>{i.width=window.innerWidth,i.height=window.innerHeight,u.clearRect(0,0,i.width,i.height);const j=60,N=i.width/2,b=i.height/2;h.forEach(k=>{const C=(k.bearing-d.alpha+360)%360;if(C>180-j/2&&C<180+j/2){const M=N+(C-180)*(i.width/j),L=b-(d.beta-90)*10;w(u,M,L,k)}}),v.current=requestAnimationFrame(g)};return g(),()=>{v.current&&cancelAnimationFrame(v.current)}},[t,h,d]);const w=(i,u,g,j)=>{i.fillStyle="rgba(255, 255, 255, 0.1)",i.strokeStyle="rgba(255, 255, 255, 0.3)",i.lineWidth=1;const N=250,b=15,k=Math.max(12,16-j.distance/100);i.font=`${k}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`;const C=p(i,j.content,N-b*2),M=k*1.5,L=C.length*M+b*2+30,A=N,_=15;i.beginPath(),i.moveTo(u-A/2+_,g-L/2),i.lineTo(u+A/2-_,g-L/2),i.quadraticCurveTo(u+A/2,g-L/2,u+A/2,g-L/2+_),i.lineTo(u+A/2,g+L/2-_),i.quadraticCurveTo(u+A/2,g+L/2,u+A/2-_,g+L/2),i.lineTo(u-A/2+_,g+L/2),i.quadraticCurveTo(u-A/2,g+L/2,u-A/2,g+L/2-_),i.lineTo(u-A/2,g-L/2+_),i.quadraticCurveTo(u-A/2,g-L/2,u-A/2+_,g-L/2),i.closePath(),i.fillStyle="rgba(255, 255, 255, 0.1)",i.fill(),i.strokeStyle="rgba(255, 255, 255, 0.2)",i.stroke();const P=i.createLinearGradient(u-A/2,g-L/2,u+A/2,g+L/2);P.addColorStop(0,"rgba(102, 126, 234, 0.1)"),P.addColorStop(1,"rgba(240, 147, 251, 0.1)"),i.fillStyle=P,i.fill(),i.fillStyle="rgba(255, 255, 255, 0.9)",i.font=`bold ${k}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,i.fillText(j.user.name,u-A/2+b,g-L/2+b+k),i.fillStyle="rgba(255, 255, 255, 0.8)",i.font=`${k}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,C.forEach((I,R)=>{i.fillText(I,u-A/2+b,g-L/2+b+30+(R+1)*M)}),i.fillStyle="rgba(255, 255, 255, 0.6)",i.font=`${k-2}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`;const V=j.distance<100?`${Math.round(j.distance)}m away`:`${(j.distance/1e3).toFixed(1)}km away`;i.fillText(V,u-A/2+b,g+L/2-b);const T=20;i.save(),i.translate(u,g+L/2+T),i.rotate(j.bearing*Math.PI/180),i.beginPath(),i.moveTo(0,-T/2),i.lineTo(-T/3,T/2),i.lineTo(T/3,T/2),i.closePath(),i.fillStyle="rgba(102, 126, 234, 0.8)",i.fill(),i.restore()},p=(i,u,g)=>{const j=u.split(" "),N=[];let b="";return j.forEach(k=>{const C=b+(b?" ":"")+k;i.measureText(C).width>g&&b?(N.push(b),b=k):b=C}),b&&N.push(b),N};return t?e.jsxs("div",{className:"fixed inset-0 z-50 bg-black",children:[e.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}),e.jsx("canvas",{ref:o,className:"absolute inset-0 w-full h-full"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 glass-heavy rounded-b-3xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ae,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"text-white font-semibold",children:"AR View"}),e.jsxs("span",{className:"glass px-3 py-1 rounded-full text-xs text-white",children:[h.length," nearby Los"]})]}),e.jsx(O,{onClick:s,variant:"ghost",size:"icon",className:"text-white hover:bg-white/20",children:e.jsx(ve,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 glass-heavy rounded-t-3xl",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs(O,{className:"liquid-button flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"}),"Navigate"]}),e.jsxs(O,{className:"glass px-6 py-2 rounded-full text-white border-white/20",children:[e.jsx(La,{className:"w-4 h-4 mr-2"}),"Expand View"]})]}),e.jsx("p",{className:"text-center text-white/60 text-xs mt-3",children:"Move your device to explore messages around you"})]})]}):null};var sn={};class an{permission="default";watchId=null;userLocation=null;notificationOptions={enableNearbyMessages:!0,notificationRadius:500,enableFollowerUpdates:!0,enableReactions:!0,enableTrendingAlerts:!0};notifiedMessages=new Set;serviceWorkerRegistration=null;constructor(){this.initializeServiceWorker()}async initializeServiceWorker(){if("serviceWorker"in navigator&&"PushManager"in window)try{const s=await navigator.serviceWorker.register("/sw.js");this.serviceWorkerRegistration=s,console.log("Service Worker registered successfully")}catch(s){console.error("Service Worker registration failed:",s)}}async requestPermission(){if(!("Notification"in window))return E({title:"Notifications Not Supported",description:"Your browser does not support notifications",variant:"destructive"}),!1;try{return this.permission=await Notification.requestPermission(),this.permission==="granted"?(E({title:"Notifications Enabled",description:"You will receive notifications for nearby Los"}),await this.subscribeToPush(),this.startLocationTracking(),!0):(E({title:"Notifications Disabled",description:"You can enable notifications in your browser settings",variant:"destructive"}),!1)}catch(s){return console.error("Error requesting notification permission:",s),!1}}async subscribeToPush(){if(this.serviceWorkerRegistration)try{let s=await this.serviceWorkerRegistration.pushManager.getSubscription();if(!s){const r=sn.VITE_VAPID_PUBLIC_KEY||"BKagOI0KJq7YJ_XEXq1kBg2Xs-WdPxDKxiZZe3XBr4UzSZE-xx9MuvIV5hnhZ3lO9Vcnc5r_1xPbpHJknbKWjxM",n=this.urlBase64ToUint8Array(r);s=await this.serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})}await this.saveSubscription(s)}catch(s){console.error("Failed to subscribe to push notifications:",s)}}urlBase64ToUint8Array(s){const r="=".repeat((4-s.length%4)%4),n=(s+r).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(n),l=new Uint8Array(o.length);for(let a=0;a<o.length;++a)l[a]=o.charCodeAt(a);return l}async saveSubscription(s){const{data:{user:r}}=await Y.auth.getUser();if(!r)return;const{error:n}=await Y.from("push_subscriptions").upsert({user_id:r.id,subscription:JSON.stringify(s),updated_at:new Date().toISOString()});n&&console.error("Error saving push subscription:",n)}startLocationTracking(){if(!navigator.geolocation){console.error("Geolocation is not supported");return}this.watchId=navigator.geolocation.watchPosition(s=>{this.userLocation=s,this.checkNearbyMessages()},s=>{console.error("Error tracking location:",s)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}stopLocationTracking(){this.watchId!==null&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null)}async checkNearbyMessages(){if(!this.userLocation||!this.notificationOptions.enableNearbyMessages)return;const{latitude:s,longitude:r}=this.userLocation.coords,{data:n,error:o}=await Y.from("messages").select("*, profiles!messages_user_id_fkey(name, avatar_url)").gte("created_at",new Date(Date.now()-36e5).toISOString()).eq("is_public",!0);if(o){console.error("Error fetching nearby messages:",o);return}n?.forEach(l=>{const a=this.calculateDistance(s,r,l.lat,l.lng);a<=this.notificationOptions.notificationRadius&&!this.notifiedMessages.has(l.id)&&(this.sendNearbyMessageNotification(l,a),this.notifiedMessages.add(l.id))})}calculateDistance(s,r,n,o){const a=s*Math.PI/180,d=n*Math.PI/180,c=(n-s)*Math.PI/180,h=(o-r)*Math.PI/180,y=Math.sin(c/2)*Math.sin(c/2)+Math.cos(a)*Math.cos(d)*Math.sin(h/2)*Math.sin(h/2);return 6371e3*(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)))}sendNearbyMessageNotification(s,r){if(this.permission!=="granted")return;const n=r<100?`${Math.round(r)}m away`:`${(r/1e3).toFixed(1)}km away`,o=new Notification(`New Lo ${n}`,{body:`${s.profiles?.name||"Someone"}: ${s.content}`,icon:"/lovable-uploads/75b652b2-23ff-4231-8935-6f15e4221203.png",badge:"/lovable-uploads/75b652b2-23ff-4231-8935-6f15e4221203.png",tag:`message-${s.id}`,requireInteraction:!1,vibrate:[200,100,200],data:{messageId:s.id,lat:s.lat,lng:s.lng}});o.onclick=()=>{window.focus(),window.dispatchEvent(new CustomEvent("navigate-to-message",{detail:{lat:s.lat,lng:s.lng,messageId:s.id}})),o.close()}}async sendReactionNotification(s){this.permission!=="granted"||!this.notificationOptions.enableReactions||new Notification("New Reaction on Your Lo",{body:`${s.userName} reacted ${s.emoji} to "${s.messageContent}"`,icon:"/lovable-uploads/75b652b2-23ff-4231-8935-6f15e4221203.png",tag:`reaction-${Date.now()}`,vibrate:[100]})}async sendFollowerNotification(s){this.permission!=="granted"||!this.notificationOptions.enableFollowerUpdates||new Notification("New Follower",{body:`${s.userName} started following you`,icon:s.avatarUrl||"/lovable-uploads/75b652b2-23ff-4231-8935-6f15e4221203.png",tag:`follower-${s.userId}`,vibrate:[100,50,100]})}async sendTrendingNotification(s){this.permission!=="granted"||!this.notificationOptions.enableTrendingAlerts||new Notification("Trending Location Near You",{body:`${s.name} is trending with ${s.messageCount} new Los`,icon:"/lovable-uploads/75b652b2-23ff-4231-8935-6f15e4221203.png",tag:`trending-${s.name}`,vibrate:[200]})}updateNotificationOptions(s){this.notificationOptions={...this.notificationOptions,...s}}clearNotifiedMessages(){this.notifiedMessages.clear()}getPermissionStatus(){return this.permission}isLocationTracking(){return this.watchId!==null}}const ft=new an,rn=({onLocationSelect:t,className:s,userLocation:r})=>{const[n,o]=m.useState([]),[l,a]=m.useState(!0),[d,c]=m.useState("24h"),[h,y]=m.useState(!1);m.useEffect(()=>{f();const i=setInterval(f,6e4);return v(),()=>clearInterval(i)},[d]);const f=async()=>{a(!0);const i=new Date;let u=new Date;switch(d){case"1h":u=new Date(i.getTime()-60*60*1e3);break;case"24h":u=new Date(i.getTime()-24*60*60*1e3);break;case"7d":u=new Date(i.getTime()-7*24*60*60*1e3);break}try{const{data:g,error:j}=await Y.from("messages").select("lat, lng, location, user_id, created_at").gte("created_at",u.toISOString()).eq("is_public",!0);if(j)throw j;const N=new Map;g?.forEach(C=>{const M=`${C.lat.toFixed(4)},${C.lng.toFixed(4)}`;N.has(M)||N.set(M,{messages:[],users:new Set,lastActivity:new Date(C.created_at)});const L=N.get(M);L.messages.push(C),L.users.add(C.user_id);const A=new Date(C.created_at);A>L.lastActivity&&(L.lastActivity=A)});const b=[];N.forEach((C,M)=>{const[L,A]=M.split(",").map(Number),_=C.messages.length;let P=1;_>=50?P=5:_>=30?P=4:_>=15?P=3:_>=5&&(P=2);let V="stable";const T=C.messages.filter(I=>{const R=new Date(I.created_at).getTime(),z=(i.getTime()-u.getTime())/2;return R>i.getTime()-z});T.length>_*.6?V="rising":T.length<_*.3&&(V="falling"),b.push({id:M,name:C.messages[0]?.location||`Location ${b.length+1}`,lat:L,lng:A,messageCount:_,uniqueUsers:C.users.size,lastActivity:C.lastActivity.toISOString(),trend:V,heatLevel:P})});const k=b.sort((C,M)=>M.messageCount-C.messageCount).slice(0,10);if(o(k),r&&k.length>0){const C=k[0];S(r.lat,r.lng,C.lat,C.lng)<5e3&&C.messageCount>20&&ft.sendTrendingNotification({name:C.name,messageCount:C.messageCount})}}catch(g){console.error("Error fetching trending locations:",g)}finally{a(!1)}},v=()=>{const i=Y.channel("trending-locations").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},()=>{f()}).subscribe();return()=>{Y.removeChannel(i)}},S=(i,u,g,j)=>{const b=i*Math.PI/180,k=g*Math.PI/180,C=(g-i)*Math.PI/180,M=(j-u)*Math.PI/180,L=Math.sin(C/2)*Math.sin(C/2)+Math.cos(b)*Math.cos(k)*Math.sin(M/2)*Math.sin(M/2);return 6371e3*(2*Math.atan2(Math.sqrt(L),Math.sqrt(1-L)))},x=i=>{if(!r)return"";const u=S(r.lat,r.lng,i.lat,i.lng);return u<1e3?`${Math.round(u)}m`:`${(u/1e3).toFixed(1)}km`},w=i=>Array(i).fill(0).map((g,j)=>e.jsx(Ea,{className:"w-3 h-3 text-orange-500"},j)),p=i=>{switch(i){case"rising":return e.jsx(qe,{className:"w-4 h-4 text-green-500"});case"falling":return e.jsx(qe,{className:"w-4 h-4 text-red-500 rotate-180"});default:return e.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded-full"})}};return e.jsxs("div",{className:de("glass-card",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-white"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Trending Locations"})]}),e.jsx("div",{className:"flex gap-1",children:["1h","24h","7d"].map(i=>e.jsx("button",{onClick:()=>c(i),className:de("px-3 py-1 rounded-lg text-xs transition-all",d===i?"glass-heavy text-white":"glass text-white/60 hover:text-white"),children:i==="1h"?"Hour":i==="24h"?"Day":"Week"},i))})]}),l&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"liquid-loader"})}),!l&&e.jsxs("div",{className:de("space-y-2 transition-all",h?"max-h-[600px]":"max-h-[300px]","overflow-y-auto scrollbar-thin scrollbar-thumb-white/20"),children:[n.map((i,u)=>e.jsxs("button",{onClick:()=>t?.(i),className:"w-full glass p-3 rounded-xl hover:bg-white/10 transition-all group",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500/20 to-blue-500/20",children:e.jsx("span",{className:"text-sm font-bold text-white",children:u+1})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-white/70"}),e.jsx("span",{className:"font-medium text-white",children:i.name}),p(i.trend)]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"text-xs text-white/60",children:[i.messageCount," Los"]}),e.jsxs("span",{className:"text-xs text-white/60",children:[i.uniqueUsers," people"]}),r&&e.jsxs("span",{className:"text-xs text-white/60",children:[x(i)," away"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:w(i.heatLevel)})]}),e.jsx("div",{className:"mt-2 flex justify-end opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("span",{className:"flex items-center gap-1 text-xs text-blue-400",children:[e.jsx($e,{className:"w-3 h-3"}),"View on map"]})})]},i.id)),n.length===0&&e.jsx("div",{className:"text-center py-8 text-white/60",children:"No trending locations in the selected timeframe"})]}),n.length>3&&e.jsx(O,{onClick:()=>y(!h),variant:"ghost",className:"w-full mt-3 text-white/60 hover:text-white",children:h?"Show less":`Show all ${n.length} locations`})]})},nn=()=>{const{user:t}=De(),[s,r]=m.useState([]),[n,o]=m.useState(!1),[l,a]=m.useState(!1),d=async()=>{if(t){o(!0);try{const f=new Date(Date.now()-2592e6).toISOString(),{data:v,error:S}=await Y.from("messages").select("id, content, location, created_at, expires_at, lat, lng, is_public, user_id").eq("user_id",t.id).gte("created_at",f).or("message_type.is.null,message_type.neq.event").order("created_at",{ascending:!1});if(S)throw S;r(v||[]),console.log(`üìä Found ${v?.length||0} test posts`)}catch(f){console.error("Error fetching test posts:",f),E({title:"Error fetching posts",description:f.message,variant:"destructive"})}finally{o(!1)}}},c=async f=>{try{const v=new Date(Date.now()+6048e5).toISOString(),{error:S}=await Y.from("messages").update({expires_at:v}).eq("id",f);if(S)throw S;E({title:"Post extended",description:"Post expiration extended by 7 days"}),d()}catch(v){console.error("Error extending post:",v),E({title:"Error extending post",description:v.message,variant:"destructive"})}},h=async()=>{try{const f=new Date(Date.now()+6048e5).toISOString(),{error:v}=await Y.from("messages").update({expires_at:f}).eq("user_id",t?.id).or("message_type.is.null,message_type.neq.event");if(v)throw v;E({title:"All posts extended! üéâ",description:`Extended ${s.length} posts by 7 days`}),d()}catch(f){console.error("Error extending posts:",f),E({title:"Error extending posts",description:f.message,variant:"destructive"})}},y=async f=>{if(confirm("Are you sure you want to delete this post?"))try{const{error:v}=await Y.from("messages").delete().eq("id",f);if(v)throw v;E({title:"Post deleted",description:"Test post has been removed"}),d()}catch(v){console.error("Error deleting post:",v),E({title:"Error deleting post",description:v.message,variant:"destructive"})}};return m.useEffect(()=>{t&&l&&d()},[t,l]),s.length===0?null:l?e.jsxs("div",{className:"fixed bottom-4 left-4 z-40 glass-card w-80 max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-white/20",children:[e.jsx("h3",{className:"text-white font-semibold",children:"Test Posts Manager"}),e.jsx("button",{onClick:()=>a(!1),className:"text-white/60 hover:text-white",children:"√ó"})]}),e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{onClick:d,disabled:n,size:"sm",className:"liquid-button flex-1",children:[e.jsx(ds,{className:"w-3 h-3 mr-1"}),"Refresh"]}),e.jsxs(O,{onClick:h,disabled:n||s.length===0,size:"sm",className:"glass hover:bg-white/20 text-white flex-1",children:[e.jsx(je,{className:"w-3 h-3 mr-1"}),"Extend All"]})]}),n&&e.jsx("div",{className:"text-center text-white/60 py-4",children:"Loading posts..."}),!n&&s.length===0&&e.jsx("div",{className:"text-center text-white/60 py-4",children:"No test posts found"}),s.map(f=>{const v=new Date(f.expires_at)<new Date,S=new Date(f.created_at).toLocaleDateString(),x=new Date(f.expires_at).toLocaleDateString();return e.jsxs("div",{className:`glass p-3 rounded-lg ${v?"border-red-500/30":"border-green-500/30"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-sm font-medium truncate",children:f.content}),e.jsxs("p",{className:"text-white/60 text-xs",children:["üìç ",f.location||"No location"]}),e.jsxs("p",{className:"text-white/60 text-xs",children:["üìÖ ",S," ‚Üí ",x]})]}),e.jsx("div",{className:`w-3 h-3 rounded-full ${v?"bg-red-500":"bg-green-500"}`})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>c(f.id),disabled:n,className:"glass px-2 py-1 rounded text-xs text-white hover:bg-white/20 transition-all",children:e.jsx(je,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>y(f.id),disabled:n,className:"glass px-2 py-1 rounded text-xs text-red-400 hover:bg-red-500/20 transition-all",children:e.jsx(cs,{className:"w-3 h-3"})})]})]},f.id)})]})]}):e.jsxs("button",{onClick:()=>a(!0),className:"fixed bottom-4 left-4 z-40 glass px-4 py-2 rounded-full text-white text-sm hover:bg-white/20 transition-all",title:"Manage Test Posts",children:[e.jsx(Ke,{className:"w-4 h-4 inline mr-2"}),"Posts (",s.length,")"]})},In=()=>{const[t,s]=m.useState(!1),[r,n]=m.useState(!1),[o,l]=m.useState(!1),[a,d]=m.useState(!1),[c,h]=m.useState(null),[y,f]=m.useState(!1),v=m.useRef(null),{addMessage:S}=wt(),{user:x}=De();m.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(j=>{h({lat:j.coords.latitude,lng:j.coords.longitude})},j=>{console.error("Error getting location:",j)}),"Notification"in window&&f(Notification.permission==="granted")},[]);const w=j=>{s(j),console.log("üè† HOME: Events-only mode changed to:",j)},p=async()=>{if(y)ft.stopLocationTracking(),f(!1),E({title:"Notifications disabled",description:"You can re-enable them anytime"});else{const j=await ft.requestPermission();f(j)}},i=j=>{v.current&&v.current.panTo({lat:j.lat,lng:j.lng}),d(!1)},u=()=>{console.log("üìç HOME: Opening post creation modal"),console.log("üìç HOME: Current showPostModal state:",r),n(!0),console.log("üìç HOME: showPostModal set to true")},g=async j=>{if(console.log("üìç New post created:",j),!x){E({title:"Authentication required",description:"Please sign in to create posts",variant:"destructive"});return}try{const{data:N,error:b}=await Y.from("profiles").select("id").eq("id",x.id).single();if(b&&b.code==="PGRST116"){console.log("Creating user profile...");const{error:L}=await Y.from("profiles").insert({id:x.id,name:x.email?.split("@")[0]||"Anonymous",avatar_url:null});L&&console.error("Failed to create profile:",L)}const k={content:j.content||"",user_id:x.id,lat:j.location.lat,lng:j.location.lng,location:j.location.name||null,is_public:!j.isPrivate,media_url:j.mediaUrl||null,expires_at:new Date(Date.now()+24*60*60*1e3).toISOString()};console.log("üìç Attempting to save post with data:",k),console.log("üìç Current user:",x);const{data:C,error:M}=await Y.from("messages").insert(k).select().single();if(M)throw console.error("Supabase error details:",M),console.error("Error code:",M.code),console.error("Error message:",M.message),console.error("Error details:",M.details),console.error("Error hint:",M.hint),M;if(C){const L={id:`new-${C.id}`,content:C.content,isPublic:C.is_public,location:C.location||"",timestamp:C.created_at||new Date().toISOString(),expiresAt:C.expires_at||new Date(Date.now()+864e5).toISOString(),mediaUrl:C.media_url,user:{name:x.email?.split("@")[0]||"Anonymous",avatar:x.user_metadata?.avatar_url||""},position:{x:C.lat||j.location.lat,y:C.lng||j.location.lng}};console.log("üìç Adding animated message to map:",L),S(L),setTimeout(()=>{console.log("üîÑ Triggering global message refresh..."),window.dispatchEvent(new CustomEvent("refreshMessages"))},100),setTimeout(()=>{const A={...L,id:C.id};console.log("üìç Replacing with final message:",A),window.dispatchEvent(new CustomEvent("refreshMessages"))},3e3)}E({title:"Lo posted! üéâ",description:"Your Lo is now live on the map"}),n(!1)}catch(N){console.error("Error creating post:",N),E({title:"Failed to create Lo",description:"Something went wrong. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"flex h-screen w-screen flex-col overflow-hidden relative",children:[e.jsx("header",{className:"relative z-30 px-4",style:{paddingTop:"env(safe-area-inset-top, 1rem)"},children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"glass flex min-h-[44px] items-center gap-2 rounded-3xl px-4 py-2",children:[e.jsx("img",{src:"/lovable-uploads/75b652b2-23ff-4231-8935-6f15e4221203.png",alt:"Lo Logo",className:"h-8 drop-shadow-lg"}),e.jsx(rs,{className:"h-5 w-5 text-teal-400"}),e.jsx("span",{className:"text-white font-semibold liquid-text",children:"Lo"})]}),e.jsxs("div",{className:"glass flex min-h-[44px] items-center gap-2 rounded-3xl px-3 py-2",children:[e.jsx("button",{onClick:()=>l(!0),className:"glass flex min-h-[44px] min-w-[44px] items-center justify-center rounded-full px-3 transition-colors hover:bg-white/20",title:"AR View",children:e.jsx(Ae,{className:"h-5 w-5 text-white"})}),e.jsx("button",{onClick:p,className:de("glass flex min-h-[44px] min-w-[44px] items-center justify-center rounded-full px-3 transition-colors hover:bg-white/20",y&&"bg-teal-500/20"),title:"Notifications",children:e.jsx(Aa,{className:de("h-5 w-5",y?"text-teal-400":"text-white")})}),e.jsx("button",{onClick:()=>d(!a),className:"glass flex min-h-[44px] min-w-[44px] items-center justify-center rounded-full px-3 transition-colors hover:bg-white/20",title:"Trending",children:e.jsx(qe,{className:"h-5 w-5 text-white"})})]})]})}),e.jsxs("main",{className:"relative flex-1",children:[e.jsx(Fs,{ref:v,isEventsOnlyMode:t}),a&&e.jsx("div",{className:"pointer-events-auto absolute top-6 right-4 z-40 w-80 max-h-[70vh] overflow-hidden animate-slide-in-right",children:e.jsx(rn,{onLocationSelect:i,userLocation:c})}),e.jsx("div",{className:"pointer-events-auto absolute bottom-32 left-1/2 z-40 -translate-x-1/2",children:e.jsx(Zr,{onEventsOnlyModeChange:w})})]}),e.jsx(Ba,{onPostClick:u}),e.jsx(en,{isOpen:r,onClose:()=>n(!1),onPostCreated:g}),e.jsx(tn,{isOpen:o,onClose:()=>l(!1),userLocation:c}),e.jsx(nn,{})]})};export{In as default};
