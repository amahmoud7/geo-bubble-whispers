import{j as e}from"./ui-DPaiNdCo.js";import{r as x,L as M}from"./vendor-Erj86lFQ.js";import{B as h,u as B}from"./index--9NxnRVI.js";import{I as L}from"./input-B56E1p0u.js";import{A,a as O,b as k}from"./avatar-mWBahg0l.js";import{u as z,a as F}from"./useRealtimeMessaging-DfU7FkGV.js";import{N as y}from"./Navigation-Cx6-bI2t.js";import{B as _}from"./BottomNavigation-D2RT3nlO.js";import{B as V}from"./badge-Cp48qLeW.js";import{D as E,a as Q,b as R,d as w}from"./dropdown-menu-BJEofygb.js";import{ac as u,S as T,ae as q,af as U,ag as Y,ah as G,T as H,I as W,a as J,M as X,b as K,A as C,ai as Z,t as ee}from"./icons-KaFMl-Yu.js";import{t as se,c as ae,a as I}from"./en-US-BL2atPzf.js";import{s as S,f as D}from"./format-vo_1rm9l.js";import"./supabase-ptc-ZlA7.js";import"./query-BhlUNxwW.js";import"./maps-CAbQPzAx.js";function te(a,r){const n=se(a);return isNaN(r)?ae(a,NaN):(n.setDate(n.getDate()+r),n)}function P(a,r){const n=S(a),c=S(r);return+n==+c}function re(a){return P(a,I(a))}function ne(a,r){return te(a,-r)}function ie(a){return P(a,ne(I(a),1))}const le=({conversations:a,userPresence:r,searchQuery:n="",onSearchChange:c,className:o=""})=>{const[i,m]=x.useState(n),g=s=>{m(s),c?.(s)},p=a.filter(s=>s.other_user_name?.toLowerCase().includes(i.toLowerCase())||s.other_user_username?.toLowerCase().includes(i.toLowerCase())||s.last_message_content?.toLowerCase().includes(i.toLowerCase())),d=s=>{const t=new Date(s);return re(t)?D(t,"HH:mm"):ie(t)?"Yesterday":D(t,"MMM dd")},f=s=>{const{last_message_content:t,last_message_media_type:l,last_message_sender_id:N}=s;if(!t&&!l)return"No messages yet";const v=N===s.other_user_id?"":"You: ";if(l){const $={image:e.jsx(W,{className:"h-3 w-3 inline mr-1"}),video:e.jsx(J,{className:"h-3 w-3 inline mr-1"}),voice:e.jsx(X,{className:"h-3 w-3 inline mr-1"}),location:e.jsx(K,{className:"h-3 w-3 inline mr-1"})};return e.jsxs("span",{className:"flex items-center",children:[$[l],v,l==="image"?"Photo":l==="video"?"Video":l==="voice"?"Voice message":l==="location"?"Location":l]})}return`${v}${t}`},j=s=>{const t=r[s];if(!t)return!1;const l=new Date(Date.now()-5*60*1e3),N=new Date(t.last_seen);return t.is_online&&N>l},b=(s,t)=>r[t]?.is_typing_in_conversation===s;return a.length===0&&i===""?e.jsxs("div",{className:`text-center py-12 ${o}`,children:[e.jsx(u,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"No conversations yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Start a conversation by finding someone to message"})]}):e.jsxs("div",{className:o,children:[c&&e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(L,{type:"text",placeholder:"Search conversations...",value:i,onChange:s=>g(s.target.value),className:"pl-9 bg-background"})]})}),e.jsx("div",{className:"divide-y",children:p.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:i?"No conversations found":"No conversations yet"})}):p.map(s=>e.jsx(oe,{conversation:s,isOnline:j(s.other_user_id),isTyping:b(s.id,s.other_user_id),lastMessagePreview:f(s),formattedTime:d(s.last_message_at)},s.id))})]})},oe=({conversation:a,isOnline:r,isTyping:n,lastMessagePreview:c,formattedTime:o})=>e.jsx(M,{to:`/chat/${a.id}`,className:"block hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center space-x-3 p-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(A,{className:"h-14 w-14",children:[e.jsx(O,{src:a.other_user_avatar||"",alt:a.other_user_name||"User"}),e.jsx(k,{children:(a.other_user_name||a.other_user_username||"U").charAt(0).toUpperCase()})]}),r&&e.jsx("div",{className:"absolute bottom-0 right-0 h-4 w-4 bg-green-500 border-2 border-background rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"font-semibold text-sm truncate pr-2",children:a.other_user_name||a.other_user_username||"Unknown User"}),e.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[a.has_unread_messages&&e.jsx(V,{className:"h-2 w-2 p-0 bg-blue-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:o})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-muted-foreground truncate pr-2 flex-1",children:n?e.jsx("span",{className:"text-blue-500 italic",children:"typing..."}):c}),e.jsxs(E,{children:[e.jsx(Q,{asChild:!0,onClick:i=>i.preventDefault(),children:e.jsx(h,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100",children:e.jsx(q,{className:"h-4 w-4"})})}),e.jsxs(R,{align:"end",children:[e.jsx(w,{children:a.is_muted_by_1||a.is_muted_by_2?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Unmute"]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Mute"]})}),e.jsxs(w,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Archive"]}),e.jsxs(w,{className:"text-destructive",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]})]})}),ce=[{id:"8",name:"Lisa Anderson",username:"@lisa_a",avatar:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop&crop=face",isOnline:!0},{id:"9",name:"James Wilson",username:"@james_w",avatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face",isOnline:!1},{id:"10",name:"Maria Garcia",username:"@maria_g",avatar:"https://images.unsplash.com/photo-1544725176-7c40e5a71c5e?w=150&h=150&fit=crop&crop=face",isOnline:!0}],De=()=>{const[a,r]=x.useState(""),[n,c]=x.useState("messages"),[o,i]=x.useState(!1),{user:m}=B(),{conversations:g,conversationsLoading:p,createOrGetConversation:d,userPresence:f}=z();F();const j=ce.filter(s=>s.name.toLowerCase().includes(a.toLowerCase())||s.username.toLowerCase().includes(a.toLowerCase())),b=async s=>{try{await d.mutateAsync(s),i(!1)}catch(t){console.error("Error creating conversation:",t)}};return m?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-white pb-20",children:[e.jsx(y,{}),e.jsxs("div",{className:"w-full min-h-screen",children:[e.jsx("div",{className:"sticky top-16 bg-white/80 backdrop-blur-xl border-b border-gray-200/50 z-10",style:{paddingTop:"env(safe-area-inset-top, 0px)"},children:e.jsxs("div",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(M,{to:"/home",children:e.jsx(h,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full hover:bg-gray-100 transition-all duration-200",children:e.jsx(C,{className:"h-5 w-5"})})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-lo-navy to-lo-teal bg-clip-text text-transparent",children:m.email?.split("@")[0]||"Messages"}),e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Stay connected with friends"})]}),e.jsx("div",{className:"p-2 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full",children:e.jsx(u,{className:"h-4 w-4 text-purple-500"})})]})]}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>i(!o),className:`h-10 w-10 rounded-full transition-all duration-200 ${o?"bg-lo-teal/10 text-lo-teal hover:bg-lo-teal/20":"hover:bg-gray-100"}`,children:o?e.jsx(C,{className:"h-5 w-5"}):e.jsx(Z,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>c("messages"),className:`flex-1 py-3 px-4 text-center rounded-2xl font-semibold transition-all duration-300 ${n==="messages"?"bg-gradient-to-r from-lo-teal to-blue-500 text-white shadow-lg shadow-lo-teal/25":"text-gray-600 hover:text-gray-800 hover:bg-gray-100/80 backdrop-blur-sm"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{children:"Messages"})]})}),e.jsx("button",{onClick:()=>c("requests"),className:`flex-1 py-3 px-4 text-center rounded-2xl font-semibold transition-all duration-300 ${n==="requests"?"bg-gradient-to-r from-lo-teal to-blue-500 text-white shadow-lg shadow-lo-teal/25":"text-gray-600 hover:text-gray-800 hover:bg-gray-100/80 backdrop-blur-sm"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:"Requests"})]})})]})]})}),!o&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-4 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"}),e.jsx(L,{type:"text",placeholder:"Search messages, people, content...",value:a,onChange:s=>r(s.target.value),className:"w-full h-11 pl-12 pr-4 bg-gray-100/80 border-0 rounded-2xl text-base placeholder:text-gray-500 focus:bg-white focus:ring-2 focus:ring-lo-teal/20 transition-all duration-200"})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:o?e.jsxs("div",{className:"px-4 space-y-2",children:[e.jsxs("div",{className:"py-3",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-2",children:"Start New Conversation"}),e.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Find people to connect with"})]}),j.map(s=>e.jsxs("div",{className:"flex items-center space-x-4 py-4 px-3 rounded-2xl hover:bg-white hover:shadow-lg cursor-pointer transition-all duration-300 bg-white/50 backdrop-blur-sm border border-gray-200/50",onClick:()=>b(s.id),children:[e.jsxs("div",{className:"relative",children:[e.jsxs(A,{className:"h-16 w-16 ring-2 ring-white shadow-lg",children:[e.jsx(O,{src:s.avatar,alt:s.name}),e.jsx(k,{className:"bg-gradient-to-r from-lo-teal to-blue-500 text-white font-semibold text-lg",children:s.name.charAt(0)})]}),s.isOnline&&e.jsx("div",{className:"absolute -bottom-1 -right-1 h-5 w-5 bg-green-500 border-3 border-white rounded-full shadow-lg animate-pulse"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 font-medium",children:s.username}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s.bio})]}),e.jsx(h,{className:"bg-gradient-to-r from-lo-teal to-blue-500 hover:from-lo-teal/90 hover:to-blue-500/90 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-200 px-6 py-2 rounded-full",size:"sm",disabled:d.isPending,children:d.isPending?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-white/50 rounded-full animate-pulse"}),e.jsx("span",{children:"Starting..."})]}):"Message"})]},s.id))]}):e.jsx("div",{className:"flex-1",children:n==="messages"?e.jsx(le,{conversations:g,userPresence:f,searchQuery:a,onSearchChange:r}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(u,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"No message requests"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"When someone who isn't following you sends you a message, it will appear here"})]})})})]}),e.jsx(_,{})]}):e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx(y,{}),e.jsx("div",{className:"p-4 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Please sign in to view your inbox."})}),e.jsx(_,{})]})};export{De as default};
