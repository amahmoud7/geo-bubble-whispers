import{s as S,c as M,B as h,t as p}from"./index--9NxnRVI.js";import{b as O}from"./query-BhlUNxwW.js";import{j as e}from"./ui-DPaiNdCo.js";import{r as j}from"./vendor-Erj86lFQ.js";import{D as B,a as P,f as T}from"./dialog-DeOXp7R6.js";import{B as v}from"./badge-Cp48qLeW.js";import{X as R,_ as D,a2 as E,b as N,v as w,a8 as G,a9 as U,N as q,aw as A,a as F,ax as Y,ay as W,Y as H}from"./icons-KaFMl-Yu.js";const te=()=>{const{data:c=[],isLoading:m,error:s,refetch:g}=O({queryKey:["event-messages"],queryFn:async()=>{const{data:t,error:a}=await S.from("messages").select(`
          id,
          content,
          media_url,
          location,
          lat,
          lng,
          event_source,
          external_event_id,
          event_url,
          event_title,
          event_venue,
          event_start_date,
          event_price_min,
          event_price_max,
          created_at,
          expires_at
        `).eq("message_type","event").gt("expires_at",new Date().toISOString()).gte("event_start_date",new Date(Date.now()-144e5).toISOString()).order("event_start_date",{ascending:!0});if(a)throw console.error("âŒ Error fetching event messages:",a),a;return console.log(`ðŸ“‹ Loaded ${t?.length||0} event messages from database`),t?.length>0&&console.log("ðŸŽ« Event messages:",t.map(n=>`${n.event_title} at ${n.event_venue}`)),t},refetchInterval:3e5}),b=async()=>{try{console.log("ðŸŽ« Starting Ticketmaster event fetch (top 10 events)...");const{data:t,error:a}=await S.functions.invoke("fetch-events-realtime",{body:{source:"ticketmaster"}});if(a)throw console.error("âŒ Supabase function error:",a),a;return console.log("âœ… Ticketmaster fetch response:",t),console.log("ðŸ”„ Refetching events from database..."),g(),t}catch(t){throw console.error("âŒ Error fetching Ticketmaster events:",t),t}},i=t=>{const a=new Date(Date.now()+t*60*60*1e3);return c.filter(n=>new Date(n.event_start_date)<=a)};return{events:c,isLoading:m,error:s,refetch:g,fetchTicketmasterEvents:b,getEventsStartingWithin:i,getEventsByLocation:(t,a,n=10)=>c.filter(x=>{if(!x.lat||!x.lng)return!1;const o=Math.abs(x.lat-t),u=Math.abs(x.lng-a);return Math.sqrt(o*o+u*u)*69<=n}),eventsStartingSoon:i(2),eventsToday:i(24)}};function d({className:c,...m}){return e.jsx("div",{className:M("animate-pulse rounded-md bg-muted",c),...m})}const ae=({isOpen:c,onClose:m,event:s,isLoading:g=!1,relatedEvents:b=[]})=>{const[i,_]=j.useState(!1),[t,a]=j.useState(!1),[n,x]=j.useState(!1);if(j.useState("details"),!s&&!g)return null;const o=s?new Date(s.event_start_date):new Date,u=s&&o.getTime()-Date.now()<2*60*60*1e3,f=s&&o.getTime()<Date.now(),k=()=>{_(!i),p({title:i?"Event removed from saved":"Event saved!",description:i?"Event removed from your saved list":"You can find this in your saved events",duration:2e3})},l=s?(r=>{const y=new Date(r);return{full:y.toLocaleString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),time:y.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),date:y.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}})(s.event_start_date):null,C=()=>{s?.event_url&&(window.open(s.event_url,"_blank"),p({title:"Redirecting to tickets",description:"Opening Ticketmaster in a new tab",duration:2e3}))},$=async()=>{if(s)if(navigator.share)try{await navigator.share({title:s.event_title,text:`Check out this event: ${s.event_title} at ${s.event_venue}`,url:s.event_url||window.location.href}),p({title:"Event shared!",description:"Thanks for sharing this event",duration:2e3})}catch{}else{const r=`${s.event_title}
ðŸ“ ${s.event_venue}
ðŸ• ${l?.full}
ðŸŽŸï¸ ${s.event_url}`;navigator.clipboard.writeText(r),p({title:"Event details copied!",description:"Event information has been copied to your clipboard.",duration:2e3})}},L=()=>{if(s?.lat&&s?.lng){const r=`https://maps.google.com/maps?daddr=${s.lat},${s.lng}`;window.open(r,"_blank"),p({title:"Opening directions",description:"Launching Google Maps with directions",duration:2e3})}},I=r=>r==="ticketmaster"?"bg-blue-100 text-blue-800 border-blue-300":"bg-green-100 text-green-800 border-green-300",z=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{className:"h-64 w-full rounded-lg"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{className:"h-6 w-3/4"}),e.jsx(d,{className:"h-4 w-full"}),e.jsx(d,{className:"h-4 w-2/3"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(d,{className:"h-8 w-20"}),e.jsx(d,{className:"h-8 w-24"})]})]})]});return e.jsx(B,{open:c,onOpenChange:m,children:e.jsx(P,{className:"max-w-4xl max-h-[95vh] p-0 overflow-hidden bg-white rounded-3xl",children:g?e.jsx("div",{className:"p-6",children:e.jsx(z,{})}):s?e.jsx("div",{className:"h-[95vh] flex flex-col",children:e.jsxs("div",{className:"flex-1 overflow-y-auto overscroll-behavior-contain",children:[e.jsxs("div",{className:"relative",children:[e.jsx(h,{onClick:m,variant:"ghost",size:"sm",className:"absolute top-4 right-4 z-20 bg-white/90 hover:bg-white rounded-full w-10 h-10 p-0 shadow-lg","aria-label":"Close modal",children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx("div",{className:"relative",children:s.media_url&&!n?e.jsxs("div",{className:"relative h-80 lg:h-96 overflow-hidden",children:[e.jsx("img",{src:s.media_url,alt:s.event_title,className:`w-full h-full object-cover transition-opacity duration-300 ${t?"opacity-100":"opacity-0"}`,onLoad:()=>a(!0),onError:()=>x(!0)}),!t&&e.jsx(d,{className:"absolute inset-0"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"}),e.jsxs("div",{className:"absolute bottom-6 left-6 right-16 text-white",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsxs(v,{variant:"secondary",className:`${I(s.event_source)} border font-semibold backdrop-blur-sm`,children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),s.event_source.toUpperCase()]}),u&&e.jsxs(v,{variant:"destructive",className:"bg-red-500/90 text-white animate-pulse backdrop-blur-sm",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"STARTING SOON"]}),f&&e.jsx(v,{variant:"secondary",className:"bg-gray-500/90 text-white backdrop-blur-sm",children:"PAST EVENT"})]}),e.jsx("h1",{className:"text-3xl lg:text-4xl font-bold mb-2 leading-tight",children:s.event_title}),e.jsxs("div",{className:"flex items-center space-x-4 text-white/90",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(N,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:s.event_venue})]}),l&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{children:l.date})]})]})]})]}):e.jsxs("div",{className:"bg-gradient-to-br from-amber-500 to-orange-600 p-8 text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-white/5 opacity-20"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsxs(v,{variant:"secondary",className:"bg-white/20 text-white border-white/30 backdrop-blur-sm",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),s.event_source.toUpperCase()]}),u&&e.jsxs(v,{variant:"destructive",className:"bg-red-500/90 text-white animate-pulse backdrop-blur-sm",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"STARTING SOON"]})]}),e.jsx("h1",{className:"text-3xl lg:text-4xl font-bold mb-3 leading-tight",children:s.event_title}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center space-y-2 lg:space-y-0 lg:space-x-6 text-white/90",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:s.event_venue})]}),l&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l.date}),e.jsx("p",{className:"text-xl font-bold",children:l.time})]})]})]})]})]})})]}),e.jsx("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{onClick:k,variant:"ghost",size:"sm",className:`rounded-full ${i?"text-red-600 hover:text-red-700":"text-gray-600 hover:text-gray-700"}`,children:e.jsx(G,{className:`w-4 h-4 ${i?"fill-current":""}`})}),e.jsx(h,{onClick:$,variant:"ghost",size:"sm",className:"rounded-full text-gray-600 hover:text-gray-700",children:e.jsx(U,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex items-center space-x-2",children:l&&e.jsx("div",{className:"text-sm text-gray-600",children:e.jsx("span",{className:"font-medium",children:T(o,{addSuffix:!0})})})})]})}),e.jsxs("div",{className:"px-6 py-6 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[l&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(w,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"When"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-bold text-xl text-blue-700",children:l.time}),e.jsx("p",{className:"font-medium text-gray-900",children:l.date}),e.jsx("p",{className:"text-sm text-gray-600",children:T(o,{addSuffix:!0})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(N,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Where"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.event_venue}),s.location&&e.jsx("p",{className:"text-sm text-gray-600",children:s.location}),s.lat&&s.lng&&e.jsxs(h,{onClick:L,variant:"outline",size:"sm",className:"mt-3 rounded-xl border-green-300 text-green-700 hover:bg-green-50",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Get Directions"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-yellow-50 rounded-2xl p-6 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-600 rounded-xl flex items-center justify-center",children:e.jsx(A,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Pricing"})]}),e.jsx("div",{className:"space-y-2",children:s.event_price_min?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-bold text-xl text-amber-700",children:["From $",s.event_price_min,s.event_price_max&&s.event_price_max!==s.event_price_min&&` - $${s.event_price_max}`]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Prices may vary by seating"})]}):e.jsx("p",{className:"text-gray-600",children:"Check official site for pricing"})})]})]}),s.content&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-lg text-gray-900 mb-4 flex items-center space-x-2",children:[e.jsx(F,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{children:"About This Event"})]}),e.jsx("div",{className:"prose prose-gray max-w-none",children:e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-line",children:s.content.replace(/[ðŸŽ«âœ¨ðŸŽµðŸŽŸï¸ðŸ’°ðŸ•ðŸ“#]/g,"").trim()})})]}),e.jsx("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6 border border-amber-200",children:e.jsx("div",{className:"text-center space-y-4",children:f?e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-700",children:"This event has passed"}),e.jsx("p",{className:"text-gray-600",children:"Check out similar upcoming events"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Ready to go?"}),e.jsx("p",{className:"text-gray-600",children:"Secure your spot at this amazing event. Tickets are available now!"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(h,{onClick:C,disabled:f,className:"flex-1 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white text-lg py-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-200",size:"lg",children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),"Get Tickets on ",s.event_source==="ticketmaster"?"Ticketmaster":"Eventbrite"]}),e.jsx(h,{onClick:k,variant:"outline",size:"lg",className:"border-amber-300 text-amber-700 hover:bg-amber-100 rounded-2xl px-6",children:e.jsx(W,{className:`w-5 h-5 ${i?"fill-current":""}`})})]})]})})}),e.jsx("div",{className:"text-xs text-gray-500 bg-gray-50 p-4 rounded-xl border border-gray-200",children:e.jsxs("p",{className:"leading-relaxed",children:[e.jsx("strong",{children:"Disclaimer:"})," Ticket prices and availability are subject to change. You will be redirected to ",s.event_source==="ticketmaster"?"Ticketmaster":"Eventbrite"," to complete your purchase. Event details are provided for informational purposes only."]})}),b.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-lg text-gray-900 mb-4 flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{children:"More Events You Might Like"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:b.slice(0,4).map(r=>e.jsxs("div",{className:"p-4 rounded-xl border border-gray-200 hover:border-gray-300 cursor-pointer transition-all duration-200 hover:shadow-md",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1 line-clamp-2",children:r.event_title}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{className:"flex items-center space-x-1",children:[e.jsx(N,{className:"w-3 h-3"}),e.jsx("span",{children:r.event_venue})]}),e.jsxs("p",{className:"flex items-center space-x-1",children:[e.jsx(w,{className:"w-3 h-3"}),e.jsx("span",{children:new Date(r.event_start_date).toLocaleDateString()})]})]})]},r.id))})]})]})]})}):null})})};export{ae as E,te as u};
