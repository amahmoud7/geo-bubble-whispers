import{u as H,j as e,B as l}from"./index-Cak4IDZW.js";import{r as o,L as J,h as te,N as X}from"./vendor-C9QPK5wj.js";import{A as F,a as W,b as K}from"./avatar-CL55SoGP.js";import{B as Z}from"./badge-mL5Y5NT_.js";import{S as de}from"./scroll-area-CI2ZTqk6.js";import{D as ce,a as ge,b as he,d as T}from"./dropdown-menu-C9GTHY1B.js";import{f as O,D as pe,a as fe,b as Ne,c as xe}from"./dialog-BkT8nh5t.js";import{I as we}from"./input-Bx49E1sK.js";import{u as q,a as ee}from"./useRealtimeMessaging-CBxMTjZz.js";import{a9 as se,ae as ve,z as De,af as ke,P as Ue,T as ne,b as re,ag as ae,a8 as me,aa as Ee,X as Y,ah as je,ai as Ve,q as Me,M as Ie,I as ye,a as Ce,A as Q,aj as Be,V as _e}from"./icons-Ed5u1gBp.js";import{T as Re}from"./textarea-Bj8JMMO3.js";import{N as Se}from"./Navigation-f0TQFZx3.js";import{B as Ae}from"./BottomNavigation-CLXXvX1s.js";import"./supabase-BOJTsyNu.js";import"./ui-WyaPNYUs.js";import"./query-BAKOfRYG.js";import"./maps-CLEk8SoF.js";import"./index-BdQq_4o_.js";import"./en-US-BL2atPzf.js";const Pe=["â¤ï¸","ðŸ‘","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ˜¡"],Te=({message:s,isOwn:i,showAvatar:w=!0,onReply:I,className:k=""})=>{const{user:U}=H(),{addReaction:_,removeReaction:A,editMessage:P,deleteMessage:y}=q(),[c,g]=o.useState(!1),[C,u]=o.useState(!1),[h,j]=o.useState(s.content||""),[v,D]=o.useState(!1),V=o.useRef(null),M=async a=>{if(!U)return;s.reactions?.find(N=>N.user_id===U.id&&N.reaction===a)?await A.mutateAsync({messageId:s.id,reaction:a}):await _.mutateAsync({messageId:s.id,reaction:a}),g(!1)},E=async()=>{if(!h.trim()||h===s.content){u(!1);return}await P.mutateAsync({messageId:s.id,content:h}),u(!1)},R=async()=>{window.confirm("Are you sure you want to delete this message?")&&await y.mutateAsync(s.id)},m=()=>{s.content&&navigator.clipboard.writeText(s.content)},r=()=>{V.current&&(v?V.current.pause():V.current.play(),D(!v))},t=a=>{const p=Math.floor(a/60),N=a%60;return`${p}:${N.toString().padStart(2,"0")}`},d=()=>{if(!i||!s.status)return null;const a=s.status.find(p=>p.user_id!==U?.id);return a?a.status:"sent"},f=()=>s.is_deleted?e.jsxDEV("div",{className:"text-muted-foreground italic text-sm",children:"This message was deleted"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:120,columnNumber:9},void 0):s.media_type==="location"&&s.lat&&s.lng?e.jsxDEV("div",{className:"flex items-center space-x-2 p-3 bg-muted/50 rounded-lg",children:[e.jsxDEV(re,{className:"h-4 w-4 text-blue-500"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:129,columnNumber:11},void 0),e.jsxDEV("div",{className:"text-sm",children:[e.jsxDEV("div",{className:"font-medium",children:"Location shared"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:131,columnNumber:13},void 0),e.jsxDEV("div",{className:"text-muted-foreground",children:[s.lat.toFixed(6),", ",s.lng.toFixed(6)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:132,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:130,columnNumber:11},void 0),e.jsxDEV(l,{variant:"outline",size:"sm",onClick:()=>{window.open(`https://maps.google.com/?q=${s.lat},${s.lng}`,"_blank")},children:"View"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:136,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:128,columnNumber:9},void 0):s.media_type==="voice"&&s.media_url?e.jsxDEV("div",{className:"flex items-center space-x-3 p-3 bg-muted/50 rounded-lg min-w-[200px]",children:[e.jsxDEV(l,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:r,children:v?e.jsxDEV(ae,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:158,columnNumber:26},void 0):e.jsxDEV(me,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:158,columnNumber:58},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:152,columnNumber:11},void 0),e.jsxDEV(Ee,{className:"h-4 w-4 text-muted-foreground"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:160,columnNumber:11},void 0),e.jsxDEV("div",{className:"flex-1",children:e.jsxDEV("div",{className:"h-2 bg-muted rounded-full",children:e.jsxDEV("div",{className:"h-full bg-blue-500 rounded-full w-1/3"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:163,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:162,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:161,columnNumber:11},void 0),e.jsxDEV("span",{className:"text-xs text-muted-foreground",children:s.voice_duration?t(s.voice_duration):"0:00"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:166,columnNumber:11},void 0),e.jsxDEV("audio",{ref:V,src:s.media_url,onEnded:()=>D(!1),onPlay:()=>D(!0),onPause:()=>D(!1)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:169,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:151,columnNumber:9},void 0):s.media_type==="image"&&s.media_url?e.jsxDEV("div",{className:"max-w-sm",children:[e.jsxDEV("img",{src:s.media_url,alt:"Shared image",className:"rounded-lg max-w-full h-auto",loading:"lazy"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:183,columnNumber:11},void 0),s.content&&e.jsxDEV("div",{className:"mt-2 text-sm",children:s.content},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:190,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:182,columnNumber:9},void 0):s.media_type==="video"&&s.media_url?e.jsxDEV("div",{className:"max-w-sm",children:[e.jsxDEV("video",{src:s.media_url,controls:!0,className:"rounded-lg max-w-full h-auto",preload:"metadata"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:199,columnNumber:11},void 0),s.content&&e.jsxDEV("div",{className:"mt-2 text-sm",children:s.content},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:206,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:198,columnNumber:9},void 0):e.jsxDEV("div",{className:"text-sm",children:[s.content,s.edited_at&&e.jsxDEV("span",{className:"text-xs text-muted-foreground ml-2",children:"(edited)"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:216,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:213,columnNumber:7},void 0),B=()=>s.reply_to?e.jsxDEV("div",{className:"bg-muted/30 border-l-2 border-muted-foreground/30 pl-3 py-1 mb-2 text-xs",children:[e.jsxDEV("div",{className:"font-medium text-muted-foreground",children:s.reply_to.sender.name||"Unknown User"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:227,columnNumber:9},void 0),e.jsxDEV("div",{className:"text-muted-foreground truncate",children:s.reply_to.content||(s.reply_to.media_type?`${s.reply_to.media_type} message`:"Message")},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:230,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:226,columnNumber:7},void 0):null,$=()=>{if(!s.reactions||s.reactions.length===0)return null;const a=s.reactions.reduce((p,N)=>(p[N.reaction]||(p[N.reaction]=[]),p[N.reaction].push(N),p),{});return e.jsxDEV("div",{className:"flex items-center space-x-1 mt-1",children:Object.entries(a).map(([p,N])=>e.jsxDEV(Z,{variant:N.some(L=>L.user_id===U?.id)?"default":"secondary",className:"text-xs px-1 py-0 cursor-pointer",onClick:()=>M(p),children:[p," ",N.length]},p,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:254,columnNumber:11},void 0))},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:252,columnNumber:7},void 0)},z=()=>{if(!i)return null;const a=d();return a?e.jsxDEV("div",{className:"text-xs text-muted-foreground mt-1",children:[a==="sent"&&"âœ“",a==="delivered"&&"âœ“âœ“",a==="read"&&e.jsxDEV("span",{className:"text-blue-500",children:"âœ“âœ“"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:277,columnNumber:31},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:274,columnNumber:7},void 0):null};return e.jsxDEV("div",{className:`flex ${i?"justify-end":"justify-start"} ${k}`,children:[e.jsxDEV("div",{className:`flex ${i?"flex-row-reverse":"flex-row"} max-w-[80%] space-x-2`,children:[w&&!i&&e.jsxDEV(F,{className:"h-8 w-8 flex-shrink-0",children:[e.jsxDEV(W,{src:s.sender.avatar_url||"",alt:s.sender.name||"User"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:287,columnNumber:13},void 0),e.jsxDEV(K,{children:(s.sender.name||s.sender.username||"U").charAt(0).toUpperCase()},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:288,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:286,columnNumber:11},void 0),e.jsxDEV("div",{className:`flex flex-col ${i?"items-end":"items-start"}`,children:[e.jsxDEV("div",{className:`relative rounded-2xl px-4 py-2 ${i?"bg-blue-500 text-white":"bg-muted"}`,children:[B(),C?e.jsxDEV("div",{className:"flex items-center space-x-2",children:[e.jsxDEV(we,{value:h,onChange:a=>j(a.target.value),onKeyDown:a=>{a.key==="Enter"?E():a.key==="Escape"&&(u(!1),j(s.content||""))},className:"h-8 text-sm",autoFocus:!0},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:306,columnNumber:17},void 0),e.jsxDEV(l,{size:"sm",variant:"ghost",onClick:E,children:"âœ“"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:320,columnNumber:17},void 0),e.jsxDEV(l,{size:"sm",variant:"ghost",onClick:()=>u(!1),children:"âœ•"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:323,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:305,columnNumber:15},void 0):f(),e.jsxDEV(ce,{children:[e.jsxDEV(ge,{asChild:!0,children:e.jsxDEV(l,{variant:"ghost",size:"icon",className:`absolute -top-2 ${i?"-left-8":"-right-8"} h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity`,children:e.jsxDEV(se,{className:"h-3 w-3"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:339,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:334,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:333,columnNumber:15},void 0),e.jsxDEV(he,{align:i?"end":"start",children:[I&&e.jsxDEV(T,{onClick:()=>I(s),children:[e.jsxDEV(ve,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:345,columnNumber:21},void 0),"Reply"]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:344,columnNumber:19},void 0),e.jsxDEV(T,{onClick:()=>g(!0),children:[e.jsxDEV(De,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:350,columnNumber:19},void 0),"React"]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:349,columnNumber:17},void 0),e.jsxDEV(T,{onClick:m,children:[e.jsxDEV(ke,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:354,columnNumber:19},void 0),"Copy"]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:353,columnNumber:17},void 0),i&&s.content&&!s.is_deleted&&e.jsxDEV(T,{onClick:()=>u(!0),children:[e.jsxDEV(Ue,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:359,columnNumber:21},void 0),"Edit"]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:358,columnNumber:19},void 0),i&&!s.is_deleted&&e.jsxDEV(T,{onClick:R,className:"text-destructive",children:[e.jsxDEV(ne,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:365,columnNumber:21},void 0),"Delete"]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:364,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:342,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:332,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:295,columnNumber:11},void 0),$(),e.jsxDEV("div",{className:`flex items-center space-x-1 mt-1 text-xs text-muted-foreground ${i?"flex-row-reverse":""}`,children:[e.jsxDEV("span",{children:O(new Date(s.created_at),{addSuffix:!0})},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:376,columnNumber:13},void 0),z()]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:375,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:294,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:284,columnNumber:7},void 0),e.jsxDEV(pe,{open:c,onOpenChange:g,children:e.jsxDEV(fe,{className:"sm:max-w-md",children:[e.jsxDEV(Ne,{children:e.jsxDEV(xe,{children:"React to message"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:386,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:385,columnNumber:11},void 0),e.jsxDEV("div",{className:"grid grid-cols-3 gap-2",children:Pe.map(a=>e.jsxDEV(l,{variant:"ghost",className:"h-12 text-2xl",onClick:()=>M(a),children:a},a,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:390,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:388,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:384,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:383,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageBubble.tsx",lineNumber:283,columnNumber:5},void 0)},ze=({conversationId:s,replyingTo:i,onClearReply:w,className:I=""})=>{const[k,U]=o.useState(""),[_,A]=o.useState(!1),[P,y]=o.useState(!1),[c,g]=o.useState(null),[C,u]=o.useState(null),[h,j]=o.useState(0),[v,D]=o.useState(null),[V,M]=o.useState(!1),E=o.useRef(null),R=o.useRef(null),m=o.useRef(null),r=o.useRef(null),t=o.useRef(null),{sendMessage:d}=q(),{setTypingIndicator:f}=ee();o.useEffect(()=>{E.current&&(E.current.style.height="auto",E.current.style.height=Math.min(E.current.scrollHeight,120)+"px")},[k]);const B=o.useCallback($e(()=>{f(null)},1e3),[f]),$=n=>{U(n.target.value),f(s),B()},z=async()=>{if(!(!k.trim()&&!c&&!v))try{let n=null,b=null,x=null;c&&(n=await a(c),b=c.type.startsWith("image/")?"image":c.type.startsWith("video/")?"video":"file"),v&&(n=await a(new File([v],"voice-message.webm",{type:"audio/webm"})),b="voice",x=h),await d.mutateAsync({conversationId:s,content:k.trim()||null,mediaUrl:n,mediaType:b,replyToId:i?.id,voiceDuration:x}),U(""),g(null),u(null),D(null),j(0),w?.(),f(null)}catch(n){console.error("Error sending message:",n)}},a=async n=>new Promise(b=>{const x=new FileReader;x.onload=()=>b(x.result),x.readAsDataURL(n)}),p=n=>{const b=n.target.files?.[0];if(b){if(g(b),b.type.startsWith("image/")||b.type.startsWith("video/")){const x=new FileReader;x.onload=S=>u(S.target?.result),x.readAsDataURL(b)}y(!1)}},N=async()=>{try{const n=await navigator.mediaDevices.getUserMedia({audio:!0}),b=new MediaRecorder(n);m.current=b;const x=[];b.ondataavailable=S=>x.push(S.data),b.onstop=()=>{const S=new Blob(x,{type:"audio/webm"});D(S),n.getTracks().forEach(be=>be.stop())},b.start(),A(!0),j(0),t.current=setInterval(()=>{j(S=>S+1)},1e3)}catch(n){console.error("Error starting voice recording:",n)}},L=()=>{m.current&&_&&(m.current.stop(),A(!1),t.current&&(clearInterval(t.current),t.current=null))},ie=()=>{if(v&&!V){const n=new Audio(URL.createObjectURL(v));r.current=n,n.onended=()=>M(!1),n.play(),M(!0)}else r.current&&(r.current.pause(),M(!1))},oe=()=>{D(null),j(0),r.current&&(r.current.pause(),M(!1))},ue=async()=>{"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(async n=>{try{await d.mutateAsync({conversationId:s,lat:n.coords.latitude,lng:n.coords.longitude}),y(!1)}catch(b){console.error("Error sharing location:",b)}})},G=n=>{const b=Math.floor(n/60),x=n%60;return`${b}:${x.toString().padStart(2,"0")}`},le=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),z())};return e.jsxDEV("div",{className:`border-t bg-background p-4 ${I}`,children:[i&&e.jsxDEV("div",{className:"mb-3 p-2 bg-muted/50 rounded-lg flex items-center justify-between",children:[e.jsxDEV("div",{className:"flex-1 min-w-0",children:[e.jsxDEV("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:["Replying to ",i.sender.name]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:245,columnNumber:13},void 0),e.jsxDEV("div",{className:"text-sm text-muted-foreground truncate",children:i.content||(i.media_type?`${i.media_type} message`:"Message")},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:248,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:244,columnNumber:11},void 0),e.jsxDEV(l,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:w,children:e.jsxDEV(Y,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:253,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:252,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:243,columnNumber:9},void 0),c&&e.jsxDEV("div",{className:"mb-3 p-3 bg-muted/50 rounded-lg",children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[e.jsxDEV("span",{className:"text-sm font-medium",children:"Selected file:"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:262,columnNumber:13},void 0),e.jsxDEV(l,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{g(null),u(null)},children:e.jsxDEV(Y,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:267,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:263,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:261,columnNumber:11},void 0),C&&c.type.startsWith("image/")&&e.jsxDEV("img",{src:C,alt:"Preview",className:"max-w-xs max-h-32 rounded object-cover"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:272,columnNumber:13},void 0),C&&c.type.startsWith("video/")&&e.jsxDEV("video",{src:C,className:"max-w-xs max-h-32 rounded",controls:!0},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:276,columnNumber:13},void 0),e.jsxDEV("div",{className:"text-xs text-muted-foreground mt-1",children:[c.name," (",(c.size/1024).toFixed(1)," KB)"]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:279,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:260,columnNumber:9},void 0),v&&e.jsxDEV("div",{className:"mb-3 p-3 bg-muted/50 rounded-lg",children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[e.jsxDEV("span",{className:"text-sm font-medium",children:"Voice message:"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:289,columnNumber:13},void 0),e.jsxDEV(l,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:oe,children:e.jsxDEV(ne,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:291,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:290,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:288,columnNumber:11},void 0),e.jsxDEV("div",{className:"flex items-center space-x-3",children:[e.jsxDEV(l,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:ie,children:V?e.jsxDEV(ae,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:297,columnNumber:28},void 0):e.jsxDEV(me,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:297,columnNumber:60},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:296,columnNumber:13},void 0),e.jsxDEV("div",{className:"flex-1 h-2 bg-muted rounded-full",children:e.jsxDEV("div",{className:"h-full bg-blue-500 rounded-full w-1/3"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:300,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:299,columnNumber:13},void 0),e.jsxDEV("span",{className:"text-xs text-muted-foreground",children:G(h)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:302,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:295,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:287,columnNumber:9},void 0),_&&e.jsxDEV("div",{className:"mb-3 p-3 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsxDEV("div",{className:"flex items-center space-x-3",children:[e.jsxDEV("div",{className:"flex items-center space-x-2",children:[e.jsxDEV("div",{className:"h-3 w-3 bg-red-500 rounded-full animate-pulse"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:312,columnNumber:15},void 0),e.jsxDEV("span",{className:"text-sm font-medium text-red-700",children:"Recording..."},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:313,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:311,columnNumber:13},void 0),e.jsxDEV("span",{className:"text-sm text-muted-foreground",children:G(h)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:315,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:310,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:309,columnNumber:9},void 0),e.jsxDEV("div",{className:"flex items-end space-x-2",children:[e.jsxDEV(l,{variant:"ghost",size:"icon",className:"mb-1",onClick:()=>y(!P),children:e.jsxDEV(je,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:329,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:323,columnNumber:9},void 0),e.jsxDEV("div",{className:"flex-1",children:e.jsxDEV(Re,{ref:E,value:k,onChange:$,onKeyDown:le,placeholder:"Type a message...",className:"min-h-[40px] max-h-[120px] resize-none border-0 shadow-none focus-visible:ring-0 bg-muted",rows:1},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:334,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:333,columnNumber:9},void 0),k.trim()||c||v?e.jsxDEV(l,{onClick:z,disabled:d.isPending,className:"mb-1",children:e.jsxDEV(Ve,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:352,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:347,columnNumber:11},void 0):_?e.jsxDEV(l,{variant:"destructive",onClick:L,className:"mb-1",children:e.jsxDEV(Me,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:360,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:355,columnNumber:11},void 0):e.jsxDEV(l,{variant:"ghost",size:"icon",onClick:N,className:"mb-1",children:e.jsxDEV(Ie,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:369,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:363,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:321,columnNumber:7},void 0),P&&e.jsxDEV("div",{className:"mt-3 p-3 bg-muted/50 rounded-lg",children:e.jsxDEV("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxDEV(l,{variant:"ghost",className:"flex flex-col items-center space-y-1 h-auto py-3",onClick:()=>R.current?.click(),children:[e.jsxDEV(ye,{className:"h-6 w-6"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:383,columnNumber:15},void 0),e.jsxDEV("span",{className:"text-xs",children:"Photo"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:384,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:378,columnNumber:13},void 0),e.jsxDEV(l,{variant:"ghost",className:"flex flex-col items-center space-y-1 h-auto py-3",onClick:()=>R.current?.click(),children:[e.jsxDEV(Ce,{className:"h-6 w-6"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:392,columnNumber:15},void 0),e.jsxDEV("span",{className:"text-xs",children:"Camera"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:393,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:387,columnNumber:13},void 0),e.jsxDEV(l,{variant:"ghost",className:"flex flex-col items-center space-y-1 h-auto py-3",onClick:ue,children:[e.jsxDEV(re,{className:"h-6 w-6"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:401,columnNumber:15},void 0),e.jsxDEV("span",{className:"text-xs",children:"Location"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:402,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:396,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:377,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:376,columnNumber:9},void 0),e.jsxDEV("input",{ref:R,type:"file",accept:"image/*,video/*",onChange:p,className:"hidden"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:409,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/MessageInput.tsx",lineNumber:240,columnNumber:5},void 0)};function $e(s,i){let w;return(...I)=>{clearTimeout(w),w=setTimeout(()=>s.apply(null,I),i)}}const Le=({conversationId:s,className:i=""})=>{const{user:w}=H(),[I,k]=o.useState(null),U=o.useRef(null),_=o.useRef(null),{conversations:A,useConversationMessages:P,markAsRead:y,userPresence:c}=q();ee();const{data:g=[],isLoading:C}=P(s),u=A.find(m=>m.id===s),h=u?c[u.other_user_id]:void 0;o.useEffect(()=>{const m=()=>{U.current?.scrollIntoView({behavior:"smooth"})};g.length>0&&setTimeout(m,100)},[g.length]),o.useEffect(()=>{if(!w||g.length===0)return;const m=g.filter(r=>r.sender_id!==w.id&&!r.status?.some(t=>t.user_id===w.id&&t.status==="read")).map(r=>r.id);m.length>0&&y.mutate(m)},[g,w,y]);const j=m=>{k(m)},v=()=>{k(null)},D=()=>{if(!h)return!1;const m=new Date(Date.now()-5*60*1e3),r=new Date(h.last_seen);return h.is_online&&r>m},V=()=>h?.is_typing_in_conversation===s,M=()=>{if(!h)return"";if(D())return"Online";const m=new Date(h.last_seen);return`Last seen ${O(m,{addSuffix:!0})}`},E=m=>{const r=[];let t="",d=[];return m.forEach(f=>{const B=new Date(f.created_at).toDateString();B!==t?(d.length>0&&r.push({date:t,messages:d}),t=B,d=[f]):d.push(f)}),d.length>0&&r.push({date:t,messages:d}),r},R=m=>{const r=new Date(m),t=new Date,d=new Date(t);return d.setDate(d.getDate()-1),r.toDateString()===t.toDateString()?"Today":r.toDateString()===d.toDateString()?"Yesterday":r.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})};return u?e.jsxDEV("div",{className:`flex flex-col h-full ${i}`,children:[e.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b bg-background",children:[e.jsxDEV("div",{className:"flex items-center space-x-3",children:[e.jsxDEV(J,{to:"/inbox",children:e.jsxDEV(l,{variant:"ghost",size:"icon",children:e.jsxDEV(Q,{className:"h-5 w-5"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:183,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:182,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:181,columnNumber:11},void 0),e.jsxDEV("div",{className:"flex items-center space-x-3",children:[e.jsxDEV("div",{className:"relative",children:[e.jsxDEV(F,{className:"h-10 w-10",children:[e.jsxDEV(W,{src:u.other_user_avatar||"",alt:u.other_user_name||"User"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:190,columnNumber:17},void 0),e.jsxDEV(K,{children:(u.other_user_name||u.other_user_username||"U").charAt(0).toUpperCase()},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:194,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:189,columnNumber:15},void 0),D()&&e.jsxDEV("div",{className:"absolute bottom-0 right-0 h-3 w-3 bg-green-500 border-2 border-background rounded-full"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:201,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:188,columnNumber:13},void 0),e.jsxDEV("div",{className:"min-w-0",children:[e.jsxDEV("h2",{className:"font-semibold text-sm truncate",children:u.other_user_name||u.other_user_username||"Unknown User"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:206,columnNumber:15},void 0),e.jsxDEV("div",{className:"text-xs text-muted-foreground",children:V()?e.jsxDEV("span",{className:"text-blue-500",children:"typing..."},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:211,columnNumber:19},void 0):M()},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:209,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:205,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:187,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:180,columnNumber:9},void 0),e.jsxDEV("div",{className:"flex items-center space-x-2",children:[e.jsxDEV(l,{variant:"ghost",size:"icon",children:e.jsxDEV(Be,{className:"h-5 w-5"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:223,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:222,columnNumber:11},void 0),e.jsxDEV(l,{variant:"ghost",size:"icon",children:e.jsxDEV(_e,{className:"h-5 w-5"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:226,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:225,columnNumber:11},void 0),e.jsxDEV(l,{variant:"ghost",size:"icon",children:e.jsxDEV(se,{className:"h-5 w-5"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:229,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:228,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:221,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:179,columnNumber:7},void 0),e.jsxDEV(de,{className:"flex-1 p-4",ref:_,children:C?e.jsxDEV("div",{className:"flex items-center justify-center py-8",children:e.jsxDEV("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:238,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:237,columnNumber:11},void 0):g.length===0?e.jsxDEV("div",{className:"flex items-center justify-center py-12",children:e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV("div",{className:"h-16 w-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsxDEV(F,{className:"h-12 w-12",children:[e.jsxDEV(W,{src:u.other_user_avatar||"",alt:u.other_user_name||"User"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:245,columnNumber:19},void 0),e.jsxDEV(K,{children:(u.other_user_name||u.other_user_username||"U").charAt(0).toUpperCase()},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:249,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:244,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:243,columnNumber:15},void 0),e.jsxDEV("h3",{className:"font-semibold text-muted-foreground mb-2",children:"Start your conversation"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:256,columnNumber:15},void 0),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:["Send a message to ",u.other_user_name||"this user"," to get started"]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:259,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:242,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:241,columnNumber:11},void 0):e.jsxDEV("div",{className:"space-y-1",children:[E(g).map(m=>e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"flex items-center justify-center my-4",children:e.jsxDEV(Z,{variant:"secondary",className:"text-xs",children:R(m.date)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:270,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:269,columnNumber:17},void 0),m.messages.map((r,t)=>{const d=r.sender_id===w?.id,f=m.messages[t-1],B=!d&&(!f||f.sender_id!==r.sender_id||new Date(r.created_at).getTime()-new Date(f.created_at).getTime()>3e5);return e.jsxDEV(Te,{message:r,isOwn:d,showAvatar:B,onReply:j,className:"group"},r.id,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:286,columnNumber:21},void 0)})]},m.date,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:267,columnNumber:15},void 0)),e.jsxDEV("div",{ref:U},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:298,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:265,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:235,columnNumber:7},void 0),e.jsxDEV(ze,{conversationId:s,replyingTo:I,onClearReply:v},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:304,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:177,columnNumber:5},void 0):e.jsxDEV("div",{className:`flex items-center justify-center h-full ${i}`,children:e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV("h2",{className:"text-xl font-semibold text-muted-foreground mb-2",children:"Conversation not found"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:159,columnNumber:11},void 0),e.jsxDEV("p",{className:"text-muted-foreground",children:"This conversation may have been deleted or you don't have access to it."},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:162,columnNumber:11},void 0),e.jsxDEV(J,{to:"/inbox",className:"inline-block mt-4",children:e.jsxDEV(l,{variant:"outline",children:[e.jsxDEV(Q,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:167,columnNumber:15},void 0),"Back to Inbox"]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:166,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:165,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:158,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/messaging/ChatInterface.tsx",lineNumber:157,columnNumber:7},void 0)},os=()=>{const{conversationId:s}=te(),{user:i}=H();return i?s?e.jsxDEV("div",{className:"min-h-screen bg-background",children:[e.jsxDEV(Se,{},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/pages/Chat.tsx",lineNumber:22,columnNumber:7},void 0),e.jsxDEV("div",{className:"pt-16 pb-20 h-screen flex flex-col",children:e.jsxDEV(Le,{conversationId:s,className:"flex-1"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/pages/Chat.tsx",lineNumber:25,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/pages/Chat.tsx",lineNumber:24,columnNumber:7},void 0),e.jsxDEV(Ae,{},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/pages/Chat.tsx",lineNumber:31,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/pages/Chat.tsx",lineNumber:21,columnNumber:5},void 0):e.jsxDEV(X,{to:"/inbox",replace:!0},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/pages/Chat.tsx",lineNumber:17,columnNumber:12},void 0):e.jsxDEV(X,{to:"/auth",replace:!0},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/pages/Chat.tsx",lineNumber:13,columnNumber:12},void 0)};export{os as default};
