import{j as s,B as U,u as P,t as D,s as M,o as S,e as i,f as J,n as E,g as K}from"./index-Cak4IDZW.js";import{r as o}from"./vendor-C9QPK5wj.js";import{C as X,a as Z,d as ee,e as se}from"./card-Bp0LqR15.js";import{A as L,a as R,b as I}from"./avatar-CL55SoGP.js";import{B as te}from"./badge-mL5Y5NT_.js";import{b as ae,X as ne,aw as re,v as ie,a3 as O,e as oe,a4 as le,ai as me}from"./icons-Ed5u1gBp.js";import{S as ue}from"./scroll-area-CI2ZTqk6.js";import{T as be}from"./textarea-Bj8JMMO3.js";class ce extends EventTarget{emit(t,a){const n=new CustomEvent(t,{detail:a});this.dispatchEvent(n)}on(t,a){const n=m=>{a(m.detail)};return this.addEventListener(t,n),()=>this.removeEventListener(t,n)}}const de=new ce,pe=(e,t,a)=>{if(a)return"event";if(t)return"livestream";if(!e)return"text";const n=e.toLowerCase();return n.includes("rtmp://")||n.includes("webrtc")||n.includes("/live/")||n.includes("livestream")||n.includes("live-stream")?"livestream":n.includes(".mp4")||n.includes(".webm")||n.includes(".mov")||n.includes(".avi")||n.includes(".mkv")||n.includes("video")||n.includes(".m4v")||n.includes(".3gp")?"video":(n.includes(".jpg")||n.includes(".jpeg")||n.includes(".png")||n.includes(".gif")||n.includes(".webp")||n.includes(".svg")||n.includes("image")||n.includes("placeholder.svg"),"image")},Oe=e=>{switch(e){case"text":return"#DC2626";case"image":return"#16A34A";case"video":return"#9333EA";case"livestream":return"#0EA5E9";case"event":return"#EAB308";default:return"#0EA5E9"}},he=({user:e,location:t,isPublic:a,onClose:n})=>s.jsxDEV("div",{className:"p-4 pb-2 flex flex-row items-start justify-between",children:[s.jsxDEV("div",{className:"flex items-center space-x-3",children:[s.jsxDEV(L,{className:"h-12 w-12 border-2 border-white shadow-md",children:[s.jsxDEV(R,{src:e.avatar,alt:e.name,className:"object-cover"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:28,columnNumber:11},void 0),s.jsxDEV(I,{className:"bg-gradient-to-br from-purple-500 to-blue-500 text-white text-lg",children:e.name.charAt(0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:33,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:27,columnNumber:9},void 0),s.jsxDEV("div",{children:[s.jsxDEV("p",{className:"font-semibold text-base",children:e.name},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:38,columnNumber:11},void 0),s.jsxDEV("div",{className:"flex items-center text-xs text-muted-foreground",children:[s.jsxDEV(ae,{className:"h-3 w-3 mr-1"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:40,columnNumber:13},void 0),s.jsxDEV("span",{children:t},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:41,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:39,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:37,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:26,columnNumber:7},void 0),s.jsxDEV("div",{className:"flex flex-col items-end",children:[s.jsxDEV(te,{variant:a?"default":"secondary",children:a?"Public":"Followers"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:46,columnNumber:9},void 0),s.jsxDEV(U,{variant:"ghost",size:"icon",onClick:n,className:"h-7 w-7 -mr-2",children:s.jsxDEV(ne,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:50,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:49,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:45,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailHeader.tsx",lineNumber:25,columnNumber:5},void 0),ge=({content:e,mediaUrl:t,timestamp:a,expiresAt:n})=>{const[m,u]=o.useState(!1),b=r=>new Date(r).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),c=r=>{const x=new Date,C=new Date(r).getTime()-x.getTime(),d=Math.floor(C/(1e3*60*60)),k=Math.floor(C%(1e3*60*60)/(1e3*60));return`${d}h ${k}m`},g=pe(t,!1);return s.jsxDEV("div",{className:"p-4 overflow-auto flex-grow",children:[s.jsxDEV("p",{className:"mb-3 text-base",children:e},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:46,columnNumber:7},void 0),t&&s.jsxDEV("div",{className:"w-full rounded-md overflow-hidden h-56 bg-gray-100 mb-3",children:g==="video"?s.jsxDEV("video",{src:t,controls:!0,className:"w-full h-full object-cover",preload:"metadata",children:"Your browser does not support the video tag."},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:50,columnNumber:13},void 0):m?s.jsxDEV("div",{className:"w-full h-full flex items-center justify-center bg-gray-200",children:s.jsxDEV("div",{className:"text-center text-gray-500",children:[s.jsxDEV(re,{className:"h-8 w-8 mx-auto mb-2"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:61,columnNumber:17},void 0),s.jsxDEV("p",{className:"text-sm",children:"Image unavailable"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:62,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:60,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:59,columnNumber:13},void 0):s.jsxDEV("img",{src:t,alt:"Message media",className:"w-full h-full object-cover",onError:r=>{console.error("Failed to load image:",t),u(!0)},onLoad:()=>{console.log("âœ… Image loaded successfully:",t?.substring(0,50)+"...")}},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:66,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:48,columnNumber:9},void 0),s.jsxDEV("div",{className:"flex items-center justify-between text-xs text-muted-foreground mt-2",children:[s.jsxDEV("span",{children:["Posted ",b(a)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:83,columnNumber:9},void 0),s.jsxDEV("div",{className:"flex items-center",children:[s.jsxDEV(ie,{className:"h-3 w-3 mr-1"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:85,columnNumber:11},void 0),s.jsxDEV("span",{children:[c(n)," left"]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:86,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:84,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:82,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailContent.tsx",lineNumber:45,columnNumber:5},void 0)},B=({initialLiked:e=!1,initialLikes:t=0,messageId:a,userName:n,content:m})=>{const[u,b]=o.useState(e),[c,g]=o.useState(t),[r,x]=o.useState(!1),{user:N}=P();return{liked:u,likes:c,showCommentInput:r,handleLike:async f=>{if(f&&f.stopPropagation(),!N){D({title:"Authentication required",description:"Please sign in to like posts",variant:"destructive"});return}try{if(u){const{error:p}=await M.from("likes").delete().eq("user_id",N.id).eq("message_id",a);if(p)throw p;b(!1),g(v=>Math.max(0,v-1))}else{const{error:p}=await M.from("likes").insert({user_id:N.id,message_id:a});if(p)throw p;b(!0),g(v=>v+1),D({title:"Post liked",description:"You've liked this Lo"})}}catch(p){console.error("Error managing like:",p),D({title:"Error",description:p.message||"Failed to update like status",variant:"destructive"})}},handleComment:f=>{if(f&&f.stopPropagation(),!N&&!r){D({title:"Authentication required",description:"Please sign in to comment",variant:"destructive"});return}x(!r),r||D({title:"Comment",description:"Opening comments section"})},handleShare:f=>{f&&f.stopPropagation(),navigator.share?navigator.share({title:`Lo from ${n}`,text:m,url:window.location.href}).catch(p=>{D({title:"Shared",description:"Link copied to clipboard"})}):(navigator.clipboard.writeText(`${window.location.origin}/home?message=${a}`),D({title:"Shared",description:"Link copied to clipboard"}))}}},fe=({liked:e,likes:t,onLike:a,onComment:n,messageId:m,userName:u,messageContent:b})=>{const{handleShare:c}=B({initialLiked:e,initialLikes:t,messageId:m,userName:u,content:b});return s.jsxDEV("div",{className:"flex justify-between w-full border-t border-b py-2",children:[s.jsxDEV(U,{variant:"ghost",size:"sm",className:`flex-1 ${e?"text-red-500":""}`,onClick:a,children:[s.jsxDEV(O,{className:`h-4 w-4 mr-1 ${e?"fill-current":""}`},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailActions.tsx",lineNumber:42,columnNumber:9},void 0),t>0&&s.jsxDEV("span",{children:t},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailActions.tsx",lineNumber:43,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailActions.tsx",lineNumber:36,columnNumber:7},void 0),s.jsxDEV(U,{variant:"ghost",size:"sm",className:"flex-1",onClick:n,children:[s.jsxDEV(oe,{className:"h-4 w-4 mr-1"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailActions.tsx",lineNumber:51,columnNumber:9},void 0),"Comment"]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailActions.tsx",lineNumber:45,columnNumber:7},void 0),s.jsxDEV(U,{variant:"ghost",size:"sm",className:"flex-1",onClick:c,children:[s.jsxDEV(le,{className:"h-4 w-4 mr-1"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailActions.tsx",lineNumber:60,columnNumber:9},void 0),"Share"]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailActions.tsx",lineNumber:54,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/MessageDetailActions.tsx",lineNumber:35,columnNumber:5},void 0)},H=({comment:e,isLiked:t,onLike:a,formatRelativeTime:n})=>s.jsxDEV("div",{className:"flex items-start group",children:[s.jsxDEV(L,{className:"h-8 w-8 mr-2",children:[s.jsxDEV(R,{src:e.user.avatar,alt:e.user.name},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:31,columnNumber:9},void 0),s.jsxDEV(I,{className:"text-xs bg-purple-100 text-purple-500",children:e.user.name.charAt(0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:32,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:30,columnNumber:7},void 0),s.jsxDEV("div",{className:"flex-1",children:[s.jsxDEV("div",{className:"text-sm",children:[s.jsxDEV("span",{className:"font-semibold mr-2",children:e.user.name},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:39,columnNumber:11},void 0),s.jsxDEV("span",{className:"text-neutral-700",children:e.content},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:40,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:38,columnNumber:9},void 0),s.jsxDEV("div",{className:"flex items-center mt-1 text-xs text-neutral-500",children:[s.jsxDEV("span",{className:"mr-3",children:n(e.timestamp)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:44,columnNumber:11},void 0),e.likes>0&&s.jsxDEV("span",{className:"mr-3",children:[e.likes," likes"]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:46,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:43,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:37,columnNumber:7},void 0),s.jsxDEV("button",{className:"h-5 w-5 text-neutral-500 hover:text-red-500 group-hover:opacity-100 opacity-0",onClick:a,children:s.jsxDEV(O,{className:`h-3 w-3 ${t?"fill-red-500 text-red-500":""}`},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:55,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:51,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/Comment.tsx",lineNumber:29,columnNumber:5},void 0),Ne=({comment:e,likedComments:t,replyingTo:a,replyText:n,handleLike:m,handleReplyClick:u,handleSubmitReply:b,setReplyText:c,formatRelativeTime:g})=>s.jsxDEV("div",{className:"mb-4",children:[s.jsxDEV(H,{comment:e,isLiked:!!t[e.id],onLike:()=>m(e.id,e.likes),formatRelativeTime:g},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/CommentWithReplies.tsx",lineNumber:41,columnNumber:7},void 0),s.jsxDEV("div",{className:"flex items-center mt-1 text-xs text-neutral-500 ml-10",children:s.jsxDEV("button",{className:"text-xs font-medium mr-3 hover:text-neutral-800",onClick:()=>u(e.id),children:"Reply"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/CommentWithReplies.tsx",lineNumber:49,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/CommentWithReplies.tsx",lineNumber:48,columnNumber:7},void 0),a===e.id&&s.jsxDEV("div",{className:"flex items-center mt-2 ml-10",children:[s.jsxDEV("input",{type:"text",className:"flex-1 text-xs border border-gray-300 rounded-full px-3 py-1.5",placeholder:`Reply to ${e.user.name}...`,value:n,onChange:r=>c(r.target.value),onKeyPress:r=>{r.key==="Enter"&&b(e.id)}},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/CommentWithReplies.tsx",lineNumber:60,columnNumber:11},void 0),s.jsxDEV("button",{className:"ml-2 text-xs font-medium text-blue-500 hover:text-blue-700",onClick:()=>b(e.id),children:"Post"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/CommentWithReplies.tsx",lineNumber:70,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/CommentWithReplies.tsx",lineNumber:59,columnNumber:9},void 0),e.replies&&e.replies.length>0&&s.jsxDEV("div",{className:"ml-6 mt-2",children:e.replies.map(r=>s.jsxDEV("div",{className:"flex items-start mb-2 group",children:s.jsxDEV(H,{comment:r,isLiked:!!t[r.id],onLike:()=>m(r.id,r.likes),formatRelativeTime:g},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/CommentWithReplies.tsx",lineNumber:84,columnNumber:15},void 0)},r.id,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/CommentWithReplies.tsx",lineNumber:83,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/CommentWithReplies.tsx",lineNumber:81,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/comment/CommentWithReplies.tsx",lineNumber:40,columnNumber:5},void 0),we=({comments:e})=>{const[t,a]=o.useState({}),[n,m]=o.useState(null),[u,b]=o.useState(""),[c,g]=o.useState(e),r=d=>{const k=new Date,f=new Date(d),p=k.getTime()-f.getTime(),v=Math.floor(p/(1e3*60)),l=Math.floor(v/60),h=Math.floor(l/24);return h>0?`${h}d`:l>0?`${l}h`:v>0?`${v}m`:"now"},x=(d,k)=>{const f=t[d]||!1,p={...t,[d]:!f};a(p);const v=h=>h.map(w=>w.id===d?{...w,likes:f?k-1:k+1}:w.replies&&w.replies.length>0?{...w,replies:v(w.replies)}:w),l=v(c);g(l),f||D({title:"Comment liked",description:"You've liked this comment"})},N=d=>{m(n===d?null:d),b("")},C=d=>{if(u.trim()==="")return;const k={id:`reply-${Date.now()}`,user:{name:"You",avatar:"https://i.pravatar.cc/150?u=user"},content:u,timestamp:new Date().toISOString(),likes:0},f=c.map(p=>p.id===d?{...p,replies:[...p.replies||[],k]}:p);g(f),m(null),b(""),D({title:"Reply posted",description:"Your reply has been added"})};return s.jsxDEV("div",{className:"space-y-1",children:c.map(d=>s.jsxDEV(Ne,{comment:d,likedComments:t,replyingTo:n,replyText:u,handleLike:x,handleReplyClick:N,handleSubmitReply:C,setReplyText:b,formatRelativeTime:r},d.id,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/CommentsList.tsx",lineNumber:138,columnNumber:9},void 0))},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/CommentsList.tsx",lineNumber:136,columnNumber:5},void 0)},xe=({comment:e,setComment:t,onSubmit:a})=>s.jsxDEV("div",{className:"flex items-center gap-2",children:[s.jsxDEV(L,{className:"h-8 w-8",children:[s.jsxDEV(R,{src:"https://i.pravatar.cc/150?u=user",alt:"You"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentInput.tsx",lineNumber:22,columnNumber:9},void 0),s.jsxDEV(I,{className:"text-xs bg-purple-100 text-purple-500",children:"Y"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentInput.tsx",lineNumber:23,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentInput.tsx",lineNumber:21,columnNumber:7},void 0),s.jsxDEV("div",{className:"flex-1 relative",children:[s.jsxDEV(be,{placeholder:"Add a comment...",value:e,onChange:n=>t(n.target.value),className:"w-full resize-none py-2 min-h-0 h-10",rows:1},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentInput.tsx",lineNumber:28,columnNumber:9},void 0),e.trim()&&s.jsxDEV(U,{size:"sm",variant:"ghost",className:"absolute right-2 top-1 p-1 h-8 w-8",onClick:a,children:s.jsxDEV(me,{className:"h-4 w-4 text-primary"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentInput.tsx",lineNumber:42,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentInput.tsx",lineNumber:36,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentInput.tsx",lineNumber:27,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentInput.tsx",lineNumber:20,columnNumber:5},void 0),ve=({comments:e,comment:t,setComment:a,onSubmitComment:n,showCommentInput:m})=>{const u=e.length>0;return s.jsxDEV("div",{className:"p-4 pt-0",children:[u&&s.jsxDEV("div",{className:"mt-4 border-t pt-3",children:s.jsxDEV(ue,{className:"max-h-[320px]",children:s.jsxDEV("div",{className:"pr-4",children:s.jsxDEV(we,{comments:e},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentsSection.tsx",lineNumber:31,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentsSection.tsx",lineNumber:30,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentsSection.tsx",lineNumber:29,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentsSection.tsx",lineNumber:28,columnNumber:9},void 0),m&&s.jsxDEV("div",{className:"w-full space-y-2 mt-3",children:s.jsxDEV(xe,{comment:t,setComment:a,onSubmit:n},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentsSection.tsx",lineNumber:40,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentsSection.tsx",lineNumber:39,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/message/CommentsSection.tsx",lineNumber:25,columnNumber:5},void 0)},De=[{id:"1",user:{name:"Alex Johnson",avatar:"https://i.pravatar.cc/150?u=alex"},content:"This is such a beautiful place! ğŸ˜",timestamp:new Date(Date.now()-36e5*2).toISOString(),likes:5,replies:[{id:"1-reply-1",user:{name:"Sam Williams",avatar:"https://i.pravatar.cc/150?u=sam"},content:"I agree! The lighting is perfect.",timestamp:new Date(Date.now()-36e5*1).toISOString(),likes:2}]},{id:"2",user:{name:"Sam Williams",avatar:"https://i.pravatar.cc/150?u=sam"},content:"I was there last week! The atmosphere is amazing.",timestamp:new Date(Date.now()-36e5*5).toISOString(),likes:2,replies:[]},{id:"3",user:{name:"Taylor Chen",avatar:"https://i.pravatar.cc/150?u=taylor"},content:"Great shot! ğŸ“¸ What camera did you use?",timestamp:new Date(Date.now()-36e5*12).toISOString(),likes:0,replies:[]}],Be=({message:e,onClose:t})=>{const{liked:a,likes:n,showCommentInput:m,handleLike:u,handleComment:b}=B({messageId:e.id,userName:e.user.name,content:e.content}),[c,g]=o.useState(""),[r,x]=o.useState(De),N=()=>{D({title:"Duration Extended",description:"Message will be available for another 24 hours."})},C=()=>{if(c.trim()){const d={id:`comment-${Date.now()}`,user:{name:"You",avatar:"https://i.pravatar.cc/150?u=user"},content:c.trim(),timestamp:new Date().toISOString(),likes:0,replies:[]};x([d,...r]),g(""),D({title:"Comment posted",description:"Your comment has been added"})}};return s.jsxDEV("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:s.jsxDEV(X,{className:"w-full max-w-md mx-auto bg-white fade-in flex flex-col max-h-[90vh]",children:[s.jsxDEV(Z,{className:"p-0",children:s.jsxDEV(he,{user:e.user,location:e.location,isPublic:e.isPublic,onClose:t},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/MessageDetail.tsx",lineNumber:123,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/MessageDetail.tsx",lineNumber:122,columnNumber:9},void 0),s.jsxDEV(ee,{className:"p-0 overflow-auto flex-grow",children:[s.jsxDEV(ge,{content:e.content,mediaUrl:e.mediaUrl,timestamp:e.timestamp,expiresAt:e.expiresAt},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/MessageDetail.tsx",lineNumber:132,columnNumber:11},void 0),s.jsxDEV(ve,{comments:r,comment:c,setComment:g,onSubmitComment:C,showCommentInput:m},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/MessageDetail.tsx",lineNumber:139,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/MessageDetail.tsx",lineNumber:131,columnNumber:9},void 0),s.jsxDEV(se,{className:"p-4 pt-0 flex-col gap-4",children:[s.jsxDEV(fe,{liked:a,likes:n,onLike:u,onComment:b,messageId:e.id,userName:e.user.name,messageContent:e.content},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/MessageDetail.tsx",lineNumber:149,columnNumber:11},void 0),s.jsxDEV(U,{onClick:N,variant:"outline",className:"w-full",children:"Extend for 24 More Hours"},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/MessageDetail.tsx",lineNumber:159,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/MessageDetail.tsx",lineNumber:148,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/MessageDetail.tsx",lineNumber:121,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/akrammahmoud/geo-bubble-whispers/geo-bubble-whispers/src/components/MessageDetail.tsx",lineNumber:120,columnNumber:5},void 0)},ke=S({name:i().default("Lo User"),avatar:i().default("/placeholder.svg")}),Ee=S({id:i(),content:i().nullable().default(""),media_url:i().nullable().optional(),is_public:J().nullable().default(!0),location:i().nullable().default(""),lat:E().nullable(),lng:E().nullable(),user_id:i().nullable().optional(),created_at:i(),expires_at:i().nullable().optional(),message_type:i().nullable().optional(),event_source:i().nullable().optional(),event_title:i().nullable().optional(),event_url:i().nullable().optional(),event_venue:i().nullable().optional(),event_start_date:i().nullable().optional(),event_price_min:E().nullable().optional(),event_price_max:E().nullable().optional(),likes:K(S({user_id:i()})).nullable().optional()}),Ce=S({id:i(),title:i(),description:i().nullable().optional(),image_url:i().nullable().optional(),venue_name:i().nullable().optional(),venue_address:i().nullable().optional(),lat:E().nullable(),lng:E().nullable(),start_date:i(),price_min:E().nullable().optional(),price_max:E().nullable().optional(),event_url:i().nullable().optional(),source:i().nullable().default("ticketmaster"),created_at:i().nullable().optional()});S({title:i(),venue:i().nullable().optional(),url:i().nullable().optional(),startDate:i(),priceMin:E().nullable().optional(),priceMax:E().nullable().optional(),source:i().nullable().optional()});const W={ticketmaster:"https://s1.ticketm.net/dam/a/66e/b68b8edc-ff0e-43a5-8cb8-a4ad0b56c66e_RETINA_PORTRAIT_3_2.jpg",eventbrite:"https://cdn.evbstatic.com/s3-build/fe/build/images/logos/eb-orange-wordmark-no-text.6f6804bb.svg"},F={ticketmaster:"ğŸ« Ticketmaster Events",eventbrite:"ğŸŸ Eventbrite Events"},je=(e,t)=>{const a=Ee.parse(e);if(a.lat==null||a.lng==null)return null;const n=a.message_type==="event",m=a.event_source??"",u=a.likes?.length??0,b=!!(t&&a.likes?.some(r=>r.user_id===t)),c=ke.parse({name:n?F[m]??"Lo Events":"Lo User",avatar:n?W[m]??"/placeholder.svg":"/placeholder.svg"}),g=n?{title:a.event_title??"",venue:a.event_venue,url:a.event_url,startDate:a.event_start_date??a.created_at,priceMin:a.event_price_min??void 0,priceMax:a.event_price_max??void 0,source:a.event_source??void 0}:void 0;return{id:a.id,content:a.content??"",mediaUrl:a.media_url??null,isPublic:a.is_public??!0,location:a.location??"",timestamp:a.created_at,expiresAt:a.expires_at??null,lat:a.lat,lng:a.lng,position:{lat:a.lat,lng:a.lng,x:a.lat,y:a.lng},liked:b,likes:u,isEvent:n,eventData:g,user:c}},Me=e=>{const t=Ce.parse(e);return t.lat==null||t.lng==null?null:{id:`event-${t.id}`,content:Ue(t),mediaUrl:t.image_url??null,isPublic:!0,location:t.venue_address||t.venue_name||"",timestamp:t.created_at??t.start_date,expiresAt:t.start_date,lat:t.lat,lng:t.lng,position:{lat:t.lat,lng:t.lng,x:t.lat,y:t.lng},liked:!1,likes:0,isEvent:!0,eventData:{title:t.title,venue:t.venue_name,url:t.event_url??void 0,startDate:t.start_date,priceMin:t.price_min??void 0,priceMax:t.price_max??void 0,source:t.source??void 0},user:{name:F[t.source??"ticketmaster"]??"Lo Events",avatar:W[t.source??"ticketmaster"]??"/placeholder.svg"}}},Ue=e=>{const t=[`ğŸ« ${e.title}`,e.venue_name?`ğŸ“ ${e.venue_name}`:void 0,e.venue_address?e.venue_address:void 0,`ğŸ“… ${new Date(e.start_date).toLocaleString()}`,e.price_min?`ğŸ’° From $${e.price_min}`:void 0,e.event_url?`ğŸ”— ${e.event_url}`:void 0].filter(Boolean);if(e.description){const a=e.description.length>200?`${e.description.slice(0,200)}...`:e.description;t.splice(1,0,a)}return`${t.join(`

`)}

#Events`},y=.0015,Ve=350,_e=(e,t)=>!e||!t?!0:Math.abs(e.north-t.north)>y||Math.abs(e.south-t.south)>y||Math.abs(e.east-t.east)>y||Math.abs(e.west-t.west)>y,Se=(e,t)=>e.map(a=>{try{return je(a,t)}catch(n){return console.error("Skipping invalid message payload",n,a),null}}).filter(a=>!!a),ye=e=>e.map(t=>{try{return Me(t)}catch(a){return console.error("Skipping invalid event payload",a,t),null}}).filter(t=>!!t),We=()=>{const[e,t]=o.useState({showPublic:!0,showFollowers:!0}),[a,n]=o.useState([]),[m,u]=o.useState(!0),{user:b}=P(),c=o.useRef(""),g=o.useRef(null),r=o.useRef(null),x=o.useCallback(async l=>{try{u(!0);const h=new Date,w=new Date(h.getTime()-24*60*60*1e3).toISOString(),j=l?.searchQuery??c.current,V=g.current;let _=M.from("messages").select("*").or(`expires_at.gte.${h.toISOString()},expires_at.is.null,created_at.gte.${w}`).order("created_at",{ascending:!1}).limit(200);V&&(_=_.gte("lat",V.south).lte("lat",V.north).gte("lng",V.west).lte("lng",V.east)),j.trim()&&(_=_.or(`content.ilike.%${j}%,location.ilike.%${j}%`));const Y=M.from("events").select("*").gte("start_date",h.toISOString()).order("start_date",{ascending:!0}).limit(50),[T,A]=await Promise.allSettled([_,Y]);if(T.status==="rejected")throw T.reason;const z=Se(T.value.data??[],b?.id);let $=[];A.status==="fulfilled"?$=ye(A.value.data??[]):console.warn("Events query failed",A.reason);const q=[...z,...$].sort((Q,G)=>new Date(G.timestamp).getTime()-new Date(Q.timestamp).getTime());n(q)}catch(h){console.error("Error fetching messages",h);const w=h instanceof Error?h.message:"";w&&!/auth/i.test(w)&&D({title:"Unable to load messages",description:"Please check your network connection and try again.",variant:"destructive"})}finally{u(!1)}},[b?.id]),N=o.useCallback(()=>{r.current&&window.clearTimeout(r.current),r.current=window.setTimeout(()=>{x()},Ve)},[x]),C=o.useCallback(l=>{n(h=>[l,...h])},[]),d=o.useCallback((l,h)=>{n(w=>w.map(j=>j.id===l?{...j,...h}:j))},[]),k=o.useCallback(l=>{c.current=l,N()},[N]),f=o.useCallback(l=>{_e(g.current,l)&&(g.current=l,N())},[N]);o.useEffect(()=>{x();const l=M.channel("public:messages").on("postgres_changes",{event:"*",schema:"public",table:"messages"},()=>N()).subscribe(),h=de.on("refreshMessages",()=>N());return()=>{M.removeChannel(l),h(),r.current&&window.clearTimeout(r.current)}},[N,x]);const p=o.useCallback((l,h)=>{t(w=>({...w,[l]:h}))},[]),v=o.useMemo(()=>a.filter(l=>l.isPublic&&e.showPublic||!l.isPublic&&e.showFollowers),[a,e]);return{filters:e,filteredMessages:v,messages:a,addMessage:C,updateMessage:d,handleFilterChange:p,searchMessages:k,loading:m,refreshMessages:x,updateBounds:f}};export{Be as M,pe as a,B as b,de as e,Oe as g,We as u};
